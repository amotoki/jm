.\"
.\" Copyright 1997, 1999 Thorsten Kukuk, <kukuk@suse.de>
.\" Copyright 1994, 1995, 1996 Olaf Kirch, <okir@monad.swb.de>
.\"
.\" This program is covered by the GNU General Public License, version 2.
.\" It is provided in the hope that it is useful. However, the author
.\" disclaims ALL WARRANTIES, expressed or implied. See the GPL for details.
.\"
.\" Japanese Version Copyright (c) 1998, 1999 NAKANO Takeo all rights reserved.
.\" Translated Mon 23 Nov 1998 by NAKANO Takeo <nakano@apm.seikei.ac.jp>
.\" Updated Fri 22 Oct 1999 by NAKANO Takeo
.\"
.TH RPC.YPPASSWDD 8 "August 2001" "YP Server" ""
.\"O .SH NAME
.\"O rpc.yppasswdd \- NIS password update daemon
.SH 名前
rpc.yppasswdd \- NIS パスワード更新デーモン
.\"O .SH SYNOPSIS
.SH 書式
.B "rpc.yppasswdd [\-D directory] [\-e chsh|chfn] [--port number]"
.br
.B "rpc.yppasswdd [\-s shadow] [\-p passwd] [\-e chsh|chfn] [--port number]"
.br
.B "rpc.yppasswdd -x program|-E program [-e chsh|chfn] [--port number]"
.\"O .SH DESCRIPTION
.SH 説明
.\"O \fBrpc.yppasswdd\fP is the RPC server that lets users change their passwords
.\"O in the presence of NIS (a.k.a. YP). It must be run on the NIS master
.\"O server for that NIS domain.
.B rpc.yppasswdd
は RPC のサーバーで、
NIS (YP) 環境下でユーザーによるパスワード変更を可能にする。
必ず NIS ドメインの NIS マスターサーバーで起動する。
.P
.\"O When a
.\"O .BR yppasswd (1)
.\"O client contacts the server, it sends the old user
.\"O password along with the new one. \fBrpc.yppasswdd\fP will search the system's
.\"O .B passwd
.\"O file for the specified user name, verify that the
.\"O given (old) password matches, and update the entry. If the user
.\"O specified does not exist, or if the password, UID or GID doesn't match
.\"O the information in the password file, the update request is rejected,
.\"O and an error returned to the client.
.BR yppasswd (1)
クライアントはサーバーに接続すると、
古いユーザーパスワードと新しいパスワードを送信する。
.B rpc.yppasswdd
はシステムの
.B passwd
ファイルからそのユーザーの名前を探し、古いパスワードがマッチしているか
どうかを確認し、エントリを更新する。
指定されたユーザーが存在しなかったり、
パスワード, UID, GID のいずれかが
パスワードファイルの情報とマッチしなかった場合には、
更新要求は拒否され、
クライアントにエラーが返される。
.P
.\"O If this version of the server is compiled with the CHECKROOT=1 option, the
.\"O password given is also checked against the systems root password.
このサーバーは、コンパイルの時に CHECKROOT=1 オプションを指定すると、
システムの root のパスワードに対しても、パスワードチェックを行うようになる。
.P
.\"O After updating the
.\"O .B passwd
.\"O file and returning a success notification
.\"O to the client, \fBrpc.yppasswdd\fP executes the \fBpwupdate\fP script that
.\"O updates the NIS server's \fBpasswd.*\fP and \fBshadow.byname\fP maps.
.\"O This script assumes all NIS maps are kept in directories named
.\"O .BI /var/yp/ nisdomain
.\"O that each contain a \fBMakefile\fP customized for that NIS domain. If no
.\"O such \fBMakefile\fP is found, the scripts uses the generic one in
.\"O \fB/var/yp\fP.
.B passwd
ファイルの更新とクライアントへの成功通知がすむと、
.B rpc.yppasswdd
は
.B pwupdate
スクリプトを実行して、 NIS サーバーの \fBpasswd.*\fP マップと
\fBshadow.byname\fP マップを更新する。
このスクリプトでは、すべての NIS マップが
.BI /var/yp/ nisdomain
ディレクトリ以下に保存されており、
その NIS ドメイン向けにカスタマイズされた
.B Makefile
もそこに置かれていることを仮定している。
そのような
.B Makefile
がない場合には、スクリプトは
.B /var/yp
にあるジェネリックな
.B Makefile
を用いる。
.\"O .SH OPTIONS
.\"O The following options are available:
.SH オプション
以下のオプションが指定できる。
.TP
.BI "\-D" " directory"
.\"O The
.\"O .B passwd
.\"O and
.\"O .B shadow
.\"O files are located under the specified directory path.
.\"O .B rpc.yppasswdd
.\"O will use this files, not
.\"O .B /etc/passwd
.\"O and
.\"O .B /etc/shadow.
.\"O This is useful if you do not want to give all users in the NIS database
.\"O automatic access to your NIS server.
.BR passwd " と " shadow
ファイルが指定したディレクトリに置かれる。
これが指定されると、
.B rpc.yppasswdd
は
.BR /etc/passwd " や " /etc/shadow
を使わない。
NIS データーベースに存在するユーザーすべてに、 NIS サーバーへの
アクセスを自動的には付与したくない場合に有効である。
.TP
.BI "\-E" " program"
.\"O Instead of rpc.yppasswdd editing the passwd & shadow files, the
.\"O specified program will be run to do the editing. The following
.\"O environment variables will be set for the program: YP_PASSWD_OLD,
.\"O YP_PASSWD_NEW, YP_USER, YP_GECOS, YP_SHELL. The program should return
.\"O an exit status of 0 if the change completes successfully, 1 if the
.\"O change completes successfully but pwupdate should not be run, and
.\"O otherwise if the change fails.
rpc.yppasswdd に passwd ファイルや shadow ファイルを直接編集させず、
指定したプログラムを実行して編集を行わせる。
以下の環境変数が設定され、指定プログラムに渡される:
YP_PASSWD_OLD, YP_PASSWD_NEW, YP_USER, YP_GECOS, YP_SHELL。
プログラムは変更が成功裏に終了したら 0 を返し、
変更は成功裏に終了したが pwupdate を実行しなくて良い場合は 1 を返し、
変更に失敗した場合はその他の値を返すようにしなければならない。
.TP
.BI "\-p" " passwdfile"
.\"O This options tells \fBrpc.yppasswdd\fP to use a different source file instead
.\"O of \fB/etc/passwd\fP This is useful if you do not want to give all users
.\"O in the NIS database automatic access to your NIS server.
.B rpc.yppasswdd
に、
.B /etc/passwd
の代わりに用いるソースファイルを伝える。
NIS データーベースに存在するユーザーすべてに、 NIS サーバーへの
アクセスを自動的には付与したくない場合に有効である。
.TP
.BI "\-s" " shadowfile"
.\"O This options tells \fBrpc.yppasswdd\fP to use a different source file instead
.\"O of \fB/etc/passwd\fP. See below for a brief discussion of shadow support.
.B rpc.yppasswdd
に、
.B /etc/shadow
の代わりに用いるソースファイルを伝える。
shadow サポートに関しては、以下で簡単に説明している。
.TP
.BI "\-e [chsh|chfn]"
.\"O By default, \fBrpc.yppasswdd\fP will not allow users to change the shell or
.\"O GECOS field of their \fBpasswd\fP entry. Using the \fB\-e\fP option,
.\"O you can enable either of these. Note that when enabling support for
.\"O \fBypchsh\fP(1), you have to list all shells users are allowed to
.\"O select in \fB/etc/shells\fP.
デフォルトでは、
.B rpc.yppasswdd
は
.B passwd
エントリにおけるシェルや GECOS フィールドのユーザーによる変更を許さない。
.B \-e
オプションを用いると、これらのそれぞれを有効にできる。
.BR ypchsh (1)
のサポートを有効にした場合には、ユーザーが選択できるシェルをすべて
.B /etc/shells
に記述する必要があることに注意すること。
.TP
.BI "\-x program"
.\"O When the -x option is used, rpc.yppasswdd will not attempt to modify
.\"O any files itself, but will instead run the specified program, passing
.\"O to its stdin information about the requested operation(s).  There is
.\"O a defined protocol used to communicate with this external program, which
.\"O has total freedom in how it propagates the change request. See
.\"O below for more details on this.
-x オプションが指定されると、 rpc.yppasswdd は自分自身では一切の
ファイルを変更せず、指定されたプログラムを起動し、その標準入力に
要求された操作に関する情報を渡そうとする。この外部プログラムとの
通信にはプロトコルが定義されており、変更要求をどのように伝播するかに
ついては最大限の自由度が確保されている。これに関する詳細は
以降を参照のこと。
.TP
.B "\-m"
.\"O Will be ignored, for compatibility with Solaris only.
単に無視される。 Solaris との互換性のためにだけ用意されたオプションである。
.TP
.BI "\-\-port number"
."O rpc.yppasswdd will try to register itself to this port. This makes
."O it  possible to have a router filter packets to the NIS ports.
rpc.yppasswd はこのポートに登録しようとする。
これを用いると、ルータによって
NIS のポートへのパケットをフィルタできるようになる。
.TP
.B "\-v" "\-\-version"
.\"O Prints the version number and if this package is compiled with the
.\"O CHECKROOT option.
バージョン番号を表示する。また、このパッケージのコンパイル時に、
CHECKROOT オプションが有効にされたかどうかも表示する。
.\"O .SH MISCELLANEOUS
.SH その他
.\"O .SS Shadow Passwords
.SS shadow パスワード
.\"O Using Shadow passwords alongside NIS does not make too much sense, because
.\"O the supposedly inaccesible passwords now become readable through a simple
.\"O invocation of
.\"O .BR ypcat (1).
shwdow パスワードを NIS と共に用いてもあまり意味がない。
なぜなら本来アクセス不可能であるべきパスワードが、単に
.BR ypcat (1)
を実行すれば NIS では読めてしまうからである。
.P
.\"O Shadow support in \fBrpc.yppasswdd\fP does not mean that it offers a very
.\"O clever solution to this problem, it simply means that it can read and write
.\"O password entries in the system's
.\"O .B shadow
.\"O file.  You have to produce a
.\"O \fBshadow.byname\fP NIS map to distribute password information to your NIS
.\"O clients. \fBrpc.yppasswdd\fP will search at first in the \fB/etc/passwd\fP file
.\"O for the user and password. If it find's the user, but the password is "x"
.\"O and a \fB/etc/shadow\fP file exists, it will update the password in the
.\"O shadow map.
.B rpc.yppasswdd
における shadow のサポートは、この問題を賢く解決する方法を提供する
わけではない。単にパスワードエントリをシステムの
.B shadow
ファイルから読めるようにする、というだけのことである。
これを用いるには、
.B shadow.byname
という NIS マップを作って、 NIS クライアントにパスワード情報を
知らせる必要がある。
.B rpc.yppasswdd
はまず
.B /etc/passwd
ファイルからユーザーのパスワードを検索する。ユーザーが見つかり、
かつパスワードが "x" で、さらに
.B /etc/shadow
ファイルが存在していた場合は、 shadow マップの
パスワードが更新される。
.\"O .SS Use of the -x option
.SS -x オプションの使い方
.\"O The program should expect to read a single line from stdin, which is
.\"O formatted as follows:
プログラムは標準入力から一行を読むようにする。フォーマットは以下の通り。
.P
<username> o:<oldpass> p:<password> s:<shell> g:<gcos>\\n
.P
.\"O where any of the three fields [p, s, g] may or may not be present.
[p, s, g] の 3 つのフィールドは、いずれもあってもなくてもかまわない。
.P
.\"O This program should write "OK\\n" to stdout if the operation succeeded.  On
.\"O any other result, rpc.yppasswdd will report failure to the client.
このプログラムは、操作が成功したら標準出力に "OK\\n" を返すようにする。
それ以外の場合は、 rpc.yppasswdd はクライアントに失敗したと報告する。
.P
.\"O Note that the program specified by the -x option is responsible for doing
.\"O any NIS make and build, and for doing any necessary validation on the
.\"O shell and gcos field information supplied.  The password passed to the client
.\"O will be in UNIX crypt() format.
-x オプションで指定したプログラムは NIS の make とビルドを行わねばならず、
また与えられたシェルと gecos フィールドの情報が正当なものかのチェックも
このプログラムの役割である。クライアントに与えられるパスワードは
UNIX crypt() フォーマットになる。
.\"O .SS Logging
.SS ログ記録
.\"O \fBrpc.yppasswdd\fP logs all password update requests to \fBsyslogd(8)\fP's
.\"O auth facility. The logging information includes the originating host's
.\"O IP address and the user name and UID contained in the request. The
.\"O user-supplied password itself is not logged.
.\"O .SS Security
.B rpc.yppasswdd
はすべてのパスワード更新要求を
.BR syslogd (8)
の auth facility を通して記録する。ログ情報は要求元ホストの IP アドレスと、
その要求に含まれていたユーザー名および UID である。
ユーザーによって与えられたパスワードそのものは記録されない。
.SS セキュリティ
.\"O Unless I've screwed up completely (as I did with versions prior to
.\"O version\ 0.5), \fBrpc.yppasswdd\fP should be as secure or insecure as any
.\"O program relying on simple password authentication.  If you feel that
.\"O this is not enough, you may want to protect \fBrpc.yppasswdd\fP from outside
.\"O access by using the `securenets' feature of the new \fBportmap(8)\fP
.\"O version\ 3.  Better still, use Kerberos.
作者が完全に問題を解決するまでは、
.B rpc.yppasswdd
はシンプルなパスワード認証に依存するプログラムと同程度のセキュリティ
しか持たない (バージョン 0.5 以前では良かったのだが)。
これが充分でないと思う場合は、新しい
.BR portmap (8)
バージョン 3 の `securenets' 機能を用いて、
.B rpc.yppasswdd
をアクセス外に置くことをすすめる。あるいは Kerberos を使えば
さらに良いかも知れない。
.B rpc.yppasswdd
を
.\"O .SH COPYRIGHT
.SH 著作権
\fBrpc.yppasswdd\fP is copyright (C) Olaf Kirch. You can use and distribute it
under the GNU General Public License Version 2. Note that it does \fInot\fP
contain any code from the shadow password suite.
.\"O .SH FILES
.SH ファイル
\fB/usr/sbin/rpc.yppasswdd\fP
.br
\fB/usr/lib/yp/pwupdate\fP
.br
\fB/etc/passwd\fP
.br
\fB/etc/shadow\fP
.\"O .SH SEE ALSO
.SH 関連項目
.BR passwd (5),
.BR shadow (5),
.BR passwd (1),
.BR yppasswd (1),
.BR ypchsh (1),
.BR ypchfn (1),
.BR ypserv (8),
.BR ypcat (1)
.LP
.\"O The Network Information Service
.\"O (\s-1NIS\s0)
.\"O was formerly known as Sun Yellow Pages
.\"O (\s-1YP\s0).
.\"O The functionality of the two remains the same;
.\"O only the name has changed.
.\"O The name Yellow Pages is a registered trademark in the United Kingdom
.\"O of British Telecommunications plc,
.\"O and may not be used without permission.
Network Information Service
(\s-1NIS\s0)
は、以前は Sun Yellow Pages
(\s-1YP\s0).
と呼ばれていた。
この両者の機能はまったく同じものであり、名前が違うだけである。
Yellow Pages という名前は、英国で
British Telecommunications plc の登録商標となっており、
許可を得ずに用いることはできない。
.\"O .SH AUTHOR
.SH 著者
Olaf Kirch, <okir@monad.swb.de>
.br
Thorsten Kukuk, <kukuk@suse.de>
