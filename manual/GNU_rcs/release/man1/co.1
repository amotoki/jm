.de Id
.ds Rv \\$3
.ds Dt \\$4
..
.Id $Id: co.1,v 1.1.1.1 1999/07/19 01:49:13 cvs Exp $
.ds g \&\s-1UTC\s0
.ds r \&\s-1RCS\s0
.if n .ds - \%--
.if t .ds - \(em
.TH CO 1 \*(Dt GNU
.SH 名称
co \- RCS ファイルからリビジョンを取り出す
.SH 書式
.B co
.RI [ options ] " file " .\|.\|.
.SH 解説
.B co
は、\*r ファイルからリビジョンを検索し、対応したワークファイルに取り
出します。
.PP
\*r 拡張子にマッチするファイル名は \*r ファイルであるとみなし、その他
のファイル名はワークファイルであるとみなします。
.BR ci (1)
を参照してください。
.PP
\*r ファイルのリビジョンはロックするか、ロックしないで取り出され
ます。リビジョンをロックすることにより、同時に複数の変更が行われること
を防止します。内容を表示したり、読むだけの処理(たとえば、コンパイル)で
用いたりする場合はロックする必要はありません。編集したり、あとで登録するために
取り出すときは、通常、ロックしなければなりません。他のユーザによってロックされて
いるリビジョンをロックすることはできません(ロックは
.BR rcs (1)
によって解
除することができます)。リビジョンロックして取り出すには、さらに、ユーザが \*r ファイルのア
クセスリストに登録されているか、ファイルの所有者であるか、スーパーユーザ
であるか、アクセスリストが空でなければなりません。ロックしない
で取り出す場合は、アクセスリストや他人のロックに影響されることはありませ
ん。
.PP
取り出されるリビジョンを、リビジョン番号、枝番号、登
録日時、作者、状態によって指定することができます。
複数のオプションが
指定された場合、
.B co
はデフォルト枝(通常は幹:
.BR rcs (1)
の
.B \-b
の項を参照)の
すべての条件に合致するリビジョンのうちで最新のものを取り出します。リビ
ジョン番号あるいは枝番号は、以下のオプションを使って指定することができ
ます:
.B \-f
、
.B \-I
、
.B \-l
、
.B \-M
、
.B \-p
、
.B \-q
、
.B \-r
、
.B \-u
。オプション
.B \-d
(date:日時)、
.B \-s
(state:状態)、
.B \-w
(author:作者)は、
.B \-f
、
.B \-I
、
.B \-l
、
.B \-M
、
.B \-p
、
.B \-q
、
.B \-r
、
.B \-u
オプションにより選択
された枝またはデフォルト枝からリビジョンを選択します。
.PP
リビジョンを指定せずに \*r ファイルに対して
.B co
コマンドを適用すると、長
さ 0 のワークファイルが作成されます。
.B co
は、つねにキーワード置換を行います
(下記参照)。
.SH オプション
.TP
.BR \-r [\f2rev\fP]
リビジョン番号
.I rev
以前(
.I rev
と同じものも含む)で最新のリビジョンを取り
出します。
.I rev
がリビジョンではなく枝を指定している場合、その枝上の最新
のリビジョンが取り出されます。
.I rev
が省略された場合、デフォルト枝
(
.BR rcs (1)
の
.B \-b
オプションの項を参照)の最新のリビジョンが取り出されます。
.I rev
が
.B $
の場合、
.B co
はリビジョン番号をワークファイルのキーワードから
取り出します。これら以外の場合、
.I rev
はリビジョンを示すピリオドで区切ら
れた数字またはシンボルの列です。シンボルは、
.BR ci (1)
や
.BR rcs (1)
によりリビ
ジョン番号と結びつけることができます。
.TP
.BR \-l [\f2rev\fP]
.B \-r
と同様に動作し、取り出したリビジョンをロックします。
.TP
.BR \-u [\f2rev\fP]
.B \-r
と同様に動作し、取り出したリビジョンのロックを解除します。それ以前にロッ
クされていた場合、これも解除されます。
.I rev
が省略された場合、
.B co
を起動したユー
ザがロックしたリビジョンがあれば、そのリビジョンのロックを解除します。さもなければ、
デフォルト枝の最新のリビジョンが対象となります。
.TP
.BR \-f [\f2rev\fP]
つねにワークファイルを上書きします。後述の
.B \-q
オプションを使用する場合、いっしょに
.B \-f
オプションも
指定すると便利な場合があります。
.SM "ファイルモード"
の項も参照してください。
.TP
.B \-kkv
ワークファイルにデフォルト形式のキーワード文字列を埋め込みます。たとえば、
キーワード
.B Revision
に対しては、文字列
.B "$\&Revision: \*(Rv $"
を生成します。ファ
イルがロックされるなら
.B Header
、
.B Id
、
.B Locker
キーワードにロック者名が展開
されます。これがデフォルトの動作です。
.TP
.B \-kkvl
.B \-kkv
とほぼ同様ですが、対象となるファイルがすでにロックされていた場合
に、ロック者名が展開されます。
.TP
.BR \-kk
キーワード名のみの文字列を生成し、値は省略します。たとえば、キーワード 
Revision に対しては、通常の
.B "$\&Revision: \*(Rv $"
のかわりに、
.B "$\&Revision$"
を生成します。これは、異なるリビジョンの内容を比較する場合、キーワード
値の違いを無視できるので、便利です。
.TP
.BR \-ko
ワークファイル中のキーワード文字列をそのまま出力します。たとえば、ワーク
ファイル中にキーワード文字列
.B "$\&Revision: 1.1 $"
があれば、出力ファイルに
もそのままの文字列を埋め込みます。単純に文字列置換を行ってはい
けないバイナリファイル等を扱う場合に指定します。
.TP
.BR \-kv
キーワード文字列としてキーワード値のみを生成します。たとえば、キーワード 
.B Revision
に対して、通常の
.B "$\&Revision: \*(Rv $"
のかわりに
.B \*(Rv
を生成します。
これは、キーワード文字列から
.B "$\&Revision: $"
のようなキーワード区切りを取
り除くことが困難なプログラミング言語用のファイル等を生成するために
使用します。しかしながら、キーワード名が取り除かれてしまうと、それ以
降にキーワード置換を行うことができません。このため、本オプションを -l 
オプションと組み合わせて使うことはできません。また、ワークファイルの書
き込み権はオフになります。後でワークファイルを編集する場合は、-kv オプショ
ンを指定せずにワークファイルを取り出してから行います。
.TP
.BR \-p [\f2rev\fP]
ワークファイルとして書き出すかわりに、対象となるリビジョンを標準出力に書き出します。
.B co
をパイプの一部として使用する場合に便利です。
.TP
.BR \-q [\f2rev\fP]
診断メッセージを表示しません。
.TP
.BR \-I [\f2rev\fP]
対話モードで動作します。たとえ標準入力が端末でなくても、ユーザに対して
問い合わせを行います。
.TP
.BI \-d date
選択された枝上の、指定された日付以前の登録日付を持つ最新のリビジョンを
取り出します。日付は自由形式で指定します。タイムゾーンとして
.B LT
を指定
することにより、ローカル時間を使用することができます。他の一般的なタイ
ムゾーンも使用することができます。たとえば、以下に挙げるいくつかの指定は、
Pacific 標準時におけ
る1990年1月11日午後8時と同時刻を示します(Pacific 標準時は \*g よりも 8 
時間遅れです)。
.RS
.LP
.RS
.nf
.ta \w'\f3Thu, 11 Jan 1990 20:00:00 \-0800\fP  'u
.ne 9
\f38:00 pm lt\fP
\f34:00 AM, Jan. 12, 1990\fP	注記: デフォルトは \*g
\f31990/01/12 04:00:00\fP	\*r の日付形式
\f3Thu Jan 11 20:00:00 1990 LT\fP	\f3ctime\fP(3) + \f3LT\fP
\f3Thu Jan 11 20:00:00 PST 1990\fP	\f3date\fP(1)
\f3Fri Jan 12 04:00:00 GMT 1990\fP
\f3Thu, 11 Jan 1990 20:00:00 \-0800\fP
\f3Fri-JST, 1990, 1pm Jan 12\fP
\f312-January-1990, 04:00-WET\fP
.ta 4n +4n +4n +4n
.fi
.RE
.LP
ほとんどの日付の項目にはデフォルト値があります。デフォルトのタイムゾー
ンは \*g です。他のデフォルト値は、年、月、日、時、分、秒 の順番で決定
されます。これらの項目のうち、少なくとも 1 つが指定されなければいけません。
指定のある項目よりも先に決定される項目が省略されている場合には、現在のローカ
ル時が採用されます。他の省略されたフィールドには最小値が採用されます。
たとえば、
.B "20, 10:30"
の場合は、現在の年、月の 20 日 10 時 30 分 00 秒が採用され
ます。日付の指定に空白が含まれる場合には、日付の指定をクォートでくくる必要があることに
注意してください。
.RE
.TP
.BR \-M [\f2rev\fP]
作成されるワークファイルの最終更新日付を、取り出されるリビジョンの日付に
します。本オプションを指定すると
.BR make (1)
が正しく動作しなくなるので、注意して使用する必要があります。
.TP
.BI \-s state
選択された枝上の、状態
.I state
を持つ最新のリビジョンを取り出します。
.TP
.BR \-w [\f2login\fP]
選択された枝上の、ユーザ user によって登録された最新のリビジョンを取り
出します。
.I login
が省略された場合は、
.B co
を起動したユーザ名を使います。
.TP
.BI \-j joinlist
.I joinlist
で指定されたリビジョンを結合した新しいリビジョン作成します。本
オプションは、旧バージョンとの互換性のために残されています。
通常、リビジョンの結合に
は
.BR rcsmerge (1)
を用います。
.RS
.PP
.I joinlist
は
.IB rev2 : rev3
形式のリビジョンの対をコンマで区切って並べたリストです。
ここで、
.I rev2
と
.I rev3
は(シンボリックまたは数字の)リビジョン番号です。
以下の説明で、
.I rev1
は以下のリビジョンを示します: (1) joinlist に列挙さ
れた対のうち、最初のものに対しては、上記の
.B \-f
から
.B \-w
オプションによって
選択されたリビジョン。(2) それ以外の対に対しては、直前の対から作成され
たリビジョン(すなわち、1 つの対によって作成されたリビジョンは次の結合
のための入力となります)。
.PP
それぞれの対に対して、
.B co
は
.I rev1
と
.I rev3
を
.I rev2
と比較しながら結合し
ます。つまり、
.I rev2
を
.I rev1
と同一にするための変更を、
.I rev3
のコピーに対し
て適用します。
.I rev2
を同一の祖先とする 2 つの枝の末端のリビジョン
.I rev1 
と
.I rev3
を結合するのによく用いられます。もし、3 つのリビジョンが同一の
枝上にあり、リビジョン番号が
.IR rev1 < rev2 < rev3
ならば、結合の結果は、
.I rev3 
の内容のうち、
.I rev1
から
.I rev2
への変更を無効にしたものになります。
もし、
.I rev2
から
.I rev1
への変更が
.I rev2
から
.I rev3
への変更と重複している
なら、
.B co
は
.BR merge (1)
に示したような報告を行います。
.PP
最初に指定する対では
.I rev2
を省略することができます。この場合は、
.I rev1
と
.I rev3
の共通の祖先
.ig
／＊？-> 共通の祖先リビジョン以外に言いかたを思いつきません

共通の祖先リビジョン
 |        |        |
revX     rev3     revY
 |
rev1


＊／
..
リビジョンを
.I rev2
として使用します。もし、いず
れかの引数
がリビジョンではなく枝を示しているなら、その枝上の最新のリビジョンが用
いられます。同時に
.B \-l
オプションや
.B \-u
オプションを指定すると、
.I rev1
がロックまたはロック解除されます。
.RE
.TP
.BI \-V n
バージョン
.I n
の \*r システムの動作をエミュレートします。
.I n
は
.B 3
、
.B 4
、
.B 5 
のいずれかです。これは、古い \*r を使っているユーザと \*r ファイルを交
換するときに便利です。使用している \*r がどのバージョンかを調べるには、
適当なファイルに対して
.B rlog
を起動します。最初の数行に文字列
.B branch:
がなければ、それはバージョン 3 です。また、日付に現れる年が 2 桁の数字
ならば、それはバージョン 4 です。どちらでもなければ、バージョン 5 です。
\*r バージョン 3 をエミュレートして作成された \*r ファイルからはデフォルト
枝の情報が失われます。バージョン 4 またはそれ以前のバージョンをエミュ
レートして作成されたリビジョンは、最大 13 時間ずれた日付を持つことになり
ます。バージョン 3 またはそれ以前のバージョンをエミュレートして取り出
されたファイルには
.IB yyyy / mm / dd
ではなく
.IB yy / mm / dd
形式の日付がキーワード中
に展開されます。また、
.B $\&Log$
キーワードでは空白の入り方が異なります。
.TP
.BI \-x "suffixes"
\*r ファイル拡張子を指定します。詳しくは
.BR ci (1)
を参照してください。
.SH "キーワード置換"
テキスト中に存在する
.BI $ keyword $
または
.BI $ keyword : .\|.\|. $
形式の文字列は、
.BI $ keyword : value $
形式の文字列に置換されます。
.I keyword
と
.I value 
の対については後述します。キーワードはリテラルな文字列として、あるいは
リビジョンを特定するためのコメントとして埋められることがあります。
.PP
まず、ユーザは
.BI $ keyword $
なる形式の文字列を埋め込んで \*r ファイルに登
録します。\*r ファイルからワークファイルに取り出されるとき、
.B co
はこの
文字列を
.BI $ keyword : value $
に置換します。
.BI $ keyword : value $
形式の文
字列を含むものが登録された場合、
.I value
の部分は次に取り出されたときに新
たな値に置換されます。このように、取り出しを行うごとにキーワードの値は
更新されていきます。\*r コマンドのいくつかは、
.B \-k
オプションにより、この
動作を変更することができます。
.PP
キーワードの種類とその値:
.TP
.B $\&Author$
リビジョンを登録したユーザのログイン名
.TP
.B $\&Date$
リビジョンが登録された日時(\*g)
.TP
.B $\&Header$
標準的なヘッダ。\*r ファイルのフルパス名、リビジョン番号、日時、作者、
状態、ロック者が含まれます。
.TP
.B $\&Id$
.B $\&Header$
とほぼ同様です。\*r ファイル名は、パスをつけずに埋め込まれます。
.TP
.B $\&Locker$
リビジョンをロックしたユーザのログイン名
.TP
.B $\&Log$
登録時に与えたログメッセージ。ヘッダとして、\*r ファイル名、リビジョン
番号、作者、日時が埋め込まれる。すでに埋め込まれているログメッセージは
変更されず、新たなログメッセージのみが
.BR $\&Log: .\|.\|. $
のあとに追加される。
ソースファイルの完全なログを記録するときに便利である。
.TP
.B $\&RCSfile$
パス名を含まない \*r ファイル名
.TP
.B $\&Revision$
リビジョン番号
.TP
.B $\&Source$
\*r ファイルのフルパス名
.TP
.B $\&State$
リビジョンに
.BR rcs (1)
か
.BR ci (1)
の
.B \-s
オプションにより割り付けられた状態。
.SH "ファイルモード"
ワークファイルは、 \*r ファイルの読み込みと実行の許可属性を受け継ぎます。
さらに、
.B \-kv
オプションが設定されていないか、厳格ロックモード(
.BR rcs (1)
参照)でロックせずに取り出していなければ、ユーザに対する書き込み
権が設定されます。
.PP
すでに、ワークファイルと同名の書き込み可能なファイルが存在していると、
.B co
は取り出しを中断し、もし可能ならば削除するかどうかを問い合わせます。
もし、すでに存在するファイルが書き込み禁止であったり、
.B -f
オプションが
指定されていた場合には、問い合わせを行わずに削除します。
.SH ファイル
.B co
は
.B ci
とほぼ同じくらいのファイルにアクセスします。ただし、ワークファイル
を読むことはありません。
.SH 環境変数
.TP
.B \s-1RCSINIT\s0
本変数に空白で区切ったオプションを設定することで、コマンドライン引数に先立って処理されます。
詳しくは
.BR ci (1)
を参照してください。
.SH 診断
\*r ファイル名、ワークファイル名、取り出されるリビジョンの番号を表示し
ます。処理が成功した場合は終了ステータス 0 を返
します。
.SH 作者
Author: Walter F. Tichy.
.br
Revision Number: \*(Rv; Release Date: \*(Dt.
.br
Copyright \(co 1982, 1988, 1989 by Walter F. Tichy.
.br
Copyright \(co 1990, 1991 by Paul Eggert.
.SH 関連項目
ci(1), ctime(3), date(1), ident(1), make(1),
rcs(1), rcsdiff(1), rcsintro(1), rcsmerge(1), rlog(1),
rcsfile(5)
.br
Walter F. Tichy,
\*r\*-A System for Version Control,
.I "Software\*-Practice & Experience"
.BR 15 ,
7 (July 1985), 637-654.
.SH 制限事項
RCS ファイル、ワークファイルのリンクは保存されません。
.PP
キーワードを
.B "$\&keyword:$"
以外の形式に書換える以外に、一部のキーワードの
みを展開させる方法がありません。nroff や troff ではキーワード中に空文
字
.B \e&
を埋め込むことにより展開を防ぐことができます。
.SH バグ
.B \-d
オプションが日付の解釈を間違えることがあります。また、1970 年より前の日付
を受け付けません。
