.\"O .SH HISTORY
.SH 履歴(HISTORY)
.\"O When the
.\"O .B \-o history
.\"O option to the
.\"O .B set
.\"O builtin is enabled, the shell provides access to the
.\"O \fIcommand history\fP,
.\"O the list of commands previously typed.
.B \-o history
オプションを組み込みコマンドの
.B set
で有効にすると、
\fIコマンド履歴 (command history)\fP (以前に入力したコマンドのリスト)
にアクセスできるようになります。
.\"O The value of the \fBHISTSIZE\fP variable is used as the
.\"O number of commands to save in a history list.
変数 \fBHISTSIZE\fP の値が、
履歴リストに保存するコマンドの数になります。
.\"WORD:	history list	履歴リスト
.\"O The text of the last
.\"O .SM
.\"O .B HISTSIZE
.\"O commands (default 500) is saved.  The shell
.\"O stores each command in the history list prior to parameter and
.\"O variable expansion (see
.\"O .SM
.\"O .B EXPANSION
.\"O above) but after history expansion is performed, subject to the
.\"O values of the shell variables
.\"O .SM
.\"O .B HISTIGNORE
.\"O and
.\"O .SM
.\"O .BR HISTCONTROL .
過去に入力したコマンドのうち、最新
.SM
.B HISTSIZE
個分 (デフォルトは 500 個) のテキストが保存されます。
シェルは各コマンドを、パラメータ展開や変数展開
(前述の
.SM
.B 展開
を参照) を行う前のかたちで履歴リストに格納します。
ただし、履歴展開は実行してから格納します。
履歴展開はシェル変数
.SM
.B HISTIGNORE
と
.SM
.BR HISTCONTROL
の値に従って実行されます。
.PP
.\"O On startup, the history is initialized from the file named by
.\"O the variable
.\"O .SM
.\"O .B HISTFILE
.\"O (default \fI~/.bash_history\fP).
起動時に、履歴は
.SM
.B HISTFILE
変数 (デフォルトは \fI~/.bash_history\fP)
が示すファイルの内容で初期化されます。
.\"O The file named by the value of
.\"O .SM
.\"O .B HISTFILE
.\"O is truncated, if necessary, to contain no more than
.\"O the number of lines specified by the value of
.\"O .SM
.\"O .BR HISTFILESIZE .
.SM
.B HISTFILE
で指定されたファイルは、
.SM
.B HISTFILESIZE
で指定された行数を越えないように、必要に応じて切り詰められます。
.\"O When an interactive shell exits, the last
.\"O .SM
.\"O .B HISTSIZE
.\"O lines are copied from the history list to
.\"O .SM
.\"O .BR HISTFILE .
対話的なシェルが終了する際には、最近の
.SM
.B HISTSIZE
個の行が履歴リストから
.SM
.B HISTFILE
にコピーされます。
.\"O If the
.\"O .B histappend
.\"O shell option is enabled
.\"O (see the description of
.\"O .B shopt
.\"O under
.\"O .SM
.\"O .B "SHELL BUILTIN COMMANDS"
.\"O below), the lines are appended to the history file,
.\"O otherwise the history file is overwritten.
シェルオプションの
.B histappend
(
.SM
.B シェルの組み込みコマンド
の項の
.B shopt
の説明を参照) が有効になっていると、
これらの行は履歴ファイルの末尾に追加されます。
このオプションが無効ならば、履歴ファイルは上書きされます。
.\"O If
.\"O .SM
.\"O .B HISTFILE
.\"O is unset, or if the history file is unwritable, the history is
.\"O not saved.  After saving the history, the history file is truncated
.\"O to contain no more than
.\"O .SM
.\"O .B HISTFILESIZE
.\"O lines.  If
.\"O .SM
.\"O .B HISTFILESIZE
.\"O is not set, no truncation is performed.
.SM
.B HISTFILE
が設定されていないか、履歴ファイルが書き込めない状態だと、
履歴は保存されません。
履歴の保存を行った後には、履歴ファイルは行数が
.SM
.B HISTFILESIZE
行を越えないように切り詰められます。
.SM
.B HISTFILESIZE
が設定されていなければ、切り詰めは行われません。
.PP
.\"O The builtin command
.\"O .B fc
.\"O (see
.\"O .SM
.\"O .B SHELL BUILTIN COMMANDS
.\"O below) may be used to list or edit and re-execute a portion of
.\"O the history list.
組み込みコマンド
.B fc
(後述の
.SM
.B シェルの組み込みコマンド
を参照) を用いると、履歴リストの一部をリスト・編集して再実行できます。
.\"O The
.\"O .B history
.\"O builtin may be used to display or modify the history list and
.\"O manipulate the history file.
.\"O When using command-line editing, search commands
.\"O are available in each editing mode that provide access to the
.\"O history list.
組み込みコマンドの
.B history
を用いると、履歴リストを表示・編集したり、
履歴ファイルを操作できます。
コマンドラインを編集する際には、
各編集モードでいろいろな検索コマンドが利用でき、
履歴リストへアクセスできます。
.PP
.\"O The shell allows control over which commands are saved on the history
.\"O list.  The
.\"O .SM
.\"O .B HISTCONTROL
.\"O and
.\"O .SM
.\"O .B HISTIGNORE
.\"O variables may be set to cause the shell to save only a subset of the
.\"O commands entered.
このシェルでは、どのコマンドが履歴リストに保存されるかを制御できます。
.SM
.B HISTCONTROL
変数と
.SM
.B HISTIGNORE
変数を設定すると、
シェルは入力されたコマンドの一部しか保存しなくなります。
.\"O The
.\"O .B cmdhist
.\"O shell option, if enabled, causes the shell to attempt to save each
.\"O line of a multi-line command in the same history entry, adding
.\"O semicolons where necessary to preserve syntactic correctness.
シェルオプションの
.B cmdhist
を有効にすると、シェルは複数行に別れているコマンドの各行を
同じ履歴エントリに保存しようとします。
この際には、文法的な正しさを保つためにセミコロンが必要に応じて追加されます。
.\"O The
.\"O .B lithist
.\"O shell option causes the shell to save the command with embedded newlines
.\"O instead of semicolons.  See the description of the
.\"O .B shopt
.\"O builtin below under
.\"O .SM
.\"O .B "SHELL BUILTIN COMMANDS"
.\"O for information on setting and unsetting shell options.
シェルオプションの
.B lithist
を有効にすると、このシェルは行の途中に
セミコロンではなく改行文字を置く形でコマンドを保存します。
シェルオプションの設定と設定取り消しについては、後述の
.SM
.B シェルの組み込みコマンド
における説明を参照してください。
.\"O .SH "HISTORY EXPANSION"
.SH 履歴の展開
.PP
.\"O The shell supports a history expansion feature that
.\"O is similar to the history expansion in
.\"O .BR csh.
.\"O This section describes what syntax features are available.  This
.\"O feature is enabled by default for interactive shells, and can be
.\"O disabled using the
.\"O .B \+H
.\"O option to the
.\"O .B set
.\"O builtin command (see
.\"O .SM
.\"O .B SHELL BUILTIN COMMANDS
.\"O below).  Non-interactive shells do not perform history expansion
.\"O by default.
このシェルは、
.B csh
の履歴展開と同じような機能をサポートしています。
このセクションでは、履歴展開で使用できる記法・機能を説明します。
この機能は対話的シェルならばデフォルトで有効になっていますが、
組み込みコマンド
.B set
の
.B \+H
オプション (後述の
.SM
.B シェルの組み込みコマンド
を参照) で無効にできます。
非対話的シェルの場合は、デフォルトでは履歴展開は行われません。
.PP
.\"O History expansions introduce words from the history list into
.\"O the input stream, making it easy to repeat commands, insert the
.\"O arguments to a previous command into the current input line, or
.\"O fix errors in previous commands quickly.
履歴展開は、履歴リスト中の単語を入力ストリームに入れます。
この機能を利用すると、コマンドを繰り返したり、
前のコマンドで指定したオプションを現在の入力行に挿入したり、
前のコマンドの誤りを手早く直したり、
といったことが簡単にできるようになります。
.PP
.\"O History expansion is performed immediately after a complete line
.\"O is read, before the shell breaks it into words.
.\"O It takes place in two parts.
.\"O The first is to determine which line from the history list
.\"O to use during substitution.
.\"O The second is to select portions of that line for inclusion into
.\"O the current one.
履歴展開が実行されるのは入力行全体を読み込んだ直後であり、
シェルが行を単語に分割するよりも前です。
履歴展開の動作は 2 段階で行われます。
まず最初に、置換に使う行を履歴リストから選びます。
次に、その行のどの部分を現在の行に書き込むかを選択します。
.\"O The line selected from the history is the \fIevent\fP,
.\"O and the portions of that line that are acted upon are \fIwords\fP.
.\"O Various \fImodifiers\fP are available to manipulate the selected words.
履歴リストから選ばれた行は\fIイベント (event)\fP と呼ばれ、
この行のうち動作の対象となる部分を\fI単語列 (words)\fPと呼びます。
様々な\fI修飾子 (modifier)\fP が利用でき、
選択された単語列の操作が可能になっています。
.\"O The line is broken into words in the same fashion as when reading input,
.\"O so that several \fImetacharacter\fP-separated words surrounded by
.\"O quotes are considered one word.
行の単語への分割は入力を読み込む時と同じように行われるので、
\fIメタ文字\fPで区切られた複数の単語をクォートで括ったものは
1 つの単語と見なされます。
.\"O History expansions are introduced by the appearance of the
.\"O history expansion character, which is \^\fB!\fP\^ by default.
.\"O Only backslash (\^\fB\e\fP\^) and single quotes can quote
.\"O the history expansion character.
履歴展開が行われるのは、履歴展開文字が現われた時です。
履歴展開文字はデフォルトでは \^\fB!\fP\^ です。
履歴展開文字をクォートできるのは、
バックスラッシュ (\^\fB\e\fP\^) とシングルクォートだけです。
.PP
.\"O Several shell options settable with the
.\"O .B shopt
.\"O builtin may be used to tailor the behavior of history expansion.
組み込みコマンドの
.B shopt
を用いて、何種類かあるシェルオプションを設定すると、
履歴展開の動作を調整できます。
.\"O If the
.\"O .B histverify
.\"O shell option is enabled (see the description of the
.\"O .B shopt
.\"O builtin), and
.\"O .B readline
.\"O is being used, history substitutions are not immediately passed to
.\"O the shell parser.
シェルオプションの
.B histverify
が有効で (組み込みコマンド
.B shopt
の説明を参照)、かつ
.B readline
が使われている場合には、
履歴置換を行った結果はすぐにはシェルのパーザに渡されません。
.\"O Instead, the expanded line is reloaded into the
.\"O .B readline
.\"O editing buffer for further modification.
展開された行は
.B readline
の編集バッファに再び読み込まれ、さらに編集が行える状態になります。
.\"O If
.\"O .B readline
.\"O is being used, and the
.\"O .B histreedit
.\"O shell option is enabled, a failed history substitution will be reloaded
.\"O into the
.\"O .B readline
.\"O editing buffer for correction.
.B readline
を使用しており、かつシェルオプションの
.B histreedit
が有効である場合、履歴置換が失敗してもその結果は
.B readline
の編集バッファに再び読み込まれ、訂正できる状態となります。
.\"O The
.\"O .B \-p
.\"O option to the
.\"O .B history
.\"O builtin command may be used to see what a history expansion will
.\"O do before using it.
組み込みコマンド
.B history
の
.B \-p
オプションを使うと、実際に履歴展開を行う前に、
どのように展開されるのかを見ることができます。
.\"O The
.\"O .B \-s
.\"O option to the
.\"O .B history
.\"O builtin may be used to add commands to the end of the history list
.\"O without actually executing them, so that they are available for
.\"O subsequent recall.
組み込みコマンド
.B history
の
.B \-s
オプションを使うと、
コマンドを履歴リストの末尾に (実際の実行はせずに) 追加できます。
追加したコマンドは、後で再呼び出しできます。
.PP
.\"O The shell allows control of the various characters used by the
.\"O history expansion mechanism (see the description of
.\"O .B histchars
.\"O above under
.\"O .BR "Shell Variables" ).
このシェルでは、履歴展開機構で使ういろいろな文字を制御できます
(前述の
.BR シェル変数
の項目における
.B histchars
の説明を参照してください)。
.\"O .SS Event Designators
.SS イベント指示子 (Event Designator)
.PP
.\"O An event designator is a reference to a command line entry in the
.\"O history list.
イベント指示子は、
履歴リスト中のコマンドラインエントリを参照するものです。
.PP
.PD 0
.TP
.B !
.\"O Start a history substitution, except when followed by a
.\"O .BR blank ,
.\"O newline, = or (.
履歴置換を開始します。ただし、\fBブランク文字\fR、
改行文字、=, ( のいずれかが後に続く場合は除きます。
.TP
.B !\fIn\fR
.\"O Refer to command line
.\"O .IR n .
.I n
行目のコマンドラインを参照します。
.TP
.B !\-\fIn\fR
.\"O Refer to the current command line minus
.\"O .IR n .
現在から
.I n
行前のコマンドラインを参照します。
.TP
.B !!
.\"O Refer to the previous command.  This is a synonym for `!\-1'.
1 行前のコマンドラインを参照します。`!\-1' と同義です。
.TP
.B !\fIstring\fR
.\"O Refer to the most recent command starting with 
.\"O .IR string .
.I string
で始まるコマンドのうち、一番現在に近いところで実行したものを参照します。
.TP
.B !?\fIstring\fR\fB[?]\fR
.\"O Refer to the most recent command containing
.\"O .IR string .
.\"O The trailing \fB?\fP may be omitted if
.\"O .I string
.\"O is followed immediately by a newline.
.I string
を含むコマンドのうち、一番現在に近いところで実行したものを参照します。
.I string
の直後が改行文字ならば、最後の \fB?\fP は省略しても構いません。
.TP
.B \d\s+2^\s-2\u\fIstring1\fP\d\s+2^\s-2\u\fIstring2\fP\d\s+2^\s-2\u
.\"O Quick substitution.  Repeat the last command, replacing
.\"O .I string1
.\"O with
.\"O .IR string2 .
.\"O Equivalent to
.\"O ``!!:s/\fIstring1\fP/\fIstring2\fP/''
.\"O (see \fBModifiers\fP below).
簡易置換。
.I string1
を
.IR string2
に置換して直前のコマンドを繰り返します。
``!!:s/\fIstring1\fP/\fIstring2\fP/'' と同義です
(後述の\fB修飾子\fPを参照)。
.TP
.B !#
.\"O The entire command line typed so far.
今までのところまでに打ち込んだコマンドライン全体です。
.PD
.\"O .SS Word Designators
.SS 単語指示子(Word Designators)
.PP
.\"O Word designators are used to select desired words from the event.
.\"O A 
.\"O .B :
.\"O separates the event specification from the word designator.
.\"O It may be omitted if the word designator begins with a
.\"O .BR ^ ,
.\"O .BR $ ,
.\"O .BR * ,
.\"O .BR \- ,
.\"O or
.\"O .BR % .
.\"O Words are numbered from the beginning of the line,
.\"O with the first word being denoted by 0 (zero).
.\"O Words are inserted into the current line separated by single spaces.
単語指示子 (word designator) は、
イベントから欲しい単語を選ぶ時に用いられます。
イベント指定と単語指示子のセパレータには
.B :
を用います。
単語指示子が
.BR ^ ,
.BR $ ,
.BR * ,
.BR \- ,
.B %
のいずれかで始まる場合には、このセパレータは省略できます。
単語には行の先頭から番号が振られます。
先頭の単語が 0 番目になります。
単語は現在の行に、空白 1 つで区切られて挿入されます。
.PP
.PD 0
.TP
.\"O .B 0 (zero)
.B 0 (ゼロ)
.\"O The zeroth word.  For the shell, this is the command
.\"O word.
0 番目の単語。このシェルにとっては、これはコマンドを表す単語です。
.TP
.I n
.\"O The \fIn\fRth word.
\fIn\fR 番目の単語。
.TP
.B ^
.\"O The first argument.  That is, word 1.
最初の引き数。つまり 1 番目の単語です。
.TP
.B $
.\"O The last argument.
最後の引き数。
.TP
.B %
.\"O The word matched by the most recent `?\fIstring\fR?' search.
`?\fIstring\fR?' 検索にマッチする、一番現在に近い単語。
.TP
.I x\fB\-\fPy
.\"O A range of words; `\-\fIy\fR' abbreviates `0\-\fIy\fR'.
単語の範囲。`0\-\fIy\fR' の省略形として `\-\fIy\fR' が使えます。
.TP
.B *
.\"O All of the words but the zeroth.  This is a synonym
.\"O for `\fI1\-$\fP'.  It is not an error to use
.\"O .B *
.\"O if there is just one
.\"O word in the event; the empty string is returned in that case.
0 番目を除く全ての単語。これは `\fI1\-$\fP' の別表現です。
イベント中に 1 つしか単語が現われないときに
.B *
を使ってもエラーにはなりません。
このような場合には空文字列が返されます。
.TP
.B x*
.\"O Abbreviates \fIx\-$\fP.
\fIx\-$\fP の省略形です。
.TP
.B x\-
.\"O Abbreviates \fIx\-$\fP like \fBx*\fP, but omits the last word.
\fBx*\fP と同様に \fIx\-$\fP の省略形ですが、
ただし最後の単語は含みません。
.PD
.PP
.\"O If a word designator is supplied without an event specification, the
.\"O previous command is used as the event.
イベント指定なしに単語指示子が与えられた場合、
直前のコマンドがイベントとして使われます。
.\"O .SS Modifiers
.SS 修飾子(Modifiers)
.PP
.\"O After the optional word designator, there may appear a sequence of
.\"O one or more of the following modifiers, each preceded by a `:'.
単語指示子 (省略可能) の後には、
以下に示す修飾子を、1 個以上のシーケンスのかたちで置くことができます。
それぞれの修飾子の前には `:' をつけます。
.PP
.PD 0
.PP
.TP
.B h
.\"O Remove a trailing file name component, leaving only the head.
パス名から末尾にある部分 (ファイル名) を取り除き、
前の方 (ディレクトリ部) だけを残します。
.TP
.B t
.\"O Remove all leading file name components, leaving the tail.
パス名から前の方 (ディレクトリ部) を取り除き、
末尾にある部分 (ファイル名) だけを残します。
.TP
.B r
.\"O Remove a trailing suffix of the form \fI.xxx\fP, leaving the
.\"O basename.
末尾にある \fI.xxx\fP 形式のサフィックスを取り除き、
ベース名 (basename) だけを残します。
.TP
.B e
.\"O Remove all but the trailing suffix.
末尾のサフィックスだけを残して、全ての部分を取り除きます。
.TP
.B p
.\"O Print the new command but do not execute it.
新しいコマンドを表示しますが、実行はしません。
.TP
.B q
.\"O Quote the substituted words, escaping further substitutions.
置換が行われた単語をクォートし、それ以上の置換が行われないようにします。
.TP
.B x
.\"O Quote the substituted words as with
.\"O .BR q ,
.\"O but break into words at
.\"O .B blanks
.\"O and newlines.
.B q
と同じように置換後の単語をクォートしますが、
.B 空白文字
と改行文字のところで単語に分割します。
.TP
.B s/\fIold\fP/\fInew\fP/
.\"O Substitute
.\"O .I new
.\"O for the first occurrence of
.\"O .I old
.\"O in the event line.  Any delimiter can be used in place of /.  The
.\"O final delimiter is optional if it is the last character of the
.\"O event line.  The delimiter may be quoted in
.\"O .I old
.\"O and
.\"O .I new
.\"O with a single backslash.  If & appears in
.\"O .IR new ,
.\"O it is replaced by
.\"O .IR old .
イベント行で最初に現われた
.I old
を
.I new
に置き換えます。/ の代わりに任意の区切り文字を使うこともできます。
最後の区切り文字がイベント行の最後の文字ならば、
これは省略できます。
.I old
と
.I new
の中では、
バックスラッシュ 1 つでクォートすれば区切り文字も使えます。
.I new 
に & が含まれている場合には、これは
.I old
に置き換えられます。
.\"O A single backslash will quote the &.  If
.\"O .I old
.\"O is null, it is set to the last
.\"O .I old
.\"O substituted, or, if no previous history substitutions took place,
.\"O the last
.\"O .I string
.\"O in a
.\"O .B !?\fIstring\fR\fB[?]\fR
.\"O search.
バックスラッシュ 1 つを前に置けば & をクォートできます。
.I old
が空文字列ならば、これには前回に置換された
.I old
が設定されます。
以前に履歴置換が全く行われていない場合には、現在に一番近い
.B !?\fIstring\fR\fB[?]\fR
の検索で使われた
.I string
が設定されます。
.TP
.B &
.\"O Repeat the previous substitution.
直前の置換を繰り返します。
.TP
.B g
.\"O Cause changes to be applied over the entire event line.  This is
.\"O used in conjunction with `\fB:s\fP' (e.g., `\fB:gs/\fIold\fP/\fInew\fP/\fR')
.\"O or `\fB:&\fP'.  If used with
.\"O `\fB:s\fP', any delimiter can be used
.\"O in place of /, and the final delimiter is optional
.\"O if it is the last character of the event line.
変更をイベント行全体に適用します。
これは `\fB:s\fP' と組み合わせて使われます
(例:`\fB:gs/\fIold\fP/\fInew\fP/\fR')。
`\fB:s\fP' と一緒に使った場合には、
/ の代わりに任意の区切り文字を使うことができます。
また最後の区切り文字がイベント行の最後の文字ならば、
これは省略できます。
.PD
