.\"O .SH REDIRECTION
.SH リダイレト
.\"O Before a command is executed, its input and output
.\"O may be
.\"O .I redirected
.\"O using a special notation interpreted by the shell.
.\"O Redirection may also be used to open and close files for the
.\"O current shell execution environment.  The following redirection
.\"O operators may precede or appear anywhere within a
.\"O .I simple command
.\"O or may follow a
.\"O .IR command .
.\"O Redirections are processed in the order they appear, from
.\"O left to right.
シェルが解釈する特別な記法を用いて、コマンドの実行前に入出力を
.I リダイレクト
することができます。また、リダイレクトを使うと、現在のシェル実行環
境に対してファイルをオープンまたはクローズすることができます。以下に
示すリダイレクト演算子は
.I 単純なコマンド
の前や途中に置くことができますし、
.I コマンド
の後に置くことができます。リダイレクトは左から右へと
現われた順に処理されます。
.PP
.\"O In the following descriptions, if the file descriptor number is
.\"O omitted, and the first character of the redirection operator is
.\"O .BR < ,
.\"O the redirection refers to the standard input (file descriptor
.\"O 0).  If the first character of the redirection operator is
.\"O .BR > ,
.\"O the redirection refers to the standard output (file descriptor
.\"O 1).
以下の説明においては、ファイル・ディスクリプター番号が省略され、
かつリダイレクト演算子の最初の文字が
.BR <
ならば、リダイレクトは標準入力(ファイル・ディスクリプター 0)を参照します。
リダイレクト演算子の最初の文字が
.BR >
ならば、リダイレクトは標準出力(ファイル・ディスクリプター 1)を参照します。
.PP
.\"O The word following the redirection operator in the following
.\"O descriptions, unless otherwise noted, is subjected to brace expansion,
.\"O tilde expansion, parameter expansion, command substitution, arithmetic
.\"O expansion, quote removal, pathname expansion, and word splitting.
.\"O If it expands to more than one word,
.\"O .B bash
.\"O reports an error.
以下の説明では、リダイレクト演算子の次の単語に対しては、特に説明し
ない限り、ブレース展開、チルダ展開、パラメータ展開、コマンド置換、
算術式展開、クォート削除、パス名展開、単語分割が行われます。
ある単語が複数の単語に展開された場合はエラーになります。
.PP
.\"O Note that the order of redirections is significant.  For example, 
.\"O the command
リダイレクトの順番には意味がある点に注意してください。
例えば、次のコマンド
.RS
.PP
ls \fB>\fP dirlist 2\fB>&\fP1
.RE
.PP
.\"O directs both standard output and standard error to the file 
.\"O .IR dirlist ,
.\"O while the command
は標準出力と標準エラー出力を両方ともファイル
.IR dirlist
に書き込みますが、次のコマンド
.RS
.PP
ls 2\fB>&\fP1 \fB>\fP dirlist
.RE
.PP
.\"O directs only the standard output to file
.\"O .IR dirlist ,
.\"O because the standard error was duplicated as standard output
.\"O before the standard output was redirected to
.\"O .IR dirlist .
では標準出力だけがファイル
.IR dirlist
に書き込まれます。なぜなら後者の場合には、標準エラー出力は
.IR dirlist
にリダイレクトされる前の標準出力の複製となるからです。
です。
.PP
.\"O \fBBash\fP handles several filenames specially when they are used in
.\"O redirections, as described in the following table:
\fBbash\fP はリダイレクトに使用した場合に、以下の表にあるような
いくつかの特別なファイル名指定を扱うことができます。
.RS
.PP
.PD 0
.TP
.B /dev/fd/\fIfd\fP
.\"O If \fIfd\fP is a valid integer, file descriptor \fIfd\fP is duplicated.
\fIfd\fP が有効な整数ならばファイル・ディスクリプター \fIfd\fP が複製されます。
.TP
.B /dev/stdin
.\"O File descriptor 0 is duplicated.
ファイル・ディスクリプター 0 が複製されます。
.TP
.B /dev/stdout
.\"O File descriptor 1 is duplicated.
ファイル・ディスクリプター 1 が複製されます。
.TP
.B /dev/stderr
.\"O File descriptor 2 is duplicated.
ファイル・ディスクリプター 2 が複製されます。
.TP
.B /dev/tcp/\fIhost\fP/\fIport\fP
.\"O If \fIhost\fP is a valid hostname or Internet address, and \fIport\fP
.\"O is an integer port number, \fBbash\fP attempts to open a TCP connection
.\"O to the corresponding socket.
\fIhost\fP が有効なホスト名またはインターネットアドレスで
\fIport\fP が整数のポート番号ならば、\fBbash\fP は対応するソケットに
対して TCP 接続のオープンを試みます。
.TP
.B /dev/udp/\fIhost\fP/\fIport\fP
.\"O If \fIhost\fP is a valid hostname or Internet address, and \fIport\fP
.\"O is an integer port number, \fBbash\fP attempts to open a UDP connection
.\"O to the corresponding socket.
\fIhost\fP が有効なホスト名またはインターネットアドレスで
\fIport\fP が整数のポート番号ならば、\fBbash\fP は対応するソケットに
対して UDP 接続のオープンを試みます。
\" 訳注 UDP connection というのはナンセンス?!?
.PD
.RE
.PP
.\"O A failure to open or create a file causes the redirection to fail.
ファイルのオープンや作成に失敗すると、リダイレクトも失敗します。
.\"O .SS Redirecting Input
.SS 入力のリダイレクト
.PP
.\"O Redirection of input causes the file whose name results from
.\"O the expansion of
.\"O .I word
.\"O to be opened for reading on file descriptor
.\"O .IR n ,
.\"O or the standard input (file descriptor 0) if
.\"O .I n
.\"O is not specified.
入力をリダイレクトすると、
.I word
の展開で得た名前を持つファイルがオープンされ、ファイル・ディスクリプター
.IR n
で読み込めるようになります。
.I n
が指定されていなければ、読み込みは標準入力(ファイル・ディスクリプター 0)で
行われます。
.PP
.\"O The general format for redirecting input is:
入力のリダイレクトは、一般的には以下の形式です:
.RS
.PP
[\fIn\fP]\fB<\fP\fIword\fP
.RE
.\"O .SS Redirecting Output
.SS 出力のリダイレクト
.PP
.\"O Redirection of output causes the file whose name results from
.\"O the expansion of
.\"O .I word
.\"O to be opened for writing on file descriptor
.\"O .IR n ,
.\"O or the standard output (file descriptor 1) if
.\"O .I n
.\"O is not specified.  If the file does not exist it is created;
.\"O if it does exist it is truncated to zero size.
出力をリダイレクトすると、
.I word
の展開で得た名前を持つファイルがオープンされ、ファイル・ディスクリプター
.IR n
で書き込めるようになります。
.I n
が指定されていなければ、読み込みは標準出力(ファイル・ディスクリプター 1)で
行われます。
ファイルが存在しなかった場合は作成されます。ファイルが存在した場合は
サイズ 0 に切り詰められます。
.PP
.\"O The general format for redirecting output is:
出力のリダイレクトは、一般的には以下の形式です:
.RS
.PP
[\fIn\fP]\fB>\fP\fIword\fP
.RE
.PP
.\"O If the redirection operator is
.\"O .BR > ,
.\"O and the
.\"O .B noclobber
.\"O option to the
.\"O .B set
.\"O builtin has been enabled, the redirection will fail if the file
.\"O whose name results from the expansion of \fIword\fP exists and is
.\"O a regular file.
リダイレクト演算子が
.BR >
であり、かつ
.B noclobber
オプションが組み込みコマンド
.B set
に対して設定されている場合、\fIword\fP の展開で得たファイルが存在し、
かつそれが通常ファイルならば、リダイレクトは失敗します。
.\"O If the redirection operator is
.\"O .BR >| ,
.\"O or the redirection operator is
.\"O .B >
.\"O and the
.\"O .B noclobber
.\"O option to the
.\"O .B set
.\"O builtin command is not enabled, the redirection is attempted even
.\"O if the file named by \fIword\fP exists.
リダイレクト演算子が
.BR >|
の場合や、
リダイレクト演算子が
.B >
で組み込みコマンド
.B set
に対する
.B noclobber
オプションが設定されていない場合、\fIword\fP という名前のファイルが
存在していてもリダイレクトが試みられます。
.\"O .SS Appending Redirected Output
.SS リダイレクトによる追加出力
.PP
.\"O Redirection of output in this fashion
.\"O causes the file whose name results from
.\"O the expansion of
.\"O .I word
.\"O to be opened for appending on file descriptor
.\"O .IR n ,
.\"O or the standard output (file descriptor 1) if
.\"O .I n
.\"O is not specified.  If the file does not exist it is created.
この形式を使って出力のリダイレクトを行うと、
.I word
を展開した結果の名前を持つファイルがオープンされ、ファイル・ディスクリプター
.IR n
に対する出力がこのファイルに追加されるようになります。
.I n
を指定しなければ、標準出力(ファイル・ディスクリプター 1)で追加されます。
ファイルが存在しなければ、新しく作られます。
.PP
.\"O The general format for appending output is:
追加出力は一般的には以下の形式です:
.RS
.PP
[\fIn\fP]\fB>>\fP\fIword\fP
.RE
.PP
.\"O .SS Redirecting Standard Output and Standard Error
.SS 標準出力と標準エラー出力のリダイレクト
.PP
.\"O .B Bash
.\"O allows both the
.\"O standard output (file descriptor 1) and
.\"O the standard error output (file descriptor 2)
.\"O to be redirected to the file whose name is the
.\"O expansion of
.\"O .I word
.\"O with this construct.
.B bash
ではこの構造を使って、標準出力(ファイル・ディスクリプター 1)と標準エラー出力
(ファイル・ディスクリプター 2)の両方を、
.I word
を展開して得た名前を持つファイルにリダイレクトさせることができます。
.PP
.\"O There are two formats for redirecting standard output and
.\"O standard error:
標準出力と標準エラー出力に対する形式は 2 つあります:
.RS
.PP
\fB&>\fP\fIword\fP
.RE
.\"O and
および
.RS
\fB>&\fP\fIword\fP
.RE
.PP
.\"O Of the two forms, the first is preferred.
.\"O This is semantically equivalent to
両者のうち望ましいのは前者の方です。これは次のものと同じ意味です:
.RS
.PP
\fB>\fP\fIword\fP 2\fB>&\fP1
.RE
.\"O .SS Here Documents
.SS ヒアドキュメント(Here Documents)
.PP
.\"O This type of redirection instructs the shell to read input from the
.\"O current source until a line containing only
.\"O .I word
.\"O (with no trailing blanks)
.\"O is seen.  All of
.\"O the lines read up to that point are then used as the standard
.\"O input for a command.
このタイプのリダイレクトは現在のソースから入力を読み込むように
シェルに指示します。この読み込みは
.I word
を単独で含む行(末尾にブランク文字があってはなりません)が現われるまで
行われます。その部分までに読み込んだ行は全てあるコマンドに対する
標準入力として使われます。
.PP
.\"O The format of here-documents is as follows:
ヒアドキュメントの形式を以下に示します:
.RS
.PP
.nf
\fB<<\fP[\fB\-\fP]\fIword\fP
        \fIhere\-document\fP
\fIdelimiter\fP
.fi
.RE
.PP
.\"O No parameter expansion, command substitution, arithmetic expansion,
.\"O or pathname expansion is performed on
.\"O .IR word .
.IR word
に対するパラメータ展開、コマンド置換、算術式展開、パス名展開は
全く行われません。
.\"O If any characters in
.\"O .I word
.\"O are quoted, the
.\"O .I delimiter
.\"O is the result of quote removal on
.\"O .IR word ,
.\"O and the lines in the here-document are not expanded.
.I word
が一部でもクォートされている場合、
.I delimiter
には
.IR word
のクォートを削除した結果を使用し、
ヒアドキュメントに含まれる行の展開は行われません。
.\"O If \fIword\fP is unquoted,
.\"O all lines of the here-document are subjected to parameter expansion,
.\"O command substitution, and arithmetic expansion.  In the latter
.\"O case, the character sequence
.\"O .B \e<newline>
.\"O is ignored, and
.\"O .B \e
.\"O must be used to quote the characters
.\"O .BR \e ,
.\"O .BR $ ,
.\"O and
.\"O .BR ` .
\fIword\fP がクォートされていなければ、ヒアドキュメント中の全ての行に
対してパラメータ展開、コマンド置換、算術式展開が行われます。
後者の場合には、
.B \e<newline>
の組み合わせは無視され、
.BR \e ,
.BR $ ,
.BR `
をクォートするためには
.B \e
を使わなければなりません。
.PP
.\"O If the redirection operator is
.\"O .BR <<\- ,
.\"O then all leading tab characters are stripped from input lines and the
.\"O line containing
.\"O .IR delimiter .
リダイレクト演算子が
.BR <<\-
ならば、行頭にあるタブ文字は全て入力行および
.IR delimiter
を含む行から取り除かれます。
.\"O This allows
.\"O here-documents within shell scripts to be indented in a
.\"O natural fashion.
これにより、シェルスクリプト中のヒアドキュメントを自然な形でインデント
させることができます。
.\"O .SS "Duplicating File Descriptors"
.SS ファイル・ディスクリプターの複製
.PP
.\"O The redirection operator
リダイレクト演算子
.RS
.PP
[\fIn\fP]\fB<&\fP\fIword\fP
.RE
.PP
.\"O is used to duplicate input file descriptors.
を使って入力ファイル・ディスクリプターを複製できます。
.\"O If
.\"O .I word
.\"O expands to one or more digits, the file descriptor denoted by
.\"O .I n
.\"O is made to be a copy of that file descriptor.
.I word
が 1 桁以上の数値に展開された場合、
.I n
で示されるファイル・ディスクリプターが生成され、
そのファイル・ディスクリプターのコピーとなります。
.\"O If the digits in
.\"O .I word
.\"O do not specify a file descriptor open for input, a redirection error occurs.
.I word
に含まれる数値が入力のためにオープンされたファイル・ディスクリプターを
指していない場合、リダイレクト・エラーが起きます。
.\"O If
.\"O .I word
.\"O evaluates to
.\"O .BR \- ,
.\"O file descriptor
.\"O .I n
.\"O is closed.  If
.\"O .I n
.\"O is not specified, the standard input (file descriptor 0) is used.
.I word
を評価した結果が
.BR \-
となった場合、ファイル・ディスクリプター
.I n
はクローズされます。
.I n
が指定されていない場合、標準入力(ファイル・ディスクリプター 0)が使われます。
.PP
.\"O The operator
同様に、演算子
.RS
.PP
[\fIn\fP]\fB>&\fP\fIword\fP
.RE
.PP
.\"O is used similarly to duplicate output file descriptors.  If
.\"O .I n
.\"O is not specified, the standard output (file descriptor 1) is used.
を使って出力ファイル・ディスクリプターを複製することができます。
.I n
が指定されていない場合は、標準出力(ファイル・ディスクリプター 1)が使われます。
.\"O If the digits in
.\"O .I word
.\"O do not specify a file descriptor open for output, a redirection error occurs.
.\"O As a special case, if \fIn\fP is omitted, and \fIword\fP does not
.\"O expand to one or more digits, the standard output and standard
.\"O error are redirected as described previously.
.I word
に含まれる数値が、出力のためにオープンされたファイル・ディスクリプターを
指していない場合、リダイレクト・エラーが起きます。特別な場合ですが、
\fIn\fP が省略され、かつ \fIword\fP が 1 桁以上の数字には展開されなかっ
た場合、前に説明したように標準出力と標準エラー出力がリダイレクトされます。
.\"O .SS "Opening File Descriptors for Reading and Writing"
.SS 読み書きのためのファイル・ディスクリプターのオープン
.PP
.\"O The redirection operator
リダイレクト演算子が
.RS
.PP
[\fIn\fP]\fB<>\fP\fIword\fP
.RE
.PP
.\"O causes the file whose name is the expansion of
.\"O .I word
.\"O to be opened for both reading and writing on file descriptor
.\"O .IR n ,
.\"O or on file descriptor 0 if
.\"O .I n
.\"O is not specified.  If the file does not exist, it is created.
ならば、
.I word
を展開した結果の名前を持つファイルがファイル・ディスクリプター
.IR n
での読み書きのためにオープンされます。
.I n
が指定されていなければ、ファイル・ディスクリプター 0 で読み書きが行われます。
ファイルが存在しなければ、新しく生成されます。
.\"O .SH ALIASES
.SH エイリアス
.\"O \fIAliases\fP allow a string to be substituted for a word when it is used
.\"O as the first word of a simple command.
\fIエイリアス(alias)\fP を使うと、ある単語が単純なコマンドの先頭の
単語として使われた場合に、この文字列を別の単語に置換することができます。
.\"O The shell maintains a list of aliases that may be set and unset with the
.\"O .B alias
.\"O and
.\"O .B unalias
.\"O builtin commands (see
.\"O .SM
.\"O .B SHELL BUILTIN COMMANDS
.\"O below).
シェルはエイリアスのリストを管理しています。
このリストは組み込みコマンドの
.B alias
と
.B unalias
を使って設定および設定の取り消しを行うことができます(後述の
.SM
.B シェルの組み込みコマンド
を参照)。
.\"O The first word of each command, if unquoted,
.\"O is checked to see if it has an
.\"O alias.  If so, that word is replaced by the text of the alias.
各コマンドの最初の単語がクォートされていない場合、
エイリアスかどうか確認され、エイリアスならばその単語は
そのエイリアスのテキトスと置換されます。
.\"O The alias name and the replacement text may contain any valid
.\"O shell input, including the
.\"O .I metacharacters
.\"O listed above, with the exception that the alias name may not
.\"O contain \fI=\fP.  The first word of the replacement text is tested
.\"O for aliases, but a word that is identical to an alias being expanded
.\"O is not expanded a second time.  This means that one may alias
.\"O .B ls
.\"O to
.\"O .BR "ls \-F" ,
.\"O for instance, and
.\"O .B bash
.\"O does not try to recursively expand the replacement text.
エイリアス名と置換されるテキストには、シェルの入力として有効なものは何
でも含めることができます。これには先に挙げた
.I メタ文字
も含まれますが、エイリアス名には \fI=\fP を含めることができないという
例外があります。置換されるテキストの最初の単語はエイリアスを
評価されますが、最初の単語が展開されるエイリアスと同じ場合には、
展開は 1度しか行われません。つまり、
.B ls
が
.BR "ls \-F"
のエイリアスとなっているような場合には、
.B bash
は置換される文字列を再帰的に展開することはありません。
.\"O If the last character of the alias value is a
.\"O .IR blank ,
.\"O then the next command
.\"O word following the alias is also checked for alias expansion.
エイリアスの値の最後の文字が
.IR ブランク文字
の場合、エイリアスに続く次のコマンドの単語に対しても
エイリアス展開が試みられます。
.PP
.\"O Aliases are created and listed with the
.\"O .B alias
.\"O command, and removed with the
.\"O .B unalias
.\"O command.
エイリアスは
.B alias
コマンドで作成とリスト表示を行い、
.B unalias
コマンドで削除します。
.PP
.\"O There is no mechanism for using arguments in the replacement text.
.\"O If arguments are needed, a shell function should be used (see
.\"O .SM
.\"O .B FUNCTIONS
.\"O below).
置換されるテキストに引き数を入れる仕組みはありません。引き数が必要なら
ば、シェル関数を使わなければなりません(後述の
.SM
.B 関数
を参照)
.PP
.\"O Aliases are not expanded when the shell is not interactive, unless
.\"O the
.\"O .B expand_aliases
.\"O shell option is set using
.\"O .B shopt
.\"O (see the description of
.\"O .B shopt
.\"O under
.\"O .SM
.\"O \fBSHELL BUILTIN COMMANDS\fP
.\"O below).
シェルが対話的でない時には、
.B shopt
コマンドを使用して
.B expand_aliases
オプションが設定されていない限りエイリアスの展開は行われません(後述の
.SM
\fBシェルの組み込みコマンド\fP
における
.B shopt
の説明を参照してください)。
.PP
.\"O The rules concerning the definition and use of aliases are
.\"O somewhat confusing.
エイリアスの定義や利用に関係する規則には、紛らわしい点があります。
.\"O .B Bash
.\"O always reads at least one complete line
.\"O of input before executing any
.\"O of the commands on that line.  Aliases are expanded when a
.\"O command is read, not when it is executed.  Therefore, an
.\"O alias definition appearing on the same line as another
.\"O command does not take effect until the next line of input is read.
.B bash
は、ある行に書かれているコマンドを実行する前に必ず、少なくとも 1 回は
行全体を読み込みます。エイリアスが展開されるのはコマンドを
読み込んだ時であり、実行する時ではありません。
したがって、別のコマンドと同じ行でエイリアス定義を行った場合には、
次の入力行が読み込まれるまではエイリアスの効果は現われません。
.\"O The commands following the alias definition
.\"O on that line are not affected by the new alias.
同じ行にあるエイリアス定義の後のコマンドは、新しいエイリアスの影響を
受けません。
.\"O This behavior is also an issue when functions are executed.
この動作は関数を実行する場合にも問題になります。
.\"O Aliases are expanded when a function definition is read,
.\"O not when the function is executed, because a function definition
.\"O is itself a compound command.  As a consequence, aliases
.\"O defined in a function are not available until after that
.\"O function is executed.  To be safe, always put
.\"O alias definitions on a separate line, and do not use
.\"O .B alias
.\"O in compound commands.
エイリアスが展開されるのは関数定義が読み込まれる時であり、
関数が実行される時ではありません。
なぜなら、関数定義自身も複合コマンドだからです。
その結果として、関数内で定義されたエイリアスは、その関数の実行されるまでは
利用できません。安全のため、エイリアス定義は独立した行で行うべきです。
複合コマンド内で
.B alias
を使ってはいけません。
.PP
.\"O For almost every purpose, aliases are superseded by
.\"O shell functions.
ほとんど全ての場合に、エイリアスの代わりにシェル関数を使うことができます。
