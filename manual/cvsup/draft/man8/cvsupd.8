.\" Copyright 1996, 1997, 1998, 1999 John D. Polstra.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgment:
.\"      This product includes software developed by John D. Polstra.
.\" 4. The name of the author may not be used to endorse or promote products
.\"    derived from this software without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
.\" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
.\" NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
.\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.\" $Id: cvsupd.8,v 1.34 1999/12/10 05:31:36 jdp Exp $
.\"
.\" Originally translated
.\"         by Issei Suzuki <issei@issei.org>
.\" Updated Sun Jan 23 03:13:03 JST 2000 to match cvsupd.8 included in cvsup-16.1
.\"         by FUJIWARA Teruyoshi <fujiwara@linux.or.jp>
.\"
.\" WORD: access file	アクセス制御ファイル
.\"
.Dd August 31, 1999
.Os FreeBSD
.Dt CVSUPD 8
.\"O .Sh NAME
.Sh 名称
.Nm cvsupd
.\"O .Nd network distribution server for CVS repositories
.Nd ネットワーク上で CVS レポジトリを配布するためのサーバ
.\"O .Sh SYNOPSIS
.Sh 書式
.Nm
.Op Fl ev
.Op Fl A Ar addr
.Op Fl b Ar base
.Op Fl c Ar collPath
.Op Fl C Ar maxClients
.Op Fl l Ar log
.Op Fl p Ar port
.Op Fl P Ar range
.Op Fl s Ar scanDir
.Op Fl Z Ar comprLevel
.\"O .Sh DESCRIPTION
.Sh 解説
.\"O .Nm
.\"O is the server program for the
.\"O .Nm CVSup
.\"O network distribution package.
.Nm
はネットワーク配布のためのパッケージである
.Nm CVSup
のサーバプログラムです。
.\"O For information about the companion client program, see
.\"O .Xr cvsup 1 .
サーバと組み合わせて動作するクライアントプログラム
に関しては
.Xr cvsup 1
を参照してください。
.Pp
.\"O In normal usage,
.\"O .Nm
.\"O should be started with the
.\"O .Ql Fl C Ar maxClients
.\"O option.  It runs as a background daemon, fielding connection requests
.\"O from remote clients.  For each connection,
.\"O .Nm
.\"O forks a child process to serve the files requested by the client.
通常使用時には
.Nm
に
.Ql Fl C Ar maxClients
オプションを指定して実行しなければなりません。
.Nm
はバッググラウンドデーモンとして実行され、
リモートクライアントからの接続要求に対応します。それぞれの接続について
.Nm
は子プロセスを fork し、クライアントが要求したファイルを送ります。
.Pp
.\"O The following options are supported:
以下のオプションがサポートされています:
.Bl -tag -width Fl
.It Fl A Ar addr
.\"O Specifies a local address (dotted quad or hostname) on which the
.\"O server will accept connections.  This may be useful on hosts which
.\"O have multiple IP addresses.
サーバが接続を受け付ける(accept)するローカルのアドレス(IP アドレス
またはホスト名)を指定します。このオプションは複数個の IP アドレスを持つ
ホストで役立つでしょう。
.It Fl b Ar base
.\"O Uses
.\"O .Ar base
.\"O as the base directory for the configuration files.
.Ar base
を設定ファイルの起点ディレクトリとして使います。
.\"O The default is
.\"O .Pa /usr/local/etc/cvsup .
デフォルト値は
.Pa /usr/local/etc/cvsup
です。
.It Fl c Ar collPath
.\"O Searches the specified directories for information about the collections
.\"O being offered.
提供されるコレクションに関する情報を得るために、指定されたディレクトリを
検索します。
.\"O .Ar collPath
.\"O contains of one or more directory names, separated by colons.
.Ar collPath
は 1 つのディレクトリ、もしくはコロンで区切った複数のディレクトリを
含みます。
.\"O Non-absolute pathnames are interpreted relative to the base
.\"O directory.
絶対パスで指定されていない場合は、起点ディレクトリからの相対パスと解釈
されます。
.\"O The default search path is
.\"O .Ql sup .
デフォルトの検索パスは
.Ql sup
です。
.It Fl C Ar maxClients
.\"O Limits the number of simultaneous clients to
.\"O .Ar maxClients .
同時に接続できるクライアントの数を
.Ar maxClients
に制限します。
.\"O Clients beyond the specified maximum are politely refused service.
指定した最大数を超えた場合、クライアントはサービスを丁寧に
断わられます。
.Pp
.\"O If this option is not specified,
.\"O .Nm
.\"O serves one client in the foreground and then exits.
このオプションが指定されていない場合、
.Nm
はフォアグラウンドで動作して 1 クライアントに対してのみサービスを行い、
それが終わると終了します。
.It Fl e
.\"O Suppresses the redirection of the standard output and standard
.\"O error when running as a daemon and logging to a syslog facility.
デーモンモードで動作している場合に、標準出力と標準エラー出力への
メッセージのリダイレクトを抑制し、syslog を用いてログを記録します。
.\"O Otherwise, these descriptors are redirected to
.\"O .Pa /dev/null .
このオプションを設定しない場合、標準出力と標準エラー出力は
.Pa /dev/null
にリダイレクトされます。
.\"O This option is useful for capturing any panic messages which might
.\"O be emitted in the rare event of a crash of the server.
このオプションは、サーバのクラッシュのような滅多にないパニックの際の
メッセージを押さえるのに役立ちます。
.\"O Such messages are very helpful for debugging, but there
.\"O is no reliable way to send them to syslog.
こういったメッセージはデバッグに非常に有用ですが、それらを syslog に送
るための確実な方法がないためです。
.\"O A recommended way to use the option is like this:
.\"O .Dl cvsupd -e ... >>/var/tmp/cvsupd.out 2>&1
.\"O assuming that the command line syntax of
.\"O .Xr sh 1
.\"O is used.
このオプションのお勧めの使い方は次のようなものです:
.Dl cvsupd -e ... >>/var/tmp/cvsupd.out 2>&1
ただし、このコマンドラインでは
.Xr sh 1
の表記を使っています。
.It Fl l Ar log
.\"O Directs log messages to
.\"O .Ar log .
ログメッセージを
.Ar log
に書き出します。
.\"O If
.\"O .Ar log
.\"O is of the form
.\"O .Cm @ Ns Ar facility
.\"O (e.g.,
.\"O .Ql @local0 )
.\"O then logging is done via syslog to the indicated facility.
.Ar log
が
.Cm @ Ns Ar facility
(例 
.Ql @local0 )
のような形式で指定された場合、ロギングは指定された facility を使い
syslog 経由で行われます。
.\"O Otherwise,
.\"O .Ar log
.\"O is treated as the name of a log file.
そうでない場合、
.Ar log
はログファイルの名前として扱われます。
.\"O If the file
.\"O already exists, new messages are appended to its end.
そのファイルがすでに存在している場合には、新しいメッセージはファイルの最
後に追加されます。
.Pp
.\"O For each client served, at least two messages are logged.  The first
.\"O message identifies the client by username and hostname.  The last
.\"O message reports the success or failure of the update and gives the
.\"O total network I/O in Kbytes (1K = 1024).  Additional messages may be
.\"O emitted to report errors or other noteworthy conditions.
サービスを受ける各クライアントについて、少なくとも 2 つのメッセージが
記録されます。最初のメッセージはユーザ名とホスト名でクライアントを
識別します。最後のメッセージは更新の成功・失敗と、合計のネットワーク I/O 
の量をキロバイト単位(1K = 1024)で報告します。エラーやその他の知らせる
べき状態を知らせるために、この 2 つ以外のメッセージが送られることがあ
ります。
.\" FIXME - default
.It Fl p Ar port
.\"O Listens for connections on an alternate TCP port.
サーバが接続を待ち受ける(listen する) TCP ポートを指定します。
.\"O The default port is 5999.
デフォルト値は 5999 です。
.\"O When not in passive mode, the server also uses the next lower port
.\"O to establish a second
.\"O connection (called the data connection) back to the client.
パッシブモードでない場合には、サーバからクライアントに向かって張る 2
番目の接続(データ接続と呼ばれます)のために、サーバはこれより 1 つ小さ
い番号のポートも使います。
.It Fl P Ar range
.\"O Sets the range of server TCP ports to be used for the data connection,
.\"O when in passive mode.
パッシブモードの時にデータ接続に使うサーバ側の TCP ポートの範囲を指定
します。
.\"O .Ar Range
.\"O may be a single integer or a range given as
.\"O .Ql lo-hi .
.Ar 範囲
は単一の整数もしくは
.Ql lo-hi
の範囲のどちらかの形で指定できます。
.It Fl s Ar scanDir
.\"O Enables mirror mode, and specifies the directory under which the scan
.\"O files can be found.  If it is not an absolute pathname,
.\"O .Ar scanDir
.\"O is interpreted relative to the base directory.  See
.\"O .Sx RUNNING A CVSup MIRROR SITE ,
.\"O below.
ミラーモードを有効にし、scan ファイルがあるディレクトリを指定します。
.Ar scanDir
が絶対パスで指定されていなければ、これは起点ディレクトリからの相対パス
と解釈されます。後述の
.Sx CVSup を使ったミラーサイトの運用
をご覧ください。
.It Fl v
.\"O Prints the version number and exits, without serving any clients.
バージョン番号を表示して終了します。クライアントには何も提供しません。
.It Fl Z Ar comprLevel
.\"O Sets the compression level to
.\"O .Ar comprLevel .
圧縮レベルを
.Ar comprLevel
に設定します。
.\"O The compression level must be between 0 and 9.
圧縮レベルは 0 から 9 の間で指定します。
.\"O A level of 0 means no compression, while 9 provides maximum compression.
レベル 0 では圧縮は行われず、9 で圧縮率が最大となります。
.\"O The default level is 1.
デフォルトの圧縮レベルは 1 です。
.\"O Higher levels provide relatively little improvement, at a rather high
.\"O cost in CPU cycles.
これよりも高い圧縮レベルを使っても、CPU パワーが大幅に消費される割には
ファイルサイズはほとんど改善されません。
.El
.\"O .Sh PREPARING A FILE COLLECTION REPOSITORY
.Sh ファイルコレクションレポジトリを準備する
.\"O The file collections which
.\"O .Nm
.\"O makes available to clients are described by various configuration files.
.Nm
がクライアントに提供するファイルコレクションは、様々な設定ファイルで記述
します。
.\"O The configuration files reside under the directory
.\"O .Sm off
.\"O .Ar base / Ar collDir ,
.\"O .Sm on
.\"O where
.\"O .Ar base
.\"O is the directory specified by the
.\"O .Fl b Ar base
.\"O command line option, or
.\"O .Pa /usr/local/etc/cvsup
.\"O by default.
設定ファイルは
.Sm off
.Ar base / Ar colldir
.Sm on
ディレクトリ下に置きます。ここで
.Ar base
は
.Fl b Ar base
コマンドラインオプションで指定されたもの、もしくはデフォルト値の
.Pa /usr/local/etc/cvsup
です。
.\"O .Ar collDir
.\"O is any of the directories specified with the
.\"O .Fl c
.\"O option, or
.\"O .Ql sup
.\"O by default.
.Ar collDir
は
.Fl c
オプションで指定されたディレクトリのいずれか、もしくはデフォルト値の
.Ql sup
です。
.Pp
.\"O Each collection's configuration files are kept in a separate
.\"O subdirectory of
.\"O .Sm off
.\"O .Ar base / Ar collDir ,
.\"O .Sm on
.\"O named after the collection itself.
各コレクションの設定ファイルは、
.Sm off
.Ar base / Ar collDir
.Sm on
下に作ったコレクション名と同名のサブディレクトリに個別に置かれます。
.\"O For example, the configuration for the
.\"O .Ql src-base
.\"O collection would be found in
.\"O .Sm off
.\"O .Ar base / Ar collDir Pa /src-base .
.\"O .Sm on
例えば
.Ql src-base
コレクションの設定ファイルは
.Sm off
.Ar base / Ar collDir Pa /src-base
.Sm on
に置かれます。
.\"O Within the collection's subdirectory, there should be a
.\"O .Pa releases
.\"O file and a list file.
コレクションのサブディレクトリ中には、
.Pa releases
ファイルとリストファイルが置かれます。
.\"O The
.\"O .Pa releases
.\"O file contains one line per release.
.Pa releases
ファイルはリリースごとに一行の記述を含みます。
.\"O The first word of each line is the name of the release, e.g.,
.\"O .Ql cvs .
各行の最初の語はリリース名です。例えば
.Ql cvs
となります。
.\"O That must be followed by the following phrases, in any order:
その後には、順不同で以下のようなフレーズが続きます:
.Bl -tag -width Fl
.It Cm list= Ns Ar file
.\"O Specifies the name of the list file, relative to the collection's
.\"O subdirectory.  The list file is described below.
リストファイルの名前を、コレクションのサブディレクトリに対する相対パス
で指定します。リストファイルについては後ほど説明します。
.It Cm prefix= Ns Ar directory
.\"O Specifies where the files making up the collection are to be found.
コレクションを構成するファイルのある場所を指定します。
.\"O If
.\"O .Ar directory
.\"O is not an absolute pathname, it is interpreted relative to the base
.\"O directory
.\"O .Ar base .
もし
.Ar directory
が絶対パスでなければ、起点ディレクトリ
.Ar base
からの相対パスと見なされます。
.\"O If there is no
.\"O .Cm prefix
.\"O clause, the prefix defaults to
.\"O .Ar base .
.Cm prefix
が指定されていない場合のデフォルト値は
.Ar base
です。
.It Cm keywordprefix= Ns Ar directory
.\"O Specifies a
.\"O .Dq pseudo-prefix
.\"O which is used only for expanding the absolute pathnames for the
.\"O .Ql $\&Header$
.\"O and
.\"O .Ql $\&Source$
.\"O RCS keywords.
.Dq 仮想プレフィックス
を指定します。これは RCS のキーワードである
.Ql $\&Header$
と
.Ql $\&Source$
を絶対パスに展開するためにのみ用いられます。
.\"O The
.\"O .Ar directory
.\"O should normally be the absolute pathname of the CVS repository on the
.\"O machine containing the master copy of the repository.
普通は、
.Ar direcotry
はマスターの CVS レポジトリを持っているマシンにおける、その
CVS レポジトリの絶対パスです。
.\"O The use of
.\"O .Cm keywordprefix
.\"O ensures that
.\"O .Nm CVSup
.\"O will expand the RCS keywords identically on all machines, even though
.\"O the repositories may reside in different directories.
.Cm keywordprefix
を用いると、
.Nm CVSup
は必ず、
実際のレポジトリの位置によらず全てのマシン上で RCS 
キーワードを同一の形に展開します。
.It Cm super= Ns Ar collection
.\"O Specifies the immediate super-collection of the current collection.
現在のコレクションの直接のスーパーコレクションを指定します。
.\"O In large distributions, the collections are often organized in a
.\"O hierarchical manner.  At the top of the hierarchy is a collection
.\"O containing all of the distributed files.  At the next level are
.\"O several sub-collections, each containing a subset of the files.
配布物が大きな場合には、コレクションに階層を持たせてまとめることがよく
あります。最も上の階層は、配布されている全てのファイルを含む
コレクションです。次の階層はいくつかのサブコレクションからなり、それぞ
れは全体のファイルの部分集合となります。
.\"O Each sub-collection may in turn have further sub-collections, and so
.\"O forth.  The
.\"O .Cm super
.\"O keyword specifies the collection's parent in such a hierarchical
.\"O arrangement.
各サブコレクションは自分の下にサブコレクションを持てますし、それ以降も
同様です。
.Cm super
キーワードは、こういった階層的な配置において、そのコレクションの
親コレクションを指定します。
.Pp
.\"O This keyword is optional.  If it is omitted,
.\"O .Nm
.\"O assumes nothing about the relationship between the current
.\"O collection and the other available collections.
このキーワードは省略してもかまいません。省略された場合には、
.Nm
は現在のコレクションと利用可能な他のコレクションの間に
何の関連もないとみなします。
.Pp
.\"O Information from the
.\"O .Cm super
.\"O keywords is used for finding the appropriate scan files when the
.\"O server is running as a mirror site.  See
.\"O .Sx RUNNING A CVSup MIRROR SITE .
.Cm super
キーワードから得た情報は、サーバがミラーサイトとして動作している時に、
適切な scan ファイルを見つけるために使われます。
.Sx CVSup を使ったミラーサイトの運用
をご覧ください。
.It Cm nocheckrcs
.\"O Disables the comparison of MD5 checksums for updated RCS files.
更新される RCS ファイル群について、MD5 チェックサムの比較を行いません。
.\"O Checksum mismatches for RCS files may not be meaningful, since a given
.\"O logical RCS file can have many different textual renditions.
RCS ファイルにおけるチェックサムの不一致は意味を持ちません。なぜなら、
ある論理的な意味を持った RCS ファイルには、テキストとしての表現はたく
さんあるからです。
.It Cm norcs
.\"O Disables special processing for RCS files.  They will be treated the
.\"O same as other files.
RCS ファイルを特別扱いしません。RCS ファイルを他のファイルと同様に扱い
ます。
.It Cm norsync
.\"O Disables the use of the
.\"O .Em rsync
.\"O algorithm.
.Em rsync
アルゴリズムを使わないようにします。
.\"O .Sy Note:
.Sy 注意:
.\"O this keyword is deprecated in the
.\"O .Pa releases
.\"O file.  Use
.\"O .Cm norsync
.\"O or
.\"O .Cm rnorsync
.\"O in the list file instead.  (See below.)
このキーワードを
.Pa releases
ファイルで使うのは古いやり方です。これを使わないでリストファイル内で
.Cm norsync
または
.Cm rnorsync
を使ってください(後述)。
.El
.Pp
.\"O Unrecognized phrases are accepted but ignored, for backward
.\"O compatibility with the
.\"O .Nm sup
.\"O package.
認識できないキーワードは受け付けられますが、無視されます。
これは
.Xr sup 1
パッケージとの後方互換性のためです。
.\"O Note that even though
.\"O .Nm
.\"O often serves only a single release, the
.\"O .Pa releases
.\"O file is still required.
.Nm
が提供するリリースが 1 つだけであっても、
.Pa releases
ファイルは必要であることを覚えておいてください。
.Pp
.\"O The list file specifies the details of how to upgrade the client's
.\"O version of the collection.
リストファイルは、クライアントのコレクションのバージョンを更新する方法
を詳しく指定します。
.\"O Each line contains a single command.  Blank lines are ignored, as are
.\"O lines beginning with
.\"O .Ql # .
各行には 1 つだけコマンドが書かれます。空行と
.Ql #
から始まる行は無視されます。
.\"O Any filenames specified are taken as relative to the
.\"O .Cm prefix
.\"O directory given in the
.\"O .Pa releases
.\"O file.
指定される全てのファイル名は
.Pa releases
内で指定されている
.Cm prefix
ディレクトリからの相対パスとして扱われます。
.Pp
.\"O Many of the list file commands accept file name patterns as
.\"O arguments.
リストファイルのコマンドの多くは、ファイル名のパターンを引数として
受け付けます。
.\"O These are similar to the patterns accepted by
.\"O .Xr sh 1 ,
.\"O and may include the wild card constructs
.\"O .Ql * ,
.\"O .Ql ? ,
.\"O and
.\"O .Ql [...] .
このパターンは
.Xr sh 1
が受け付けるパターンに似ており、
.Ql * ,
.Ql ? ,
.Ql [...]
を組み合わせたワイルドカードが使えます。
.\"O With the exception of
.\"O .Cm omitany
.\"O patterns, any slash characters in file names must be matched
.\"O explicitly by slash characters in the pattern.
.Cm omitany
パターンだけは例外ですが、その他の場合には、ファイル名に含まれる
スラッシュ文字は、パターン中のスラッシュ文字とだけマッチします。
.\"O Leading periods in file names are not treated specially.
.\"O For example, the pattern
.\"O .Ql *
.\"O matches the filename
.\"O .Ql .profile .
例えば
.Ql *
は
.Ql .prifole
というファイル名にマッチします。
.Bl -tag -width Fl
.It Cm upgrade Ar pattern ...
.\"O All files and directories matching any of the given patterns
.\"O will be included in the list of files to be upgraded.
与えられたパターンのいずれかにマッチした、すべてのファイルとディレクトリ
が更新ド対象のリストに含められます。
.\"O If a directory name is matched, it recursively includes all
.\"O files and subdirectories within it.
ディレクトリ名がマッチした場合、その中にある全てのファイルと
サブディレクトリが再帰的に含まれます。
.It Cm always Ar pattern ...
.\"O This command is the same as
.\"O .Cm upgrade ,
.\"O except that it overrides any
.\"O .Cm omitany
.\"O commands.
このコマンドは、全ての
.Cm omitany
コマンドを上書きすることを除いて、
.Cm upgrade
コマンドと同一です。
.It Cm omitany Ar pattern ...
.\"O Files or directories matching any of the given patterns will be
.\"O omitted from the upgrade.  If a directory name is matched,
.\"O then it and all files and subdirectories beneath it are omitted.
与えられたパターンのいずれかにマッチした、すべてのファイルとディレクトリ
は更新対象のリストから除外されます。
ディレクトリ名がマッチした場合、その中にある全てのファイルと
サブディレクトリが除外されます。
.Pp
.\"O The patterns for
.\"O .Cm omitany
.\"O are interpreted differently than other patterns.  For normal
.\"O patterns, a slash character in a pathname must be matched explicitly
.\"O by a slash character in the pattern.  For
.\"O .Cm omitany
.\"O patterns, slashes are treated the same as other characters.
.Cm omitany
に対するパターンの解釈は他のパターンと異なります。
一般のパターンでは、パス名に含まれるスラッシュ文字はパターン中の
スラッシュ文字にのみマッチしますが、
.Cm omitany
に与えるパターンでは、スラッシュ文字は他の文字と同じように扱われます。
.\"O Thus the pattern
.\"O .Ql *.c
.\"O will match any pathname ending in
.\"O .Ql \&.c ,
.\"O including, for example,
.\"O .Ql foo/bar/lam.c .
したがって、
.Ql *.c
は
.Ql \&.c
で終わるすべてのパス名にマッチします。例えば
.Ql foo/bar/lam.c
も含まれます。
.It Cm symlink Ar pattern ...
.\"O Symbolic links matching any of the given patterns will be upgraded
.\"O as symbolic links, rather than as the files they refer to.
与えられたパターンのいずれかにマッチしたシンボリックリンクは、その
シンボリックリンクが指すファイルとしてではなく、シンボリックリンクとし
てアップグレードされます。
.\"O Otherwise, symbolic links are followed and their target files are
.\"O sent to the client.
この指定がない場合、シンボリックリンクのリンク先が参照され、リンクが指
すファイルがクライアントに送られます。
.It Cm rsymlink Ar pattern ...
.\"O This command is similar to
.\"O .Cm symlink ,
.\"O but if a directory is matched, all symbolic links beneath it in the
.\"O tree are treated as matched.
このコマンドは
.Cm symlink
に似ていますが、もしディレクトリがマッチした場合、そのディレクトリ
ツリー以下のすべてのシンボリックリンクもマッチしたものとして扱われます。
.It Cm norsync Ar pattern ...
.\"O The rsync algorithm will not be used for updating files matching any
.\"O of the given patterns.  This is useful for log files, where
.\"O .Nm CVSup Ns "'s"
.\"O .Dq append
.\"O optimization is more effective than the rsync algorithm.
与えられたパターンのいずれかにマッチしたファイルの更新において、rsync 
アルゴリズムが使われません。この指定はログファイルで役立ちます。
というのも、
.Nm
の
.Dq append
最適化の方が rsync アルゴリズムよりも効率的だからです。
.It Cm rnorsync Ar pattern ...
.\"O This command is similar to
.\"O .Cm norsync ,
.\"O but if a directory is matched, all files beneath it in the tree are
.\"O treated as matched.
このコマンドは
.Cm norsync
に似ていますが、もしディレクトリがマッチした場合、そのディレクトリ
ツリー以下の全てのファイルがマッチしたものとして扱われます。
.It Cm execute Ar command Pq Ar pattern ...
.\"O The given
.\"O .Ar command
.\"O will be executed by the client whenever a file matching one of the
.\"O .Ar pattern Ns s
.\"O is successfully updated.
.Ar pattern
の 1 つにマッチするファイルの更新が成功したときに、指定された
.Ar command
がクライアントによって実行されます。
.\"O The
.\"O .Ar command
.\"O comprises all words up to the first
.\"O .Ql (
.\"O character.  Any occurrences of the string
.\"O .Ql %s
.\"O are replaced by the pathname of the updated file on the client host.
.Ar command
は、最初の
.Ql (
までの全ての語からなります。
.Ql %s
という文字列はすべて、クライアントホストで更新されたファイルのパス名に
置き換えられます。
.\"O Occurrences of
.\"O .Ql %%
.\"O are replaced by
.\"O .Ql % .
存在する
.Ql %%
はすべて
.Ql %
に置き換えられます。
.\"O The command is executed by passing it to
.\"O .Pa /bin/sh .
コマンドは文字列を
.Pa /bin/sh
に渡すことで実行されます。
.Pp
.\"O There may be multiple patterns, separated by white space.
空白文字で区切って複数のパターンを指定することができます。
.\"O They are interpreted relative to the
.\"O .Cm prefix
.\"O directory.
それらのファイルは
.Cm prefix
ディレクトリからの相対パスとして解釈されます。
.\"O Each pattern should be written to match the appropriate files as they
.\"O exist on the
.\"O .Em server .
それぞれのパターンは、ファイルが
.Em server
上に存在する場合でも適切なファイルにマッチするように記述しなければなり
ません。
.\"O For example, the
.\"O .Ql ,v
.\"O suffix of an RCS file name must be matched, even though that suffix
.\"O will not be present on the client if checkout mode is in effect.
例えば RCS ファイル名の
.Ql ,v
サフィックスは、たとえチェックアウトモードの結果としてクライアント上にそ
のサフィックスが存在しない場合でもマッチしなければなりません。
.\"O Slashes in file names must be matched by explicit slashes in the pattern.
ファイル名に含まれるスラッシュ文字は、パターン中のスラッシュと正確に一
致しなければなりません。
.\"O CVS
.\"O .Ql Attic
.\"O directories are implicitly included in the matching process, and
.\"O should not be specified directly in the patterns.
CVS の
.Ql Attic
ディレクトリはマッチングの処理に暗黙的に含まれるで、パターン中で直接指
定してはいけません。
.\"O A matching file will be found whether it is in the Attic or not.
マッチするファイルは、それが Attic かどうかに関わらず発見されます。
.Pp
.\"O If an
.\"O .Cm execute
.\"O statement matches a directory, its command is executed if the
.\"O directory is created for the first time, or if its attributes are
.\"O changed.
.Cm execute
文がディレクトリにマッチした場合、コマンドが実行されるのは、
ディレクトリが新規に作成されたとき、またはディレクトリの属性が変更され
たときです。
.\"O The command is executed when ascending out of the directory, i.e.,
.\"O after its files and subdirectories have been processed.
コマンドはディレクトリから上ったとき、つまりそのディレクトリ内の
ファイルとサブディレクトリの処理が終わった後に実行されます。
.Pp
.\"O If multiple
.\"O .Cm execute
.\"O statements match a file, all of the associated commands are executed
.\"O in sequence.
複数の
.Cm execute
文が 1 つのファイルにマッチした場合、全ての関係するコマンドが順に実行
されます。
.Pp
.\"O For security reasons, the client may choose to ignore all
.\"O .Cm execute
.\"O statements.
セキュリティ上の理由で、クライアントは全ての
.Cm execute
文を無視するかもしれません。
.El
.Pp
.\"O Unrecognized commands are accepted but ignored, for backward
.\"O compatibility with
.\"O .Nm sup .
認識できないコマンドは受け付けられますが、無視されます。これは
.Xr sup 1
との後方互換性のための動作です。
.\"O .Sh RUNNING A CVSup MIRROR SITE
.Sh CVSup によるミラーサイトの運営
.\"O A mirror is a server which obtains and updates its files from a master
.\"O site by means of
.\"O .Nm CVSup ,
.\"O and redistributes them via
.\"O .Nm CVSup
.\"O to other sites.  Mirror sites are commonly used in large projects
.\"O to spread the load among a number of servers.  The files being
.\"O distributed originate at a master site.  Each mirror site updates its
.\"O own copies of the files periodically from there.  Clients in turn
.\"O obtain their updates from any of the mirror sites.
ミラーサイトとは、
.Nm CVSup 
を用いてマスターのサイトからファイルの取得と更新を行い、
.Nm CVSup
経由で他のサイトにファイルを再配布するサーバのことです。ミラーサイトは、
大きなプロジェクトで負荷を複数のサーバに分散するためによく使われます。
配布されるファイルは元々はマスターサイトに置かれます。各ミラーサイトは
マスターサイトを基にして、自分が持っているコピーを定期的に更新します。
次に、クライアントはミラーサイトのどれかから更新分のファイルを取得しま
す。
.Pp
.\"O .Nm
.\"O has a special mode of operation for mirror sites that dramatically
.\"O increases its efficiency.  This mode is enabled by the
.\"O .Fl s Ar scanDir
.\"O option on the command line.  Without the
.\"O .Fl s
.\"O option,
.\"O .Nm
.\"O makes a full file tree traversal over the files in each requested
.\"O collection, performing a
.\"O .Xr stat 2
.\"O system call on every file.  It does this for each client that connects
.\"O to it, on the assumption that any of the files could change at any
.\"O time.  Such a traversal imposes a heavy seek load on the disks
.\"O containing the files, and limits the number of clients that can be
.\"O served simultaneously.
.Nm
には、ミラーサイトの効率を劇的に向上させるための特殊な動作モードがあり
ます。このモードはコマンドラインで
.Fl s Ar scanDir
オプションを指定すると有効になります。
.Fl s
オプションを指定しないと、
.Nm
は要求された各コレクションのファイルに対してファイルツリー全体を調
べて、全てのファイルについて
.Xr stat 2
システムコールを実行します。この動作は接続した全てのクライアントに対し
て行われます。どのファイルがいつ変更されるか分からないからです。このよ
うな調べ方をするとファイルを持っているディスクに対してシークの負荷が大
きくかかり、同時にサービスを受けられるクライアントの数が制限されること
になります。
.Pp
.\"O On a mirror site, the files in the collections are known to
.\"O change only when new versions of them come in via
.\"O .Nm CVSup .
ミラーサイトの場合には、コレクション内のファイルが更新されるのは新しい
バージョンを
.Nm CVSup
経由で受け取る時だけであることが分かっています。
.\"O The
.\"O .Fl s
.\"O option allows
.\"O .Nm
.\"O to take advantage of this property to completely avoid the file tree
.\"O traversals.  This reduces the disk load on the server by orders of
.\"O magnitude.  In place of the file tree traversal,
.\"O .Nm
.\"O gets the necessary information about the files in the collections by
.\"O reading
.\"O .Em scan
.\"O files.  The scan files are created by the
.\"O .Nm cvsup
.\"O client when it updates the files on the mirror site from the
.\"O originals at the master site.  In
.\"O .Xr CVSUP 1 ,
.\"O these files are referred to as
.\"O .Em list
.\"O files.  Both names refer to the same files.  Each time
.\"O .Nm
.\"O serves a client, it finds the scan files created by the most recent
.\"O update from the master site.  Thus the server always has fully
.\"O up-to-date information about the files in the collections, without the
.\"O need to perform a file tree traversal.
.Fl s
オプションを使うと、
.Nm
はこの性質を生かして、ファイルツリーの調査を全く行わずにすみます。
そのため、サーバのディスク負荷は大幅に削減されます。ファイルツリーを調
べる代わりに、
.Nm
はコレクション内のファイルに関する必要な情報を
.Em scan
ファイルを読むことによって取得します。scan ファイルは、
.Nm cvsup
クラアイントがミラーサイト上のファイルをマスターサイトにあるオリジナル
のデータを使って更新する際に、クライアントが作成します。
.Xr CVSUP 1
では、これらのファイルは
.Em list
と書かれています。どちらの呼び方でも同じファイルを指しています。
.Nm
はクライアントにサービスする際は毎回、最後のマスターサイトからの更新の
ときに生成された scan ファイルを見つけます。したがって、サーバは
コレクション内にあるファイルに関する最新の情報を常に持っており、
ファイルツリーを調べる必要はありません。
.Pp
.\"O The
.\"O .Fl s
.\"O option is followed by a directory name which specifies where the
.\"O scan files can be found.  It is normally a subdirectory
.\"O of the base directory, and it must match the location where the
.\"O .Nm cvsup
.\"O client maintains its list files.  By default,
.\"O .Nm cvsup
.\"O locates these files under the
.\"O .Pa sup
.\"O subdirectory of the base directory.  To match this,
.\"O .Nm
.\"O should be run with
.\"O .Ql -s sup .
.Fl s
オプションの後には、scan ファイルがあるディレクトリ名を指定します。こ
れは普通、起点ディレクトリのサブディレクトリであり、
.Nm cvsup
クライアントがリストファイルを管理している場所と一致していなければなり
ません。デフォルトでは、
.Nm cvsup
は起点ディレクトリのサブディレクトリである
.Pa sup
にこれらのファイルを置きます。これに合わせるには、
.Nm
は
.Ql -s sup
で実行しなければなりません。
.\"O If
.\"O .Nm cvsup Ns 's
.\"O list file location is changed from the default using the
.\"O .Fl c
.\"O option, then
.\"O .Nm Ns 's
.\"O scan directory must be changed the same way.  There is no default
.\"O for the
.\"O .Fl s
.\"O option.  If it is not given explicitly on the command line, no scan
.\"O files are used.
.Fl c
オプションによって
.Nm cvsup
のリストファイルの位置がデフォルト値から変更されている場合、
.Nm Ns
の scan ディレクトリも同じように変更しなければなりません。
.Fl s
オプションにはデフォルト値はありません。コマンドラインで明示的に指定し
ていなければ、scan ファイルは全く使われません。
.Pp
.\"O There does not need to be a scan file for every collection.
全てのコレクションに対して scan ファイルが存在する必要はありません。
.\"O .Nm
.\"O first looks for the scan file for the collection requested by the
.\"O client.  If that scan file does not exist,
.\"O .Nm
.\"O tries the scan files for each successive super-collection, and uses
.\"O the first one it finds.  (See the description of the
.\"O .Cm super
.\"O keyword in
.\"O .Sx PREPARING A FILE COLLECTION REPOSITORY
.\"O for details.)
.\"O If no suitable scan file is located,
.\"O .Nm
.\"O falls back on performing a file tree traversal.
.Nm
はまずクライアントが要求したコレクションについて scan ファイルを探しま
す。その scan ファイルが存在しなければ、
.Nm
は順にスーパーコレクションの scan ファイルを探していき、最初に見つかっ
た scan ファイルを使います。
(詳しくは
.Sx ファイルコレクションレポジトリを準備する
で説明されている
.Cm super
キーワードの説明を参照してください。)
適切な scan ファイルがなければ、
.Nm
は最終的にファイルツリーを全て調べます。
.\"O .Sh ACCESS CONTROL
.Sh アクセス制御
.\"O Access to the server is unrestricted by default, but there is a
.\"O reasonably flexible mechanism for limiting access based on the IP
.\"O addresses of connecting clients.  It is enabled by placing a set
.\"O of rules into the access file
.\"O .Ar base Ns Pa /cvsupd.access .
.\"O The access file is a text file with one rule per line.  Comments
.\"O begin with
.\"O .Ql #
.\"O and extend to the end of the line.  White space is ignored except
.\"O where it is needed to separate adjacent tokens.  Blank lines are
.\"O ignored.
デフォルトの動作ではサーバへのアクセスは制限されていませんが、接続する
クライアントの IP アドレスに基づくかなり柔軟な機構があります。この機構は
アクセス制御ファイル
.Ar base Ns Pa /cvsupd.access
に規則を書くことによって有効になります。アクセス制御ファイルは
テキストファイルであり、1 行に 1 つの規則が書かれます。コメントは
.Ql #
で始まり、その行の最後まで続きます。空白文字は無視されますが、隣り合う
トークンを区切る場合は除きます。空行は無視されます。
.Pp
.\"O Each rule consists of the following components:
それぞれの規則は以下の要素からなります:
.Bl -bullet
.It
.\"O A flag indicating whether the rule is a
.\"O .Em permit
.\"O rule, an
.\"O .Em authenticate
.\"O rule, or a
.\"O .Em deny
.\"O rule.  The flag is expressed as a single character:
規則が
.Em 許可(permit)
規則、
.Em 認証(authenticate)
規則、
.Em 拒否(deny)
規則のいずれであるかを示すフラグ。このフラグは 1 つの文字で表されます:
.\"O .Ql +
.\"O means
.\"O .Em permit ,
.\"O .Ql *
.\"O means
.\"O .Em authenticate,
.\"O and
.\"O .Ql -
.\"O means
.\"O .Em deny.
.Ql +
は許可規則、
.Ql *
は認証規則、
.Ql -
は拒否規則を表します。
.It
.\"O An IP address to compare with the client's IP address to determine
.\"O whether the rule applies to the client.  This may be expressed either
.\"O as a numeric IP address or as a host name.  Numeric addresses consist
.\"O of 1 to 4 octet values, separated by dots.  If fewer than 4 octets are
.\"O specified, the trailing octets are assumed to contain 0.
クライアントの IP アドレスと比較され、そのクライアントに規則を適用する
かどうかが決めるための IP アドレス。これは数値の IP アドレスでも
ホスト名でも記述できます。数値のアドレスは、ドットで区切った 1 個から 
4 個のオクテットで表します。指定したオクテットが 4 個より少ない場合は、
後ろのオクテットが 0 であるとして扱われます。
.Pp
.\"O Host names are converted to numeric addresses when they are read.
ホスト名は読み込まれる時に数値アドレスに変換されます。
.\"O If a host has multiple addresses, a separate rule is added for each
.\"O address.  This may or may not have the desired effect.
ホストが複数個のアドレスを持っている場合、それぞれのアドレスに対する
規則が個別に追加されます。これは望み通りの動作をするかもしれませんし、
そうでないかもしれません。
.Pp
.\"O Host names should be used with caution.  A name that is slow to
.\"O resolve can bog down the server significantly.
ホスト名は注意して使うべきです。解決に時間がかかる名前があると、
サーバの動作が著しく遅くなるからです。
.It
.\"O A
.\"O .Em matching
.\"O mask to be ANDed with the IP addresses of the rule and the client
.\"O before comparing the addresses.  This mask is specified as
.\"O .Ql /
.\"O followed by an integer giving the number of high-order 1s in the
.\"O mask.  For example,
.\"O .Ql /24
.\"O specifies a mask of 0xffffff00.  The
.\"O .Em matching
.\"O mask is optional; if omitted, it defaults to
.\"O .Ql /32 .
アドレスを比較する前に規則とクライアントの IP アドレスとの AND を取る
ための
.Em matching
マスク。このマスクは、
マスクの上位ビットにある 1 の個数を
.Ql /
の後に書いて指定します。例えば、
.Ql /24
は 0xffffff00 というマスクを示します。
.Em matching
マスクは省略してもかまいません。省略した場合のデフォルト値は
.Ql /32
です。
.It
.\"O A
.\"O .Em counting
.\"O mask that determines how the clients that match the rule are counted.
規則にマッチしたクライアントを数える方法(後述)を決める
.Em counting
マスク。
.\"O (See below.)  It is specified the same way as the
.\"O .Em matching
.\"O mask.  The
.\"O .Em counting
.\"O mask is optional; if omitted, it defaults to the same value as the
.\"O .Em matching
.\"O mask.
指定方法は
.Em matching
マスクと同じです。
.Em counting
マスクは省略してもかまいません。省略した場合はデフォルト値として、
.Em matching
マスクと同じ値を持ちます。
.It
.\"O A
.\"O .Em limit
.\"O specifying the maximum number of matching clients allowed at the same
.\"O time.  This is specified as a decimal integer, preceded by white
.\"O space to separate it from the preceding component.  The
.\"O .Em limit
.\"O is optional.  If omitted, it defaults to 0 for a
.\"O .Em deny
.\"O rule, or to infinity for a
.\"O .Em permit
.\"O rule.
同時にマッチできるクライアントの最大数を指定する
.Em limit
値。これは 10 進の整数で指定し、前の要素と区別するために空白を前に
置きます。
.Em limit
は省略してもかまいません。省略した場合のデフォルト値は、
.Em 拒否
規則については 0 であり、
.Em 許可
規則については無制限です。
.El
.Pp
.\"O When a client connects to the server, its IP address is checked
.\"O against successive rules in sequence.  Each rule is processed as
.\"O follows:
クライアントがサーバに接続した際、クライアントの IP アドレスは
規則に対して順番にチェックされていきます。
それぞれの規則は以下のように処理されます:
.Bl -enum
.It
.\"O The IP address of the rule is compared with the IP address of the
.\"O client, after ANDing each address with the
.\"O .Em matching
.\"O mask.  If the addresses do not match, the rule is ignored.
規則の IP アドレスとクライアントの IP アドレスを比較します。
比較の前にはそれぞれのアドレスと
.Em matching
マスクとの AND を取っておきます。
アドレスがマッチしなければ、この規則は無視されます。
.It
.\"O The IP addresses of all other currently connected clients are compared
.\"O with the IP address of the connecting client, after ANDing each
.\"O address with the
.\"O .Em counting
.\"O mask.  If the number of matching clients (not counting the connecting
.\"O client) is less than the
.\"O .Em limit ,
.\"O then the rule
.\"O .Em succeeds .
現在接続している他の全てのクライアントの IP アドレスと
接続しようとしているクライアントの IP アドレスを比較します。
比較の前には各アドレスと
.Em counting
マスクとの AND を取っておきます。マッチしているクライアントの数
(接続しようとしているクライアントは数えません)が
.Em limit
より小さければ規則は
.Em 成功
となります。
.\"O Otherwise, the rule
.\"O .Em fails .
そうでなければ規則は
.Em 失敗
します。
.It
.\"O If the rule is a
.\"O .Em permit
.\"O rule and it succeeded, the client is allowed access, and the rest of the
.\"O rules are ignored.
規則が
.Em 許可
規則であり、かつ成功であれば、クライアントの接続が許可され、残りの規則
は無視されます。
.It
.\"O If the rule is an
.\"O .Em authenticate
.\"O rule and it succeeded, the server attempts to verify the client's
.\"O identity using a challenge-response protocol (see
.\"O .Sx AUTHENTICATION ,
.\"O below).
規則が
.Em 認証
規則であり、かつ成功であれば、サーバはクライアントが何者であるかを確認
しようとします。確認には challenge-response プロトコルを用います(後述の
.Sx 認証
の節を見てください)。
.\"O Access is granted or denied based on the outcome of authentication.
アクセスが許可されるか拒否されるかは認証の結果によって決まります。
.\"O The rest of the rules are ignored.
残りの規則は無視されます。
.It
.\"O If the rule is a
.\"O .Em deny
.\"O rule and it failed, the client is denied access, and the rest of the
.\"O rules are ignored.
規則が
.Em 拒否
規則であり、かつ失敗であれば、クライアントはアクセスを拒否され、残りの
規則は無視されます。
.It
.\"O Otherwise, processing continues with the next rule.
これ以外の場合には、次の規則について処理が継続されます。
.El
.Pp
.\"O There is an implicit
.\"O .Em authenticate
.\"O rule at the end of the list which matches any IP address.  Thus,
.\"O if the processing reaches the end of the list of rules without having
.\"O allowed or denied access, access is controlled by the authentication
.\"O mechanism.
リストの最後には、どんな IP アドレスにもマッチする
.Em 認証
規則が暗黙的に置かれています。したがって、アクセスが許可も拒否もされず
に処理が終わった場合は、アクセスは認証機構によって制御されます。
.Pp
.\"O Here are some examples illustrating how the rules are commonly used.
規則の一般的な使用方法の例を以下に示します。
.Pp
.Dl -spam.cyberpromo.com
.\"O Deny all access from a specific host.
特定のホストからのアクセスを全て拒否します。
.Pp
.Dl +mirror.FreeBSD.org
.\"O Permit unlimited access from a specific host.
特定のホストからのアクセスを無制限に許可します。
.Pp
.Dl -user.FreeBSD.org 1
.\"O Limit a specific host to at most 1 connection at a time.
特定のホストからの同時接続を 1 つだけに制限します。
.Pp
.Dl -198.211.214/24
.\"O Deny all access from hosts in a specific class C address block.
特定のクラス C アドレスのホストからのアクセスを拒否します。
.Pp
.Dl -198.211.214/24 3
.\"O Allow at most 3 connections total from the hosts in a specific class C
.\"O address block.
特定のクラス C アドレスのホストからの同時アクセスを、
合計 3 つまで許可します。
.Pp
.Dl -198.211.214/24/32 3
.\"O Allow at most 3 connections from each of the hosts in a specific
.\"O class C address block.
特定のクラス C アドレスに含まれるホストからの同時アクセスを、
ホストごとに合計 3 つまで許可します。
.Pp
.\"O Note the difference between the previous two examples.
上記 2 つの例の違いに注意してください。
.\"O The first example imposes a per-network limit, while the second
.\"O example imposes a per-host limit.  The difference is in the
.\"O .Em counting
.\"O mask.  The 24 bit mask in the first example produces a single counter
.\"O that is shared by all of the hosts in the specified address block.  The
.\"O 32 bit mask in this example produces a separate counter for each host.
前者の例はネットワークごとの制限を行い、後者の例はホスト単位の制限を行っ
ています。両者の相違点は
.Em counting
マスクです。最初の例はマスクが 24 ビットなので、指定したアドレスブロッ
クに含まれる全てのホストについて共通のカウンタが作られます。後者の例は
マスクが 32 ビットなので、ホストごとに別々のカウンタが作られます。
.Pp
.Dl -0.0.0/0/24 1
.\"O Allow no more than 1 connection at a time from each block of 256
.\"O addresses.
各アドレスブロック(アドレス 256 個)からの同時接続をそれぞれ 1 つだけ
許可します。
.Pp
.Dl *0.0.0.0/0
.\"O For all clients, use authentication to decide whether access is allowed.
全てのクライアントについて、認証を行ってアクセスを許可するかどうかを決
めます。
.Pp
.\"O When updating the access file, it is not necessary to halt the
.\"O server.  But the file should be copied for editing, and then the new
.\"O version should be moved atomically into place.  There is no need to
.\"O signal the server after updating the file.  The server will notice
.\"O that the file has been touched, and will rescan it automatically.
アクセス制御ファイルを更新する際にサーバを止める必要はありません。
しかし、編集の際にはコピーを取って別の場所で編集し、それからアトミック
に新しいファイルに置き換えるべきです。ファイルを更新した後にサーバに
シグナルを送る必要はありません。サーバはファイルが触られたことを
検出し、再読み込みを自動的に行います。
.\"O In addition, the server rescans the file every 3 hours to keep up
.\"O with DNS changes that might affect the resolved addresses of host
.\"O names.
さらに、サーバは 3 時間ごとにファイルを再読み込みします。
これは DNS の変更で解決されるホスト名が変わるかもしれないので、これに
対応するためです。
.Pp
.\"O Syntax errors in individual rules are logged, and the offending
.\"O rules are ignored.  Host name lookup failures are also logged.
個々の規則における文法違反はログに記録され、違反している規則は無視され
ます。ホスト名解決の失敗もログに記録されます。
.\"O .Sh AUTHENTICATION
.Sh 認証
.\"O .Nm CVSup
.\"O implements an authentication mechanism which can be used to control
.\"O access to the server.  It uses a challenge-response protocol which is
.\"O immune to packet sniffing and replay attacks.  No passwords are sent
.\"O over the network in either direction.  Both the client and the server
.\"O can independently verify the identities of each other.
.Nm CVSup
はサーバへのアクセスの制御に使える認証機構を備えています。この認証機構
はパケットの盗聴攻撃や再生攻撃の影響を受けない challenge-response 
プロトコルを使っています。ネットワーク上ではどちらの方向にもパスワード
は流れません。クライアントとサーバはどちらとも、相手が何者であるかを
独立して確認できます。
.Pp
.\"O Authentication of the client is invoked by a successful
.\"O .Em authenticate
.\"O rule in the
.\"O .Ar base Ns Pa /cvsupd.access
.\"O file, or by
.\"O .Dq falling off the end
.\"O of the file.  If there is no
.\"O .Pa cvsupd.access
.\"O file, clients are not authenticated.
クライアントの認証は
.Ar base Ns Pa /cvsupd.access
ファイル内の
.Em 認証
規則が成功するか、
.Dq 規則が適用されないままファイル末尾まで来た
場合に呼び出されます。
.Pa cvsupd.access
が存在しない場合はクライアントの認証は行われません。
.Pp
.\"O The file
.\"O .Ar base Ns Pa /cvsupd.passwd
.\"O holds the information used for performing authentication.  This file
.\"O contains a record for each client who is allowed access to the
.\"O server.  Each record occupies one line in the file.  Lines beginning
.\"O with
.\"O .Ql #
.\"O are ignored, as are lines containing only white space.
.Ar base Ns Pa /cvsupd.passwd
ファイルには認証時に使う情報が入っています。このファイルには、
サーバへのアクセスが許可されたクライアントについてのレコードが書かれて
います。ファイル中では 1 行に 1 レコードが書かれます。
.Ql #
で始まる行と、空白文字しか含まない行は無視されます。
.\"O White space is significant everywhere else in the file.  Fields are
.\"O separated by
.\"O .Ql \&:
.\"O characters.
ファイル中の別の場所では空白文字は必ず意味を持ちます。フィールドは
.Ql \&:
文字で区切ります。
.Pp
.\"O The first record of the file is special.  It specifies the identity
.\"O of the server itself.  This server record has the form:
ファイルの最初のレコードは特別です。最初のレコードはサーバ自身を表しま
す。サーバのレコードは以下の形式になります:
.Pp
.Dl Ar serverName Ns No : Ns Ar privateKey
.Pp
.\"O .Ar ServerName
.\"O is the canonical name of the server, e.g.,
.\"O .Ql CVSup.FreeBSD.ORG .
.Ar ServerName
はサーバのカノニカル名です(例:
.Ql CVSup.FreeBSD.ORG
)。
.\"O This name is sent to the client, which uses it to choose an
.\"O appropriate client name and shared secret for authentication.  The
.\"O name is case-insensitive.
この名前がクライアントに送られ、クライアントはこの名前を使って適切なク
ライアント名と、認証のために共有している秘密の文字列を選びます。
この名前では大文字と小文字は区別されません。
.Pp
.\"O .Ar PrivateKey
.\"O is any string of characters except
.\"O .Ql \&: .
.Ar PrivateKey
は
.Ql \&:
を除く任意の文字からなる文字列です。
.\"O When the server generates random challenges to send to the client,
.\"O it uses
.\"O .Ar privateKey
.\"O to make the challenges harder to guess.  Challenges are random and
.\"O quite unpredictable in any case, so the
.\"O .Ar privateKey
.\"O isn't really very important.  It can be left empty if desired, but
.\"O the
.\"O .Ql \&:
.\"O that precedes it must be present.
サーバがランダムな challenge 文字列を生成してクライアントに送った時、
サーバは推測が困難な challenge 文字列を
.Ar privateKey
を使って作ります。challenge 文字列はランダムであり、まず予測できないの
で、
.Ar privateKey
は実はあまり重要ではありません。そうしたければ空のままでもかまいません
が、文字列の前の
.Ql \&:
は必ず必要です。
.Pp
.\"O All of the remaining records in the file correspond to individual
.\"O clients.  Each client record has the following form:
ファイル中の残り全てのレコードは、個々のクライアントに対応します。
クライアント用のレコードは以下の形となります:
.Bd -literal -offset indent
.Sm off
.Xo Ar clientName No : Ar sharedSecret No :
.Ar class No : Ar comment
.Xc
.Sm on
.Ed
.Pp
.\"O All fields must be present even if some of them are empty.
空のフィールドがある場合でも、全てのフィールドが存在しなければなりません。
.\"O .Ar ClientName
.\"O is the name of the client to which the record applies.  By
.\"O convention, e-mail addresses are used for all client names, e.g.,
.\"O .Ql BillyJoe@FreeBSD.ORG .
.Ar ClientName
はレコードが適用されるクライアントの名前です。慣習では、全ての
クライアント名には e-mail アドレスが使われます(例: 
.Ql BillyJoe@FreeBSD.ORG
)。
.\"O Client names are case-insensitive.
クライアント名では大文字と小文字は区別されません。
.Pp
.\"O .Ar SharedSecret
.\"O is a secret string of characters known only to the client and the server.
.Ar SharedSecret
は、クライアントとサーバだけが知っている秘密の文字列です。
.\"O It is generated from a password chosen by the client, using the
.\"O .Nm cvpasswd
.\"O utility.
この文字列はクライアントが選んだパスワードから
.Nm cvpasswd
ユーティリティを使って生成されます。
.\"O The client proves its identity to the server (and vice versa) by
.\"O demonstrating that it knows the
.\"O .Ar sharedSecret .
クライアントは
.Ar sharedSecret
を知っていることを示すことにより、自分の身分をサーバに対して証明します
(その逆も同じです)。
.\"O A client's access may be disabled by changing its
.\"O .Ar sharedSecret
.\"O field to
.\"O .Ql * .
.Ar sharedSecret
フィールドを
.Ql *
にすることにより、クライアントのアクセスを禁止できます。
.Pp
.\"O The shared secret is never sent across the network, nor can it be used
.\"O to find out the client's password.  However, given the shared secret,
.\"O a modified version of
.\"O .Nm cvsup
.\"O could impersonate the client.  Thus, care must be taken to ensure that
.\"O the
.\"O .Pa cvsupd.passwd
.\"O file is readable only by the server.
共有している秘密の文字列がネットワーク上を流れることはありませんし、
秘密の文字列からクライアントのパスワードを調べることもできません。しか
し、共有している秘密の文字列があれば、改造した
.Nm cvsup
を使ってクライアントのふりをすることができるかもしれません。したがって、
.Pa cvsupd.passwd
必ずファイルはサーバしか読めないように注意してください。
.Pp
.\"O .Ar Class
.\"O is reserved for future use.  It should be empty.
.Ar Class
は将来使うために予約しています。空にしてください。
.Pp
.\"O .Ar Comment
.\"O contains any additional information about the client that might be
.\"O useful to the server administrator.  For example, it may contain
.\"O the client's full name and other contact information.
.Ar Comment
はサーバの管理者が便利なように、クライアントに関する備考が書かれていま
す。例えば、クライアントの本名や、別の連絡手段などです。
.Pp
.\"O When updating the
.\"O .Pa cvsupd.passwd
.\"O file, it is not necessary to halt the server.  But the file should
.\"O be copied for editing, and then the new version should be moved
.\"O atomically into place.  There is no need to signal the server after
.\"O updating the file.
.Pa cvsupd.passwd
ファイルを更新する際にサーバを止める必要はありません。
しかし、編集の際にはコピーを取って別の場所で編集し、それからアトミック
に新しいファイルに置き換えるべきです。ファイルを更新した後にサーバに
シグナルを送る必要はありません。
.Pp
.\"O Syntax errors in individual records of the
.\"O .Pa cvsupd.passwd
.\"O file are logged, and the offending records are ignored.
.Pa cvsupd.passwd
ファイル中では、個々のレコードの文法違反はログに記録され、違反している
レコードは無視されます。
.\" ---------------------------------------
.\"O .Sh HOW ACCESS CONTROL AND AUTHENTICATION INTERACT
.Sh アクセス制御と認証通信の方法
.\"O Here is a summary of the interactions between the access control and
.\"O authentication mechanisms.  The key principle is that access control
.\"O takes place first.  The outcome of access control determines whether
.\"O authentication is performed too.
アクセス制御と認証機構の関係を以下にまとめます。重要な原則は、アクセス
制御が先に行われる点です。アクセス制御の結果によって認証が行われるかど
うかが決まります。
.Bl -enum
.It
.\"O If there is no
.\"O .Pa cvsupd.access
.\"O file, then all clients are granted access.  No authentication is
.\"O done, even if
.\"O .Pa cvsupd.passwd
.\"O exists.
.Pa cvsupd.access
ファイルがなければ、全てのクライアントのアクセスが許可されます。たとえ
.Pa cvsupd.passwd
があっても認証は行われません。
.It
.\"O If the
.\"O .Pa cvsupd.access
.\"O file exists but is empty, all clients are subjected to
.\"O authentication.  If
.\"O .Pa cvsupd.passwd
.\"O does not exist, nobody can access the server.
.Pa cvsupd.access
ファイルが存在するけれど、空である場合、全てのクライアントに対して認証
が行われます。
.Pa cvsupd.passwd
が存在しなければ、誰もサーバにアクセスできません。
.It
.\"O If
.\"O .Pa cvsupd.access
.\"O exists and has some rules in it, but there is no
.\"O .Pa cvsupd.passwd
.\"O file, then successful
.\"O .Em authenticate
.\"O rules cause access to be denied.  Access is still granted to those
.\"O who match successful
.\"O .Em permit
.\"O rules.  Falling off the end of the
.\"O .Pa cvsupd.access
.\"O file results in denial of access.
.Pa cvsupd.access
が存在してファイル中に規則が書かれているけれど、
.Pa cvsupd.passwd
ファイルが存在しない場合は、
.Em 認証
規則が成功するとアクセスが拒否されます。この場合でも、
.Em 許可
規則が成功したクライアントはアクセスできます。
.Pa cvsupd.access
ファイルの最後まで来た場合には、アクセスは拒否されます。
.It
.\"O If both the
.\"O .Pa cvsupd.access
.\"O and
.\"O .Pa cvsupd.passwd
.\"O files exist, then:
.Pa cvsupd.access
と
.Pa cvsupd.passwd
がどちらも存在する場合の動作は以下の通りです:
.Bl -bullet -compact
.It
.\"O Successful
.\"O .Em permit
.\"O rules cause access to be granted without authentication.
.Em 許可
規則が成功すると認証無しでアクセスが許可されます。
.It
.\"O Successful
.\"O .Em authenticate
.\"O rules cause authentication to be performed.  Access is granted or
.\"O denied based on the outcome of that.  Falling off the end of the
.\"O .Pa cvsupd.access
.\"O file is included in this case.
.Em 認証
規則が成功すると認証が実行されます。アクセスの可否は認証の結果によって
決まります。
.Pa cvsupd.access
ファイルの最後に来るケースは、これに含まれます。
.It
.\"O Failing
.\"O .Em deny
.\"O rules cause access to be denied.
.Em 拒否
規則が失敗するとアクセスは拒否されます。
.El
.El
.\"O .Sh RCS KEYWORD EXPANSION
.Sh "RCS キーワードの展開"
.\"O In checkout mode,
.\"O .Nm CVSup
.\"O expands RCS keywords as described in
.\"O .Xr co 1 .
チェックアウトモードでは、
.Nm CVSup
は
.Xr co 1
で説明されているように RCS キーワードを展開します。
.\"O It expands all of the standard keywords, and also the non-standard
.\"O .Ql $\&CVSHeader$
.\"O keyword.
.Nm CVSup
は標準的キーワードは全て展開し、さらに非標準のキーワードである
.Ql $\&CVSHeader$
も展開します。
.\"O This expands the same as
.\"O .Ql $\&Header$ ,
.\"O except that the RCS file's pathname is expressed relative to the
.\"O .Cm prefix
.\"O directory, rather than as an absolute pathname.
この展開は
.Ql $\&Header$
と同様に行われますが、RCS ファイルのパス名が絶対パスではなく
.Cm prefix
ディレクトリからの相対パスで表記される点が異なります。
.\"O The
.\"O .Cm prefix
.\"O is assumed to be the root of the CVS repository.
ここで
.Cm prefix
は CVS レポジトリのルートディレクトリです。
.Pp
.\"O It is also possible to define aliases for the standard RCS keywords,
.\"O and to selectively enable or disable the recognition of individual
.\"O keywords.
標準 RCS キーワードの別名を定義し、それぞれのキーワードの解釈を選択的に
有効・無効にすることも可能です。
.\"O These properties are controlled on a repository-wide basis by
.\"O directives in a file named
.\"O .Ar prefix Ns Pa /CVSROOT/options .
この設定は、
.Ar prefix Ns Pa /CVSROOT/options
ファイルに書かれているキーワードによって、
レポジトリ全体を単位として制御されます。
.\"O Each directive occupies one line of the file.
1 行には 1 つのキーワードが書かれます。
.\"O Comments begin with
.\"O .Ql #
.\"O and extend to the end of line.
.Ql #
から行末まではコメントと見なされます。
.\"O Blank lines are ignored.
また空白行は無視されます。
.\"O The syntax is ridiculous, for historical reasons.
歴史的な経緯のために文法は変てこです。
.Pp
.\"O To define a keyword alias, use a line of the form:
キーワードの別名を定義するには、次の形式の行を使います :
.Sm off
.Dl tag= Ar alias Op Li = Ar keyword
.Sm on
.\"O For example:
例えば:
.\"O .Dl tag=FreeBSD=CVSHeader
.\"O defines a new RCS keyword
.\"O .Ql $\&FreeBSD$ ,
.\"O which expands the same as
.\"O .Ql $\&CVSHeader$ .
.Dl tag=FreeBSD=CVSHeader
は新しい RCS キーワード
.Ql $\&FreeBSD$
を定義し、これは
.Ql $\&CVSHeader$
と同様に展開されます。
.\"O If the second
.\"O .Ql =
.\"O and the
.\"O .Ar keyword
.\"O are omitted, the keyword defaults to
.\"O .Ql Id .
二番目の
.Ql =
と
.Ar keyword
がない場合、キーワードのデフォルト値は
.Ql Id
です。
.Pp
.\"O To disable all but certain selected keywords, use a line of the
.\"O form:
選んだ特定のキーワード以外を全て無効にするには、次の形式の行を使います:
.Sm off
.Dl tagexpand=i Ar keyword Op , Ar ...
.Sm on
.\"O For example:
.\"O .Dl tagexpand=iFreeBSD,Id
.\"O disables the expansion of all keywords except
.\"O .Ql $\&FreeBSD$
.\"O and
.\"O .Ql $\&Id$ .
例えば
.Dl tagexpand=iFreeBSD,Id
と書くと
.Ql $\&FreeBSD$
と
.Ql $\&Id$
以外の全てのキーワードの展開を行わなくなります。
.\"O The leading
.\"O .Ql i
.\"O stands for
.\"O .Dq include .
最初の
.Ql i
は
.Dq include
の意味です。
.Pp
.\"O To enable all but certain selected keywords, use a line of the
.\"O form:
選択した特定のキーワード以外を全て有効にするためには、次の形式の行を使
います:
.Sm off
.Dl tagexpand=e Ar keyword Op , Ar ...
.Sm on
.\"O For example:
.\"O .Dl tagexpand=eFreeBSD,Id
.\"O enables the expansion of all keywords except
.\"O .Ql $\&FreeBSD$
.\"O and
.\"O .Ql $\&Id$ .
例えば
.Dl tagexpand=eFreeBSD,Id
と書くと、
.Ql $\&FreeBSD$
と
.Ql $\&Id$
以外の全てのキーワードの展開を行うようになります。
.\"O The leading
.\"O .Ql e
.\"O stands for
.\"O .Dq exclude .
先頭の
.Ql e
は
.Dq exclude
の意味です。
.\"O .Sh SHUTDOWN
.Sh シャットダウン
.\"O If there exists a file
.\"O .Ar base Ns Pa /cvsupd.HALT
.\"O that is newer than the time when the server was started, then the server
.\"O will reject all new incoming connection requests.
サーバの起動よりも後に作られた
.Ar base Ns Pa /cvsupd.HALT
というファイルが存在すると、サーバは全ての新規接続要求を受け入れなくな
ります。
.\"O Clients which had already started will run to completion, but no new
.\"O ones will be accepted.
すでに接続されているクライアントは最後まで実行されますが、新しい接続は一
切受け付けなくなります。
.\"O This mechanism is awkward and weak, and will probably be changed in a
.\"O future release.
この仕組みは不便で非力なため、おそらく将来のリリースでは変更されるでしょ
う。
.\"O .Sh SECURITY
.Sh セキュリティ
.\"O .Nm
.\"O does not create or write any files, except for its log file if one
.\"O is specified on the command line.
.Nm
は、コマンドラインで指定するログファイルを除いて、新しいファイルの作成
やファイルへの書き込みは行いません。
.\"O There is thus little risk that
.\"O .Nm
.\"O can be subverted into damaging the system on which it is running.
.Nm
が動作していることによってシステムにダメージを与える可能性はほとんどあり
ません。
.\"O A more likely risk is that
.\"O .Nm
.\"O might be spoofed into sending out files that are not intended to be
.\"O publicly distributed.
それよりも可能性の高いセキュリティ上の危険として、
.Nm
が騙されて公開すべきでないファイルを送り出してしまうことがあります。
.\"O .Nm
.\"O takes pains to prevent this from happening.
.Nm
ではこのようなことがないように細心の注意を払っています。
.\"O Nevertheless, for maximum protection
.\"O .Nm
.\"O should be run as a completely unprivileged user analogous to
.\"O .Ql nobody ,
.\"O and should serve only files that are readable by everyone.
それでもやはり、最大の防御は
.Nm
を
.Ql nobody
のような全く権限のないユーザで実行し、誰でも読めるファイルしか提供でき
ないようにすることです。
.Pp
.\"O .Nm CVSup
.\"O has no provision for encrypting the data sent across the network.  If
.\"O secrecy is desired then the connection can be tunneled through
.\"O .Nm ssh .
.Nm CVSup
は、ネットワーク上を流れるデータの暗号化には対応していません。
機密性が必要であれば、
.Nm ssh
を使って接続をトンネリングしてください。
.\"O .Sh FILES
.Sh ファイル
.Bl -tag -width base/sup/collection/releasesxx -compact
.It Pa /usr/local/etc/cvsup
.\"O Default
.\"O .Ar base
.\"O directory.
デフォルトの
.Ar 起点
ディレクトリ。
.It Pa sup
.\"O Default
.\"O .Ar collDir
.\"O subdirectory.
デフォルトの
.Ar collDir
サブディレクトリ。
.Sm off
.It Xo Ar base / Ar collDir / Ar collection
.Pa /releases
.Xc
.Sm on
.\"O Releases file.
リリースファイル。
.Sm off
.It Xo Ar base / Ar collDir / Ar collection
.No / Ar list
.Xc
.Sm on
.\"O List file.
リストファイル。
.It Ar base Ns Pa /cvsupd.HALT
.\"O Shutdown file.
シャットダウンファイル。
.It Ar base Ns Pa /cvsupd.access
.\"O Access control file.
アクセス制御ファイル。
.It Ar base Ns Pa /cvsupd.passwd
.\"O Authentication password file.
認証パスワードファイル。
.Sm off
.It Ar prefix Pa /CVSROOT/options
.Sm on
.\"O RCS keyword configuration file.
RCS キーワード設定ファイル。
.El
.\"O .Sh SEE ALSO
.Sh 関連項目
.Xr co 1 ,
.Xr cvpasswd 1 ,
.Xr cvs 1 ,
.\"O .Xr cvsup 1 .
.Xr cvsup 1
.Pp
.Bd -literal
http://www.polstra.com/projects/freeware/CVSup/
.Ed
.\"O .Sh AUTHORS
.Sh 作者
.\"O .An John Polstra Aq jdp@polstra.com .
.An John Polstra Aq jdp@polstra.com
.\"O .Sh BUGS
.Sh バグ
.\"O An RCS file is not recognized as such unless its name ends with
.\"O .Ql \&,v .
ファイル名の末尾が
.Ql \&,v
になっていない RCS ファイルは認識されません。
.Pp
.\"O Any directory named
.\"O .Ql Attic
.\"O is assumed to be a CVS Attic, and is treated specially.
.Ql Attic
という名前のディレクトリは全て CVS Attic と見なされ、特別な扱いを受けます。
