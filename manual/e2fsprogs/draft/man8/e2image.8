.\" -*- nroff -*-
.\" Copyright 2001 by Theodore Ts'o.  All Rights Reserved.
.\" This file may be copied under the terms of the GNU Public License.
.\" 
.\" Japanese Version Copyright (c) 2001,2005 Yuichi SATO
.\"         all rights reserved.
.\" Translated Sun Sep  2 23:20:17 JST 2001
.\"         by Yuichi SATO <ysato@h4.dion.ne.jp>
.\" Updated & Modified Tue May  3 04:42:39 JST 2005
.\"         by Yuichi SATO <ysato444@yahoo.co.jp>
.\" Updated & Modified Tue Dec 20 07:00:21 JST 2005 by Yuichi SATO
.\" 
.TH E2IMAGE 8 "December 2010" "E2fsprogs version 1.41.14"
.\"O .SH NAME
.SH 名前
.\"O e2image \- Save critical ext2/ext3/ext4 filesystem metadata to a file
e2image \- 重要な ext2/ext3/ext4 ファイルシステムメタデータをファイルに保存する
.\"O .SH SYNOPSIS
.SH 書式
.B e2image
[
.B \-rsI
]
.I device
.I image-file
.\"O .SH DESCRIPTION
.SH 説明
.\"O The
.\"O .B e2image
.\"O program will save critical ext2, ext3, or ext4 filesystem metadata located on 
.\"O .I device  
.\"O to a file specified by 
.\"O .IR image-file .
.B e2image
プログラムは、
.I device
上にある重要な ext2/ext3/ext4 のファイルシステムのメタデータを
指定されたファイル
.I image-file
に保存する。
.\"O The image file may be examined by 
.\"O .B dumpe2fs
.\"O and
.\"O .BR  debugfs ,
.\"O by using the
.\"O .B \-i
.\"O option to those programs.  This can assist an expert in
.\"O recovering catastrophically corrupted filesystems.  In the future,
.\"O e2fsck will be enhanced to be able to use the image file to help
.\"O recover a badly damaged filesystem.
このイメージファイルは
.B dumpe2fs
や
.B debugfs
といったプログラムで
.B \-i 
オプションを使えば検査できる。
このプログラムは酷く破損したファイルシステムを
エキスパートが回復するときの手助けができる。
将来的には、被害を受けたファイルシステムを回復する手助けとして、
このイメージファイルを用いるように e2fsck を拡張する予定である。
.PP
.\"O If  
.\"O .I image-file
.\"O is \-, then the output of 
.\"O .B e2image
.\"O will be sent to standard output, so that the output can be piped to
.\"O another program, such as 
.\"O .BR gzip (1).  
.I image-file
が \- の場合、
.B e2image
の出力は標準出力に送られる。
これにより、出力を
.BR gzip (1)
のような他のプログラムにパイプすることができる。
.\"O (Note that this is currently only supported when
.\"O creating a raw image file using the 
.\"O .B \-r
.\"O option, since the process of creating a normal image file currently
.\"O requires random access to the file, which cannot be done using a
.\"O pipe.  This restriction will hopefully be lifted in a future version of
.\"O .BR e2image .)
(今のところ、このオプションがサポートされているのは、
.B \-r
オプションを使って raw イメージファイルを
作成する場合のみである点に注意すること。
なぜなら、今のところは通常のイメージファイルを作成する過程で、
パイプを使って行うことのできない
ファイルへのランダムアクセスが必要なためである。
この制限は将来のバージョンの
.B e2image
で取り除かれると期待される。)
.PP
.\"O It is a very good idea to create image files for all of
.\"O filesystems on a system and save the partition
.\"O layout (which can be generated using the 
.\"O .B fdisk \-l
.\"O command) at regular intervals --- at boot time, and/or every week or so.
.\"O The image file should be stored on some filesystem other than
.\"O the filesystem whose data it contains, to ensure that this data is
.\"O accessible in the case where the filesystem has been badly damaged.
(ブート時や毎週といった) 一定の期間毎に、
全てのファイルシステムのイメージファイルを作成したり、
.RB ( "fdisk \-l"
コマンドで生成される) パーティションのレイアウトを保存するのは、
とても良い考えである。
ファイルシステムが被害を受けたときに
イメージファイルデータにアクセスできることを保証するために、
イメージファイルは中に入れたファイルシステムとは
別のファイルシステムに置いておくべきである。
.PP
.\"O To save disk space, 
.\"O .B e2image
.\"O creates the image file as a sparse file.  
.\"O Hence, if the image file
.\"O needs to be copied to another location, it should
.\"O either be compressed first or copied using the 
.\"O .B \-\-sparse=always
.\"O option to GNU version of 
.\"O .BR cp .  
ディスク容量を節約するため、
.B e2image
はイメージファイルをスパースな (sparse) ファイルとして作成する。
よって、イメージファイルを他へコピーするときには、
前もって圧縮するか、
GNU 版の
.B cp 
では
.B \-\-sparse=always
オプションを使ってコピーするべきである。
.PP
.\"O The size of an ext2 image file depends primarily on the size of the
.\"O filesystems and how many inodes are in use.  For a typical 10 gigabyte
.\"O filesystem, with 200,000 inodes in use out of 1.2 million inodes, the
.\"O image file will be approximately 35 megabytes; a 4 gigabyte filesystem with
.\"O 15,000 inodes in use out of 550,000 inodes will result in a 3 megabyte
.\"O image file.  Image files tend to be quite
.\"O compressible; an image file taking up 32 megabytes of space on
.\"O disk will generally compress down to 3 or 4 megabytes.
ext2 イメージファイルの大きさは、ファイルシステムのサイズと
使用している inode の数に大きく依存する。
典型的な 10 GB のファイルシステムで
1,200,000 個の inode のうち 200,000 個が使われている場合、
イメージファイルの大きさは約 35 MB になるだろう。
4 GB のファイルシステムで
550,000 個の inode のうち 15,000 個が使用されている場合、
イメージファイルの大きさは約 3 MB になるだろう。
イメージファイルは (ファイルシステムと比べて)
とても小さく圧縮できる傾向がある。
ディスク上で 32 MB を使用しているイメージファイルは、
一般に 3 〜 4 MB に圧縮される。
.PP
.\"O .SH RESTORING FILESYSTEM METADATA USING AN IMAGE FILE
.SH イメージファイルを使ったファイルシステムメタデータの復旧
.PP
.\"O The 
.\"O .B \-I 
.\"O option will cause e2image to install the metadata stored in the image
.\"O file back to the device.    It can be used to restore the filesystem metadata
.\"O back to the device in emergency situations.
.B \-I 
オプションを指定すると、e2image はイメージファイルに格納されている
メタデータをデバイスにインストールし直す。
これは緊急の場合に、ファイルシステムメタデータを
デバイスに復旧するのに使用できる。
.PP
.\"O .B WARNING!!!!
.B 警告!!!!
.\"O The
.\"O .B \-I 
.\"O option should only be used as a desperation measure when other
.\"O alternatives have failed.  If the filesystem has changed since the image
.\"O file was created, data
.\"O .B will
.\"O be lost.  In general, you should make a full image
.\"O backup of the filesystem first, in case you wish to try other recovery
.\"O strategies afterwards.
.B \-I 
オプションは、他の方法が失敗した場合の
最終手段としてのみ使用すべきである。
イメージファイルが作成された後でファイルシステムが変更されていると、
データが失われる\fBだろう\fR。
他の復旧手段を後で試そうと思う場合は、
通常はファイルシステムのフルイメージバックアップを作成すべきである。
.PP
.\"O .SH RAW IMAGE FILES
.SH RAW イメージファイル
.\"O The 
.\"O .B \-r
.\"O option will create a raw image file instead of a normal image file.  
.\"O A raw image file differs
.\"O from a normal image file in two ways.  
.B \-r
オプションを使うと、通常のイメージファイルではなく、
raw イメージファイルが作成される。
raw イメージファイルは、通常のイメージファイルと 2 つの点が異なる。
.\"O First, the filesystem metadata is
.\"O placed in the proper position so that e2fsck, dumpe2fs, debugfs,
.\"O etc. can be run directly on the raw image file.  In order to minimize
.\"O the amount of disk space consumed by a raw image file, the file is
.\"O created as a sparse file.  
1 つ目は、ファイルシステムのメタデータが適切な位置に置かれ、
e2fsck, dumpe2fs, debugfs などが raw イメージファイル上で
直接実行できるという点である。
raw イメージファイルが使うディスクスペースを最小化するため、
このファイルはスパースなファイルとして作成される。
.\"O (Beware of copying or
.\"O compressing/decompressing this file with utilities that don't understand
.\"O how to create sparse files; the file will become as large as the
.\"O filesystem itself!)  
(スパースなファイルの作成が実装されていないユーティリティで
このファイルをコピー・圧縮・展開する場合は注意すること。
ファイルがファイルシステム自身と同じ大きさになってしまうだろう!)
.\"O Secondly, the raw image file also includes indirect
.\"O blocks and directory blocks, which the standard image file does not have,
.\"O although this may change in the future.
2 つ目は、raw イメージファイルが間接ブロックと間接データブロックを
含んでいるという点である。
現行のイメージファイルはこれらのブロックを含んでいないが、
将来的には変更されるかもしれない。
.PP
.\"O Raw image files are sometimes used when sending filesystems to the maintainer
.\"O as part of bug reports to e2fsprogs.  When used in this capacity, the
.\"O recommended command is as follows (replace hda1 with the appropriate device):
raw イメージファイルは、e2fsprogs のバグレポートの
一部としてメンテナにファイルシステムを送る場合に時々利用される。
バグレポートで送る場合には、以下のコマンドが推奨される
(hda1 を適切なデバイスで置き換えること):
.PP
.br
\	\fBe2image \-r /dev/hda1 \- | bzip2 > hda1.e2i.bz2\fR
.PP
.\"O This will only send the metadata information, without any data blocks.  
.\"O However, the filenames in the directory blocks can still reveal
.\"O information about the contents of the filesystem that the bug reporter
.\"O may wish to keep confidential.  To address this concern, the
.\"O .B \-s
.\"O option can be specified.  This will cause
.\"O .B e2image 
.\"O to scramble directory entries and zero out any unused portions
.\"O of the directory blocks before writing the image file.  However,
.\"O the 
.\"O .B \-s
.\"O option will prevent analysis of problems related to hash-tree indexed
.\"O directories.
これにより、データブロックを含まないメタデータ情報のみを送ることができる。
しかしこれでも、ディレクトリブロック内のファイル名によって、
バグ報告者が秘密にしておきたいファイルシステムの内容についての情報が
明らかにされてしまう。
その心配を取り除くためには、
.B \-s
オプションを指定することができる。
これにより
.B e2image
は、イメージファイルを書き込む前に、ディレクトリエントリをごちゃ混ぜにして、
ディレクトリブロックの使用されていない部分を 0 で埋める。
ただし
.B \-s
オプションはハッシュツリーにインデックス化された
ディレクトリについての問題の分析を妨げてしまう。
.PP
.\"O .SH AUTHOR
.SH 著者
.\"O .B e2image 
.\"O was written by Theodore Ts'o (tytso@mit.edu).
.B e2image 
は Theodore Ts'o (tytso@mit.edu) が作成した。
.\"O .SH AVAILABILITY
.SH 入手方法
.\"O .B e2image
.\"O is part of the e2fsprogs package and is available from 
.\"O http://e2fsprogs.sourceforge.net.
.B e2image
は e2fsprogs パッケージの一部で、
http://e2fsprogs.sourceforge.net
から入手できる。
.\"O .SH SEE ALSO
.SH 関連項目
.BR dumpe2fs (8),
.BR debugfs (8)
