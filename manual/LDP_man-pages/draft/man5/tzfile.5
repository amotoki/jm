.\" @(#)tzfile.5	7.11
.\" This file is in the public domain, so clarified as of
.\" 1996-06-05 by Arthur David Olson <arthur_david_olson@nih.gov>.
.\"
.\" Japanese Version Copyright (c) 1999 NAKANO Takeo all rights reserved.
.\" Translated Tue Sep 14 1999 by NAKANO Takeo <nakano@apm.seikei.ac.jp>
.\" 
.\"WORD:	transition time		遷移時間
.\"WORD:	local time types	ローカル時間型
.\"WORD:	timezone abbreviatio strint	タイムゾーン略式文字列
.\"
.TH TZFILE 5 1996-06-05 "" "Linux Programmer's Manual"
.\"O .SH NAME
.\"O tzfile \- timezone information
.\"O .SH SYNOPSIS
.SH 名前
tzfile \- タイムゾーンの情報
.SH 書式
.B #include <tzfile.h>
.\"O .SH DESCRIPTION
.SH 説明
.\"O The timezone information files used by
.\"O .BR tzset (3)
.\"O begin with the magic characters "TZif" to identify then as
.\"O timezone information files,
.\"O followed by sixteen bytes reserved for future use,
.\"O followed by six four-byte values of type
.\"O .IR long ,
.\"O written in a "standard" byte order
.\"O (the high-order byte of the value is written first).
.\"O These values are,
.\"O in order:
.BR tzset (3)
によって用いられるタイムゾーン情報のファイルは、
識別のための magic 文字列 "TZif" で始まり、
将来のための 16 バイトの予約領域が続き、
.I long
型の 4 バイトの値が 6 個続く。
この値は「標準」バイトオーダー (高位バイトが先に書かれる)
で記述される。これらの値は、順に以下のようなものである。
.TP
.I tzh_ttisgmtcnt
.\"O The number of UTC/local indicators stored in the file.
ファイルに記述されている UTC/local インジケータ (indicator) の個数。
.TP
.I tzh_ttisstdcnt
.\"O The number of standard/wall indicators stored in the file.
ファイルに記述されている standard/wall インジケータの個数。
.TP
.I tzh_leapcnt
.\"O The number of leap seconds for which data is stored in the file.
ファイルに記述されている閏秒データの個数。
.TP
.I tzh_timecnt
.\"O The number of "transition times" for which data is stored
.\"O in the file.
ファイルに記述されている「遷移時間 (transition time)」データの個数。
.TP
.I tzh_typecnt
.\"O The number of "local time types" for which data is stored
.\"O in the file (must not be zero).
ファイルに記述されている「ローカル時間型 (local time types)」データの個数
(0 であってはいけない)。
.TP
.I tzh_charcnt
.\"O The number of characters of "timezone abbreviation strings"
.\"O stored in the file.
ファイルに記述されている「タイムゾーン略式文字列 (timezone
abbreviation string)」の個数。
.PP
.\"O The above header is followed by
.\"O .I tzh_timecnt
.\"O four-byte values of type
.\"O .IR long ,
.\"O sorted in ascending order.
.\"O These values are written in "standard" byte order.
.\"O Each is used as a transition time (as returned by
.\"O .BR time (2))
.\"O at which the rules for computing local time change.
上記のヘッダに続いて
.I tzh_timecnt
という 4 バイトの
.I long
型の値が (複数個) 続く。昇順で保管されている。
これらの値は「標準」バイトオーダーで記述されている。
それぞれは遷移時間
.RB ( time (2)
が返す値) として用いられ、
それぞれにおいてローカル時間の計算ルールが変更される。
.\"O Next come
.\"O .I tzh_timecnt
.\"O one-byte values of type
.\"O .IR "unsigned char" ;
.\"O each one tells which of the different types of "local time" types
.\"O described in the file is associated with the same-indexed transition time.
.\"O These values serve as indices into an array of
.\"O .I ttinfo
.\"O structures that appears next in the file;
次に来るのは
.I tzh_timecnt
で、これは
.I "unsigned char"
型の 1 バイトの値である (複数個続くこともある)。
この値は、ファイルで記述されている異なったタイプの「ローカル時間」が、
それぞれ同じようにインデックスされた遷移時間のどれに関連づけられて
いるかを示す。
これらの値は
.I ttinifo
構造体の配列に対するインデックスとして提供されている。
.I ttinfo
構造体はファイル中で次の位置に置かれる。
.\"O these structures are defined as follows:
この構造体は以下のように定義されている:
.in +4n
.sp
.nf
struct ttinfo {
    long         tt_gmtoff;
    int          tt_isdst;
    unsigned int tt_abbrind;
};
.in
.fi
.sp
.\"O Each structure is written as a four-byte value for
.\"O .I tt_gmtoff
.\"O of type
.\"O .B long ,
.\"O in a standard byte order, followed by a one-byte value for
.\"O .I tt_isdst
.\"O and a one-byte value for
.\"O .IR tt_abbrind .
それぞれの構造体は、 4 バイトの \fIlong\fP 型の値 \fItt_gmtoff\fP、
1 バイトの値 \fItt_isdst\fP,
1 バイトの値 \fItt_abbrind\fP から構成される。
.\"NAKANO int なのに 4 バイトなの？ 
.\"O In each structure,
.\"O .I tt_gmtoff
.\"O gives the number of seconds to be added to UTC,
.\"O .I tt_isdst
.\"O tells whether
.\"O .I tm_isdst
.\"O should be set by
.\"O .BR localtime (3),
.\"O and
.\"O .I tt_abbrind
.\"O serves as an index into the array of timezone abbreviation characters
.\"O that follow the
.\"O .I ttinfo
.\"O structure(s) in the file.
それぞれの構造体において、
.I tt_gmtoff
は UTC に加えるべき秒数を与え、
.I tt_isdst
は
.I tm_isdst
を
.BR localtime (3)
にセットすべきかどうかを示し、
.I tt_abbrind
はファイル中で \fIttinfo\fP 構造体 (配列) のあとに置かれる
タイムゾーン略式文字列の配列に対するインデックスである。
.PP
.\"O Then there are
.\"O .I tzh_leapcnt
.\"O pairs of four-byte values, written in standard byte order;
.\"O the first value of each pair gives the time
.\"O (as returned by
.\"O .IR time(2))
.\"O at which a leap second occurs;
.\"O the second gives the
.\"O .I total
.\"O number of leap seconds to be applied after the given time.
.\"O The pairs of values are sorted in ascending order by time.
次には 4 バイト値のペアである
.I tzh_leapcnt
が (複数個) 続く。標準バイトオーダーで記述される。
それぞれのペアの最初の値は閏秒の起きた時刻を (
.IR time (2)
の返す形式で) 与え、二番目の値はその時刻に加えるべき閏秒数の
全秒数を与える。これらのペアは時刻の古い順に記述する。
.PP
.\"O Then there are
.\"O .I tzh_ttisstdcnt
.\"O standard/wall indicators, each stored as a one-byte value;
.\"O they tell whether the transition times associated with local time types
.\"O were specified as standard time or wall clock time,
.\"O and are used when a timezone file is used in handling POSIX-style
.\"O timezone environment variables.
次には
.I tzh_ttisstdcnt
が置かれる。これは standard/wall インジケータで、それぞれ 1 バイトの
値を保管する。これらはローカル時間のタイプに関連づけられた遷移時間が
標準時刻 (standard time) と壁時計時刻 (wall clock time) の
どちらで指定されているかを示す。またこの値は、
POSIX スタイルのタイムゾーン環境変数を処理するときに
タイムゾーンファイルが使われるときにも利用される。
.PP
.\"O Finally, there are
.\"O .I tzh_ttisgmtcnt
.\"O UTC/local indicators, each stored as a one-byte value;
.\"O they tell whether the transition times associated with local time types
.\"O were specified as UTC or local time,
.\"O and are used when a timezone file is used in handling POSIX-style
.\"O timezone environment variables.
最後に
.I tzh_ttisgmtcnt
が置かれる。これは UTC/local インジケータで、それぞれ 1 バイトの
値を保管する。これらはローカル時間のタイプに関連づけられた遷移時間が
UTC とローカル時刻のどちらで指定されているかを示す。またこの値は、
POSIX スタイルのタイムゾーン環境変数を処理するときに
タイムゾーンファイルが使われるときにも利用される。
.PP
.\"O .I Localtime
.\"O uses the first standard-time
.\"O .I ttinfo
.\"O structure in the file
.\"O (or simply the first
.\"O .I ttinfo
.\"O structure in the absence of a standard-time structure)
.\"O if either
.\"O .I tzh_timecnt
.\"O is zero or the time argument is less than the first transition time recorded
.\"O in the file.
.I localtime
は、
.I tzh_timeout
が 0 であるか time 引数がファイルに記録されていた最初の遷移時刻
よりも小さい場合には、
ファイルに最初に現れる標準時刻の
.I ttinfo
構造体を使う (または標準時刻の構造体がない場合は、単に最初の
.I ttinfo
構造体を使う)。
