.\" Copyright (C) 2002 Andries Brouwer <aeb@cwi.nl>
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one.
.\"
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\"
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" This replaces an earlier man page written by Walter Harms
.\" <walter.harms@informatik.uni-oldenburg.de>.
.\"
.\" Japanese Version Copyright (c) 2004 Yuichi SATO
.\"         all rights reserved.
.\" Translated Wed Sep  8 01:25:01 JST 2004
.\"         by Yuichi SATO <ysato444@yahoo.co.jp>
.\"
.TH TTYSLOT 3 2010-09-20 "GNU" "Linux Programmer's Manual"
.\"O .SH NAME
.SH 名前
.\"O ttyslot \- find the slot of the current user's terminal in some file
ttyslot \- カレントユーザの端末のスロットをファイルから探す
.\"O .SH SYNOPSIS
.SH 書式
.\"O .BR "#include <unistd.h>"       "    /* on BSD-like systems, and Linux  */"
.BR "#include <unistd.h>"       "    /* BSD 系のシステムと Linux の場合  */"
.br
.\"O .BR "#include <stdlib.h>"       "    /* on System V-like systems */"
.BR "#include <stdlib.h>"       "    /* System V 系のシステムの場合 */"
.sp
.B "int ttyslot(void);"
.sp
.in -4n
.\"O Feature Test Macro Requirements for glibc (see
.\"O .BR feature_test_macros (7)):
glibc 向けの機能検査マクロの要件
.RB ( feature_test_macros (7)
参照):
.in
.sp
.ad l
.BR ttyslot ():
.RS 4
_BSD_SOURCE ||
.br
_XOPEN_SOURCE\ &&\ _XOPEN_SOURCE_\ <\ 500\ &&\ _XOPEN_SOURCE_EXTENDED
.RE
.ad b
.\"O .SH DESCRIPTION
.SH 説明
.\"O The legacy function
.\"O .BR ttyslot ()
.\"O returns the index of the current user's entry in some file.
レガシーな関数
.BR ttyslot ()
は、あるファイルに書かれているカレントユーザのエントリのインデックスを返す。
.LP
.\"O Now "What file?" you ask.
.\"O Well, let's first look at some history.
「どのファイルなのか？」という質問があるだろう。
では、まず最初にその歴史を見てみよう。
.\"O .SS "Ancient History"
.SS 大昔の歴史
.\"O There used to be a file
.\"O .I /etc/ttys
.\"O in UNIX V6, that was read by the
.\"O .BR init (8)
.\"O program to find out what to do with each terminal line.
UNIX V6 では
.I /etc/ttys
ファイルが使われていた。
.BR init (8)
プログラムは、このファイルを読み込み、
各端末行で何をすべきかを探す。
.\"O Each line consisted of three characters.
各行は 3 文字から構成されている。
.\"O The first character was either \(aq0\(aq or \(aq1\(aq,
.\"O where \(aq0\(aq meant "ignore".
1 文字目は \(aq0\(aq または \(aq1\(aq であり、
\(aq0\(aq は「無視する」ことを表す。
.\"O The second character denoted the terminal: \(aq8\(aq stood for "/dev/tty8".
2 文字目は端末を示す: \(aq8\(aq は "/dev/tty8" を表す。
.\"O The third character was an argument to
.\"O .BR getty (8)
.\"O indicating the sequence of line speeds to try (\(aq\-\(aq was: start trying
.\"O 110 baud).
.\"O Thus a typical line was "18\-".
3 文字目は
.BR getty (8)
への引き数であり、(接続を) 試みる回線速度の順序を表す
(\(aq\-\(aq は 110 ボーで接続の試行を開始することを表す)。
よって一般的な行は "18\-" となる。
.\"O A hang on some line was solved by changing the \(aq1\(aq to a \(aq0\(aq,
.\"O signaling init, changing back again, and signaling init again.
ある行でハングした場合は、\(aq1\(aq を \(aq0\(aq に変更し、
init にシグナルを送り、\(aq0\(aq を \(aq1\(aq 再度に変更し、
init に再度シグナルを送ることで解決する。
.LP
.\"O In UNIX V7 the format was changed: here the second character
.\"O was the argument to
.\"O .BR getty (8)
.\"O indicating the sequence of line speeds to try (\(aq0\(aq was: cycle through
.\"O 300-1200-150-110 baud; \(aq4\(aq was for the on-line console DECwriter)
.\"O while the rest of the line contained the name of the tty.
.\"O Thus a typical line was "14console".
UNIX V7 ではフォーマットが変更された:
2 文字目が
.BR getty (8)
の引き数となり、(接続を) 試みる回線速度の順序を表すようになり
(\(aq0\(aq は 300-1200-150-110 を繰り返すことを表し、
\(aq4\(aq はオンラインコンソール DECwriter を表す)、
行の残り (の文字) は端末名となった。
よって、一般的な行は "14console" となる。
.LP
.\"O Later systems have more elaborate syntax.
後者のシステムの書式は、より精巧である。
.\"O System V-like systems have
.\"O .I /etc/inittab
.\"O instead.
System V 系のシステムでは、代わりに
.I /etc/inittab
がある。
.\"O .SS "Ancient History (2)"
.SS "大昔の歴史 (2)"
.\"O On the other hand, there is the file
.\"O .I /etc/utmp
.\"O listing the people currently logged in.
.\"O It is maintained by
.\"O .BR login (1).
一方、現在ログインしている人をリストするファイル
.I /etc/utmp
がある。
これは
.BR login (1)
によって管理されている。
.\"O It has a fixed size, and the appropriate index in the file was
.\"O determined by
.\"O .BR login (1)
.\"O using the
.\"O .BR ttyslot ()
.\"O call to find the number of the line in
.\"O .I /etc/ttys
.\"O (counting from 1).
このファイルは固定されたサイズであり、ファイル内の適切なインデックスは、
.BR login (1)
によって決定される。
この際に
.BR ttyslot ()
が呼ばれて、
.I /etc/ttys
における行番号を見つける (行番号は 1 から数える)。
.\"O .SS "The semantics of ttyslot"
.SS "ttyslot の意味"
.\"O Thus, the function
.\"O .BR ttyslot ()
.\"O returns the index of the controlling terminal of the calling process
.\"O in the file
.\"O .IR /etc/ttys ,
.\"O and that is (usually) the same as the index of the entry for the
.\"O current user in the file
.\"O .IR /etc/utmp .
よって、関数
.BR ttyslot ()
は、ファイル
.I /etc/ttys
における呼び出し元のプロセスの制御端末のインデックスを返す。
これは
.I /etc/utmp
におけるカレントユーザのエントリのインデックスと (通常は) 等しい。
.\"O BSD still has the
.\"O .I /etc/ttys
.\"O file, but System V-like systems do not, and hence cannot refer to it.
BSD には未だに
.I /etc/ttys
ファイルがあるが、System V 系のシステムにはないので、
このファイルを参照することはできない。
.\"O Thus, on such systems the documentation says that
.\"O .BR ttyslot ()
.\"O returns the current user's index in the user accounting data base.
よって、そのようなシステムでは
.RB 「 ttyslot ()
はカレントユーザのユーザアカウントデータベースにおけるインデックスを返す」
とドキュメントに書かれている。
.\"O .SH "RETURN VALUE"
.SH 返り値
.\"O If successful, this function returns the slot number.
成功した場合、この関数はスロット番号を返す。
.\"O On error (e.g., if none of the file descriptors 0, 1 or 2 is
.\"O associated with a terminal that occurs in this data base)
.\"O it returns 0 on UNIX V6 and V7 and BSD-like systems,
.\"O but \-1 on System V-like systems.
エラーの場合
(例えば、ファイルディスクリプタ 0, 1, 2 の何れも
データベースにある端末に関連づけられていない場合)、
UNIX V6, V7, BSD 系のシステムは 0 を返すが、
System V 系のシステムは -1 を返す。
.\"O .SH "CONFORMING TO"
.SH 準拠
.\"O SUSv1; marked as LEGACY in SUSv2; removed in POSIX.1-2001.
.\"O SUSv2 requires \-1 on error.
SUSv1。SUSv2 では「過去の名残 (LEGACY)」と位置付けられている。
POSIX.1-2001 で削除された。
SUSv2 ではエラー時に \-1 を返すことが要求されている。
.\"O .SH NOTES
.SH 注意
.\"O The utmp file is found various places on various systems, such as
.\"O .IR /etc/utmp ,
.\"O .IR /var/adm/utmp ,
.\"O .IR /var/run/utmp .
utmp ファイルは様々なシステムで
.IR /etc/utmp ,
.IR /var/adm/utmp ,
.I /var/run/utmp
のようにいろいろな場所にある。
.LP
.\"O The glibc2 implementation of this function reads the file
.\"O .BR _PATH_TTYS ,
.\"O defined in
.\"O .I <ttyent.h>
.\"O as "/etc/ttys".
.\"O It returns 0 on error.
この関数の glibc2 における実装では、ファイル
.B _PATH_TTYS
を読み込む。
これは
.I <ttyent.h>
において "/etc/ttys" と定義されている。
エラーの場合、0 を返す。
.\"O Since Linux systems do not usually have "/etc/ttys", it will
.\"O always return 0.
Linux システムには通常 "/etc/ttys" がないので、常に 0 を返す。
.LP
.\"O Minix also has
.\"O .IR fttyslot ( fd ).
Minix には
.IR fttyslot ( fd )
もある。
.\"O .\" .SH HISTORY
.\" .SH 履歴
.\"O .\" .BR ttyslot ()
.\"O .\" appeared in UNIX V7.
.\" .BR ttyslot ()
.\" は UNIX V7 で登場した。
.\"O .SH "SEE ALSO"
.SH 関連項目
.BR getttyent (3),
.BR ttyname (3),
.BR utmp (5)
