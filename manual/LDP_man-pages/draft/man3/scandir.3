.\" Copyright (C) 1993 David Metcalfe (david@prism.demon.co.uk)
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one.
.\"
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\"
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" References consulted:
.\"     Linux libc source code
.\"     Lewine's _POSIX Programmer's Guide_ (O'Reilly & Associates, 1991)
.\"     386BSD man pages
.\" Modified Sat Jul 24 18:26:16 1993 by Rik Faith (faith@cs.unc.edu)
.\" Modified Thu Apr 11 17:11:33 1996 by Andries Brouwer (aeb@cwi.nl):
.\"     Corrected type of compar routines, as suggested by
.\"     Miguel Barreiro (enano@avalon.yaix.es).  Added example.
.\" Modified Sun Sep 24 20:15:46 2000 by aeb, following Petter Reinholdtsen.
.\" Modified 2001-12-26 by aeb, following Joey. Added versionsort.
.\"
.\" Japanese Version Copyright (c) 1998 Hiroaki Nagoya all rights reserved.
.\" Translated Thu May 28 1998 by Hiroaki Nagoya <nagoya@is.titech.ac.jp>
.\" Updated & Modified Sat Jan 19 18:22:21 JST 2002
.\"         by Yuichi SATO <ysato@h4.dion.ne.jp>
.\" Updated & Modified Sun Jan 16 08:12:04 JST 2005
.\"         by Yuichi SATO <ysato444@yahoo.co.jp>
.\"
.TH SCANDIR 3  2009-02-10 "GNU" "Linux Programmer's Manual"
.\"O .SH NAME
.SH 名前
.\"O scandir, alphasort, versionsort \- scan a directory for matching entries
scandir, alphasort, versionsort \- ディレクトリを走査する
.\"O .SH SYNOPSIS
.SH 書式
.nf
.B #include <dirent.h>
.sp
.BI "int scandir(const char *" dirp ", struct dirent ***" namelist ,
.RS
.BI "int (*" filter ")(const struct dirent *),"
.BI "int (*" compar ")(const struct dirent **, const struct dirent **));"
.RE
.sp
.BI "int alphasort(const void *" a ", const void *" b );
.sp
.BI "int versionsort(const void *" a ", const void *" b );
.fi
.sp
.in -4n
.\"O Feature Test Macro Requirements for glibc (see
.\"O .BR feature_test_macros (7)):
glibc 向けの機能検査マクロの要件
.RB ( feature_test_macros (7)
参照):
.in
.sp
.BR scandir (),
.BR alphasort ():
_BSD_SOURCE || _SVID_SOURCE
.br
.BR versionsort ():
_GNU_SOURCE
.\"O .SH DESCRIPTION
.SH 説明
.\"O The
.\"O .BR scandir ()
.\"O function scans the directory \fIdirp\fP, calling
.\"O \fIfilter\fP() on each directory entry.
.\"O Entries for which
.\"O \fIfilter\fP() returns nonzero are stored in strings allocated via
.\"O .BR malloc (3),
.\"O sorted using
.\"O .BR qsort (3)
.\"O with the comparison
.\"O function \fIcompar\fP() and collected in array \fInamelist\fP
.\"O which is allocated via
.\"O .BR malloc (3).
.\"O If \fIfilter\fP is NULL, all entries are selected.
関数
.BR scandir ()
はディレクトリ \fIdirp\fP を走査し、
ディレクトリの各エントリを引き数として
.BR filter ()
を呼び出す。
.BR filter ()
が 0 以外の値を返すエントリは
.BR malloc (3)
によって
確保された文字列に保存され、比較関数
.BR compar ()
を用いて
.BR qsort (3)
によりソートされ、
.BR malloc (3)
により確保された配列
\fInamelist\fP にまとめられる。
\fIfilter\fP が NULL ならば、すべてのエントリが選択される。
.LP
.\"O The
.\"O .BR alphasort ()
.\"O and
.\"O .BR versionsort ()
.\"O functions can be used as the comparison function
.\"O .IR compar ().
比較関数
.IR compar ()
には
.BR alphasort ()
関数と
.BR versionsort ()
関数を使うことができる。
.\"O The former sorts directory entries using
.\"O .BR strcoll (3),
.\"O the latter using
.\"O .BR strverscmp (3)
.\"O on the strings \fI(*a)\->d_name\fP and \fI(*b)\->d_name\fP.
.BR alphasort ()
は
.BR strcoll (3)
を用いてディレクトリエントリをソートし、
.BR versionsort ()
は文字列 \fI(*a)\->d_name\fP と \fI(*b)\->d_name\fP に対して
.BR strverscmp (3)
を用いる。
.\"O .SH "RETURN VALUE"
.SH 返り値
.\"O The
.\"O .BR scandir ()
.\"O function returns the number of directory entries
.\"O selected or \-1 if an error occurs.
関数
.BR scandir ()
は選択されたエントリの数か、
(エラーが発生した場合) \-1 を返す。
.PP
.\"O The
.\"O .BR alphasort ()
.\"O and
.\"O .BR versionsort ()
.\"O functions return an integer less than, equal to,
.\"O or greater than zero if the first argument is considered to be
.\"O respectively less than, equal to, or greater than the second.
関数
.BR alphasort ()
と
.BR versionsort ()
は 1 番目の引き数が 2 番目の引き数に対して、
[小さい/等しい/大きい] かに応じて、0 より [小さい/等しい/大きい] 値を返す。
.\"O .SH ERRORS
.SH エラー
.TP
.B ENOMEM
.\"O Insufficient memory to complete the operation.
動作を完遂するにはメモリが足りない。
.\"O .SH VERSIONS
.SH バージョン
.\"O .BR versionsort ()
.\"O was added to glibc in version 2.1.
.BR versionsort ()
は、glibc バージョン 2.1 で追加された。
.\"O .SH "CONFORMING TO"
.SH 準拠
.\"O .BR alphasort ()
.\"O and
.\"O .BR scandir ()
.\"O are specified in POSIX.1-2008, and are widely available.
.\"O .BR versionsort ()
.\"O is a GNU extension.
.BR alphasort ()
と
.BR scandir ()
は POSIX.1-2008 で規定されており、広く利用可能である。
.BR versionsort ()
は GNU 拡張である。
.LP
.\"O The functions
.\"O .BR scandir ()
.\"O and
.\"O .BR alphasort ()
.\"O are from 4.3BSD, and have been available under Linux since libc4.
関数
.BR scandir ()
と
.BR alphasort ()
は 4.3BSD から取り入れられ、Linux では libc4 から使用可能になった。
.\"O Libc4 and libc5 use the more precise prototype
libc4 と libc5 では以下のようなもっと詳細なプロトタイプを使っている。
.sp
.nf
    int alphasort(const struct dirent ** a,
                  const struct dirent **b);
.fi
.sp
.\"O but glibc 2.0 returns to the imprecise BSD prototype.
しかし glibc 2.0 では不正確な BSD のプロトタイプに戻った。
.LP
.\"O The function
.\"O .BR versionsort ()
.\"O is a GNU extension, available since glibc 2.1.
関数
.BR versionsort ()
は GNU の拡張であり、glibc 2.1 以降で使用可能である。
.LP
.\"O Since glibc 2.1,
.\"O .BR alphasort ()
.\"O calls
.\"O .BR strcoll (3);
.\"O earlier it used
.\"O .BR strcmp (3).
glibc 2.1 以降では
.BR alphasort ()
は
.BR strcoll (3)
を呼び出す。
.BR alphasort ()
は以前は
.BR strcmp (3)
を使っていた。
.\"O .SH EXAMPLE
.SH 例
.nf
#define _SVID_SOURCE
.\"O /* print files in current directory in reverse order */
/* カレントディレクトリのファイルを逆順に出力する */
#include <dirent.h>

int
main(void)
{
    struct dirent **namelist;
    int n;

    n = scandir(".", &namelist, 0, alphasort);
    if (n < 0)
        perror("scandir");
    else {
        while (n\-\-) {
            printf("%s\en", namelist[n]\->d_name);
            free(namelist[n]);
        }
        free(namelist);
    }
}
.fi
.\"O .SH "SEE ALSO"
.SH 関連項目
.BR closedir (3),
.BR fnmatch (3),
.BR opendir (3),
.BR readdir (3),
.BR rewinddir (3),
.BR seekdir (3),
.BR strcmp (3),
.BR strcoll (3),
.BR strverscmp (3),
.BR telldir (3)
