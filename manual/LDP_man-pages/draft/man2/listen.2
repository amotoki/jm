.\" Copyright (c) 1983, 1991 The Regents of the University of California.
.\" and Copyright (C) 2007, Michael Kerrisk <mtk.manpages@gmail.com>
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     $Id: listen.2,v 1.4 2001/05/19 02:09:20 hanataka Exp $
.\"
.\" Modified Fri Jul 23 22:07:54 1993 by Rik Faith <faith@cs.unc.edu>
.\" Modified 950727 by aeb, following a suggestion by Urs Thuermann
.\" <urs@isnogud.escape.de>
.\" Modified Tue Oct 22 08:11:14 EDT 1996 by Eric S. Raymond <esr@thyrsus.com>
.\" Modified 1998 by Andi Kleen
.\" Modified 11 May 2001 by Sam Varshavchik <mrsam@courier-mta.com>
.\"
.\" Japanese Version Copyright (c) 1998 Shinya HANATAKA, Takeshi Hakamada
.\"         all rights reserved.
.\" Translated 1998-04-06,Shinya HANATAKA <shinya@abyss.rim.or.jp>
.\"                   and Takeshi Hakamada <hakamada@nsg.sgi.com>
.\" Modified 2000-01-13, Kentaro Shirakata <argrath@yo.rim.or.jp>
.\" Modified 2001-05-19, Shinya HANATAKA <shinya@abyss.rim.or.jp>
.\" Updated 2007-07-04, Akihiro MOTOKI <amotoki@dd.iij4u.or.jp>, LDP v2.58
.\" Updated 2008-02-10, Akihiro MOTOKI <amotoki@dd.iij4u.or.jp>, LDP v2.77
.\"
.\"WORD:	socket			ソケット
.\"WORD:	listen			監視
.\"WORD:	queue			キュー
.\"WORD:	descriptor		ディスクリプター
.\"
.TH LISTEN 2 2008-11-20 "Linux" "Linux Programmer's Manual"
.\"O .SH NAME
.SH 名前
.\"O listen \- listen for connections on a socket
listen \- ソケット(socket)上の接続を待つ
.\"O .SH SYNOPSIS
.SH 書式
.nf
.\"O .BR "#include <sys/types.h>" "          /* See NOTES */"
.BR "#include <sys/types.h>" "          /* 「注意」参照 */"
.br
.B #include <sys/socket.h>
.sp
.BI "int listen(int " sockfd ", int " backlog );
.fi
.\"O .SH DESCRIPTION
.SH 説明
.\"O .BR listen ()
.\"O marks the socket referred to by
.\"O .I sockfd
.\"O as a passive socket, that is, as a socket that will
.\"O be used to accept incoming connection requests using
.\"O .BR accept (2).
.BR listen ()
は
.I sockfd
が参照するソケットを接続待ちソケット (passive socket) として印をつける。
接続待ちソケットとは、
.BR accept (2)
を使って到着した接続要求を受け付けるのに使用されるソケットである。

.\"O The
.\"O .I sockfd
.\"O argument is a file descriptor that refers to a socket of type
.\"O .B SOCK_STREAM
.\"O or
.\"O .BR SOCK_SEQPACKET .
.I sockfd
引き数は、
.B SOCK_STREAM
型か
.B SOCK_SEQPACKET
型のソケットを参照するファイルディスクリプタである。

.\"O The
.\"O .I backlog
.\"O argument defines the maximum length
.\"O to which the queue of pending connections for
.\"O .I sockfd
.\"O may grow.
.\"O If a connection request arrives when the queue is full, the client
.\"O may receive an error with an indication of
.\"O .B ECONNREFUSED
.\"O or, if the underlying protocol supports retransmission, the request may be
.\"O ignored so that a later reattempt at connection succeeds.
.I backlog
引き数は、
.I sockfd
についての保留中の接続のキューの最大長を指定する。
キューがいっぱいの状態で接続要求が到着すると、クライアントは
.B ECONNREFUSED
というエラーを受け取る。下位層のプロトコルが再送信をサポート
していれば、要求は無視され、これ以降の接続要求の再送信が成功するかもしれない。
.\"O .SH "RETURN VALUE"
.SH 返り値
.\"O On success, zero is returned.
.\"O On error, \-1 is returned, and
.\"O .I errno
.\"O is set appropriately.
成功時には0を返す。エラー時には \-1を返し、
.I errno
を適切に設定する。
.\"O .SH ERRORS
.SH エラー
.\"O .TP
.\"O .B EADDRINUSE
.\"O Another socket is already listening on the same port.
.TP
.B EADDRINUSE
別のソケットが既に同じポートを listen している。
.TP
.B EBADF
.\"O The argument
.\"O .I sockfd
.\"O is not a valid descriptor.
引き数
.I sockfd
は有効なディスクリプターではない。
.TP
.B ENOTSOCK
.\"O The argument
.\"O .I sockfd
.\"O is not a socket.
引き数
.I sockfd
はソケットではない。
.TP
.B EOPNOTSUPP
.\"O The socket is not of a type that supports the
.\"O .BR listen ()
.\"O operation.
ソケットは
.BR listen ()
がサポートしている型ではない。
.\"O .SH "CONFORMING TO"
.SH 準拠
.\"O 4.4BSD, POSIX.1-2001.
.\"O The
.\"O .B listen
.\"O function call first appeared in 4.2BSD.
4.4BSD, POSIX.1-2001.
.BR listen ()
関数は 4.2BSDで初めて実装された。
.\"O .SH NOTES
.SH 注意
.\"O To accept connections, the following steps are performed:
接続を受け付けるには、以下の処理が実行される。
.RS 4
.IP 1. 4
.\"O A socket is created with
.\"O .BR socket (2).
.BR socket (2)
でソケットを作成する。
.IP 2.
.\"O The socket is bound to a local address using
.\"O .BR bind (2),
.\"O so that other sockets may be
.\"O .BR connect (2)ed
.\"O to it.
.BR bind (2)
を使ってソケットにローカルアドレスを割り当てて、
他のソケットがこのソケットに
.BR connect (2)
できるようにする。
.IP 3.
.\"O A willingness to accept incoming connections and a queue limit for incoming
.\"O connections are specified with
.\"O .BR listen ().
.BR listen ()
を使って、接続要求を受け付ける意志と接続要求を入れるキュー長を指定する。
.IP 4.
.\"O Connections are accepted with
.\"O .BR accept (2).
.BR accept (2)
を使って接続を受け付ける。
.RE
.PP
.\"O POSIX.1-2001 does not require the inclusion of
.\"O .IR <sys/types.h> ,
.\"O and this header file is not required on Linux.
.\"O However, some historical (BSD) implementations required this header
.\"O file, and portable applications are probably wise to include it.
POSIX.1-2001 では
.I <sys/types.h>
のインクルードは必須とされておらず、
Linux ではこのヘッダファイルは必要ではない。
しかし、歴史的には、いくつかの実装 (BSD 系) でこのヘッダファイルが
必要であり、移植性が必要なアプリケーションではこのファイルを
インクルードするのが賢明であろう。

.\"O The behavior of the
.\"O .I backlog
.\"O argument on TCP sockets changed with Linux 2.2.
TCP ソケットでの
.I backlog
引き数の振る舞いは Linux 2.2 で変更された。
.\"O Now it specifies the queue length for
.\"O .I completely
.\"O established sockets waiting to be accepted,
.\"O instead of the number of incomplete connection requests.
.\"O The maximum length of the queue for incomplete sockets
.\"O can be set using
.\"O .IR /proc/sys/net/ipv4/tcp_max_syn_backlog .
現在ではこの引き数は、
受け付けられるのを待っている、
.I 完全に
確立されたソケットのキューの長さを指定する。
以前は不完全な接続要求の数であったが、これを置き換えた。
不完全なソケットのキューの最大長は
.I /proc/sys/net/ipv4/tcp_max_syn_backlog
を用いて設定できる。
.\"O When syncookies are enabled there is no logical maximum
.\"O  length and this setting is ignored.
.\"O See
.\"O .BR tcp (7)
.\"O for more information.
syncookie が有効になっている場合、
論理的な最大長は存在せず、この設定は無視される。

.\"O If the
.\"O .I backlog
.\"O argument is greater than the value in
.\"O .IR /proc/sys/net/core/somaxconn ,
.\"O then it is silently truncated to that value;
.\"O the default value in this file is 128.
.\"O In kernels before 2.4.25, this limit was a hard coded value,
.\"O .BR SOMAXCONN ,
.\"O with the value 128.
.I backlog
引き数が
.I /proc/sys/net/core/somaxconn
の値よりも大きければ、
.I backlog
の値は暗黙のうちにこの値に切り詰められる。
このファイルのデフォルト値は 128 である。
バージョン 2.4.5 以前のカーネルでは、この上限値は
コード埋め込みの固定値
.B SOMAXCONN
であり、その値は 128 であった。
.\"O .\" The following is now rather historic information (MTK, Jun 05)
.\"O .\" Don't rely on this value in portable applications since BSD
.\"O .\" (and some BSD-derived systems) limit the backlog to 5.
.\" 以下は、今では古い情報である。(MTK, Jun 05)
.\" BSD (と、いくつかの BSD から派生したシステム)では backlog を 5 に
.\" 制限しているので、移植性を考慮したアプリケーションでは
.\" この値 (SOMAXCONN) に頼ってはいけない。
.\"O .SH EXAMPLE
.SH 例
.\"O See
.\"O .BR bind (2).
.BR bind (2)
参照。
.\"O .SH "SEE ALSO"
.SH 関連項目
.BR accept (2),
.BR bind (2),
.BR connect (2),
.BR socket (2),
.BR socket (7)
