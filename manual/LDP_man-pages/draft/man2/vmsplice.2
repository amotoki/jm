.\" Hey Emacs! This file is -*- nroff -*- source.
.\"
.\" This manpage is Copyright (C) 2006 Jens Axboe
.\" and Copyright (C) 2006 Michael Kerrisk <mtk.manpages@gmail.com>
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one.
.\"
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\"
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" Japanese Version Copyright (c) 2007  Akihiro MOTOKI
.\"         all rights reserved.
.\" Translated 2007-02-04, Akihiro MOTOKI <amotoki@dd.iij4u.or.jp>
.\" 
.TH VMSPLICE 2 2009-09-15 "Linux" "Linux Programmer's Manual"
.\"O .SH NAME
.\"O vmsplice \- splice user pages into a pipe
.SH 名前
vmsplice \- ユーザ・ページをパイプに継ぎ合わせる
.\"O .SH SYNOPSIS
.SH 書式
.nf
.\"O .BR "#define _GNU_SOURCE" "         /* See feature_test_macros(7) */"
.BR "#define _GNU_SOURCE" "         /* feature_test_macros(7) 参照 */"
.B #include <fcntl.h>
.B #include <sys/uio.h>

.BI "ssize_t vmsplice(int " fd ", const struct iovec *" iov ,
.BI "                 unsigned long " nr_segs ", unsigned int " flags );
.fi
.\" Return type was long before glibc 2.7
.\"O .SH DESCRIPTION
.SH 説明
.\" Linus: vmsplice() system call to basically do a "write to
.\" the buffer", but using the reference counting and VM traversal
.\" to actually fill the buffer. This means that the user needs to
.\" be careful not to reuse the user-space buffer it spliced into
.\" the kernel-space one (contrast this to "write()", which copies
.\" the actual data, and you can thus reuse the buffer immediately
.\" after a successful write), but that is often easy to do.
.\"O The
.\"O .BR vmsplice ()
.\"O system call maps
.\"O .I nr_segs
.\"O ranges of user memory described by
.\"O .I iov
.\"O into a pipe.
.\"O The file descriptor
.\"O .I fd
.\"O must refer to a pipe.
.BR vmsplice ()
システムコールは、
.I iov
で指定されたユーザ・メモリの
.I nr_segs
の範囲をパイプにマッピングする。
.I fd
はパイプを参照していなければならない。

.\"O The pointer
.\"O .I iov
.\"O points to an array of
.\"O .I iovec
.\"O structures as defined in
.\"O .IR <sys/uio.h> :
ポインタ
.I iov
は
.I iovec
構造体の配列を指す。
.I iovec
構造体は
.I <sys/uio.h>
で以下のように定義されている:

.in +4n
.nf
struct iovec {
.\"O     void  *iov_base;            /* Starting address */
.\"O     size_t iov_len;             /* Number of bytes */
    void  *iov_base;            /* 開始アドレス */
    size_t iov_len;             /* バイト数 */
};
.in
.fi

.\"O The
.\"O .I flags
.\"O argument is a bit mask that is composed by ORing together
.\"O zero or more of the following values:
.I flags
引き数には、以下の値の 0 個以上をビット毎の論理和の形で指定する。
.TP 1.9i
.B SPLICE_F_MOVE
.\"O Unused for
.\"O .BR vmsplice ();
.\"O see
.\"O .BR splice (2).
.BR vmsplice ()
では未使用。
.BR splice (2)
参照。
.TP
.B SPLICE_F_NONBLOCK
.\" Not used for vmsplice
.\" May be in the future -- therefore EAGAIN
.\"O Do not block on I/O; see
.\"O .BR splice (2)
.\"O for further details.
入出力で停止 (block) しない。詳細は
.BR splice (2)
参照。
.TP
.B SPLICE_F_MORE
.\"O Currently has no effect for
.\"O .BR vmsplice (),
.\"O but may be implemented in the future; see
.\"O .BR splice (2).
現在のところ
.BR vmsplice ()
では何の効果もないが、将来的には実装される可能性がある。
.BR splice (2)
参照。
.TP
.B SPLICE_F_GIFT
.\"O The user pages are a gift to the kernel.
.\"O The application may not modify this memory ever,
.\"O .\" FIXME Explain the following line in a little more detail:
.\"O or page cache and on-disk data may differ.
ユーザ・ページがカーネルへ渡すもの (gift) であることを示す。
アプリケーションはこのメモリを絶対に変更してはならない。
.\" FIXME Explain the following line in a little more detail:
さもなければ、ページキャッシュとディスク上のデータは
一致しなくなるだろう。
.\"O Gifting pages to the kernel means that a subsequent
.\"O .BR splice (2)
.\"O .B SPLICE_F_MOVE
.\"O can successfully move the pages;
ページをカーネルに渡すと、この次の
.BR splice (2)
.B SPLICE_F_MOVE
でそのページの移動を行うことができる。
.\"O if this flag is not specified, then a subsequent
.\"O .BR splice (2)
.\"O .B SPLICE_F_MOVE
.\"O must copy the pages.
このフラグが指定されなかった場合、この次の
.BR splice (2)
.B SPLICE_F_MOVE
でそのページのコピーを行わなければならない。
.\"O Data must also be properly page aligned, both in memory and length.
データはメモリ上でページ境界にあっていなければならず、
長さもページ境界の倍数でなければならない。
.\" .... if we expect to later SPLICE_F_MOVE to the cache.
.\"O .SH RETURN VALUE
.SH 返り値
.\"O Upon successful completion,
.\"O .BR vmsplice ()
.\"O returns the number of bytes transferred to the pipe.
.\"O On error,
.\"O .BR vmsplice ()
.\"O returns \-1 and
.\"O .I errno
.\"O is set to indicate the error.
成功して完了すると、
.BR vmsplice ()
はパイプに転送したバイト数を返す。
エラーの場合、
.BR vmplice ()
は \-1 を返し、
.I errno
をエラーを示す値に設定する。
.\"O .SH ERRORS
.SH エラー
.TP
.B EBADF
.\"O .I fd
.\"O either not valid, or doesn't refer to a pipe.
.I fd
が有効でない、もしくはパイプを参照していない。
.TP
.B EINVAL
.\"O .I nr_segs
.\"O is 0 or greater than
.\"O .BR IOV_MAX ;
.\"O or memory not aligned if
.\"O .B SPLICE_F_GIFT
.\"O set.
.I nr_segs
が 0 もしくは
.B IOV_MAX
よりも大きい。または
.B SPLICE_F_GIFT
が設定されたがメモリがページ境界にあっていない。
.TP
.B ENOMEM
.\"O Out of memory.
メモリ不足。
.\"O .SH VERSIONS
.SH バージョン
.\"O The
.\"O .BR vmsplice ()
.\"O system call first appeared in Linux 2.6.17.
.BR vmsplice ()
システムコールは Linux 2.6.17 で初めて登場した。
.\"O .SH "CONFORMING TO"
.SH 準拠
.\"O This system call is Linux-specific.
このシステムコールは Linux 固有である。
.\"O .SH NOTES
.SH 備考
.\"O .BR vmsplice ()
.\"O follows the other vectorized read/write type functions when it comes to
.\"O limitations on number of segments being passed in.
.\"O This limit is
.\"O .B IOV_MAX
.\"O as defined in
.\"O .IR <limits.h> .
.\"O At the time of this writing, that limit is 1024.
指定されたセグメント数が上限に達した場合、
.BR vmsplice ()
は他のベクトル形式の read/write を行う関数と同じ動作をする。
上限は
.B IOV_MAX
であり、
.I <limits.h>
で定義されている。
このドキュメントを書いた時点での値は 1024 である。
.\"O .SH SEE ALSO
.SH 関連項目
.BR splice (2),
.BR tee (2)
