.\" This is _*_ nroff _*_ source. Emacs, gimme all those colors :)
.\"
.\" Copyright (c) International Business Machines Corp., 2006
.\"
.\" This program is free software; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License as
.\" published by the Free Software Foundation; either version 2 of
.\" the License, or (at your option) any later version.
.\"
.\" This program is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See
.\" the GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public License
.\" along with this program; if not, write to the Free Software
.\" Foundation, Inc., 59 Temple Place, Suite 330, Boston,
.\" MA 02111-1307 USA
.\"
.\" HISTORY:
.\" 2005-09-28, created by Arnd Bergmann <arndb@de.ibm.com>
.\" 2006-06-16, revised by Eduardo M. Fleury <efleury@br.ibm.com>
.\" 2007-07-10, some polishing by mtk
.\"
.\" Japanese Version Copyright (c) 2007  Akihiro MOTOKI
.\"         all rights reserved.
.\" Translated 2007-10-23, Akihiro MOTOKI <amotoki@dd.iij4u.or.jp>
.\"
.TH SPU_CREATE 2 2007-07-10 "Linux" "Linux Programmer's Manual"
.\"O .SH NAME
.SH 名前
.\"O spu_create \- create a new spu context
spu_create \- 新しい SPU コンテキストを生成する
.\"O .SH SYNOPSIS
.SH 書式
.nf
.B #include <sys/types.h>
.B #include <sys/spu.h>

.BI "int spu_create(const char *" pathname ", int " flags ", mode_t " mode ");"
.fi
.\"O .SH DESCRIPTION
.SH 説明
.\"O The
.\"O .BR spu_create ()
.\"O system call is used on PowerPC machines that implement the
.\"O Cell Broadband Engine Architecture in order to access Synergistic
.\"O Processor Units (SPUs).
.\"O It creates a new logical context for an
.\"O SPU in
.\"O .I pathname
.\"O and returns a file descriptor associated with it.
.\"O .I pathname
.\"O must point to a non-existing directory in the mount point of the
.\"O SPU file system (SPUFS).
.\"O If
.\"O .BR spu_create ()
.\"O is successful, a directory is created in
.\"O .I pathname
.\"O and it is populated with the files described in
.\"O .BR spufs (7).
.BR spu_create ()
システムコールは、Cell Broadband Engine アーキテクチャを実装した
PowerPC マシンにおいて、Synergistic Processor Unit (SPU) にアクセスする
ために使用される。
このシステムコールは、SPU に対する新しい論理コンテキストを
.I pathname
に生成し、そのコンテキストに関連付けられたファイルディスクリプタを返す。
.I pathname
は SPU ファイルシステム (SPUFS) のマウントポイント内の
存在しないディレクトリを指していなければならない。
.BR spu_create ()
が成功すると、
.I pathname
にディレクトリが生成され、そのディレクトリに
.BR spufs (7)
で説明されているファイル群が配置される。

.\"O The returned file handler can only be passed to
.\"O .BR spu_run (2)
.\"O or closed;
.\"O other operations are not defined on it.
.\"O A logical SPU
.\"O context is destroyed when its file descriptor is closed as well as
.\"O all the file descriptors pointing to files inside it.
.\"O When an SPU context is destroyed all its directory entries in the
.\"O SPUFS are removed.
返されたファイルハンドラは、
.BR spu_run (2)
に渡すか、クローズするかしかできない。
他の操作は定義されていない。
論理 SPU コンテキストが破棄されるのは、
コンテキスト自身へのファイルディスクリプタがクローズされ、
その中のファイルへのファイルディスクリプタが全てクローズされたときである。
SPU コンテキストが破棄されると、SPUFS 内のそのディレクトリの全てのエントリ
が削除される。

.\"O The argument
.\"O .I flags
.\"O can be zero or the following
.\"O constant:
引き数
.I flags
にはゼロか以下の定数を指定できる。
.TP
.B SPU_RAWIO
.\"O Allow mapping of some of the hardware registers of the SPU into user
.\"O space.
.\"O This flag requires the
.\"O .B CAP_SYS_RAWIO
.\"O capability.
SPU のハードウェアレジスタのいくつかをユーザ空間にマッピングすることを
許可する。このフラグを指定するには
.B CAP_SYS_RAWIO
ケーパビリティが必要である。
.PP
.\"O The new directory and files are created in the SPUFS with the
.\"O permissions set by the
.\"O .I mode
.\"O argument minus those set in the process's
.\"O .BR umask (2).
.\"O The actual permissions set for each file also depend on whether the
.\"O file supports read and/or write accesses.
SPUFS 内に新しく生成されたディレクトリとファイルのアクセス許可は、
.I mode
引き数からそのプロセスの
.BR umask (2)
を引いた値に設定される。
各ファイルの実際のアクセス許可は、そのファイルが読み出しアクセスや
書き込みアクセスをサポートしているかも考慮して決まる。
.\"O .SH RETURN VALUE
.SH 返り値
.\"O On success,
.\"O .BR spu_create (2)
.\"O returns a new file descriptor.
.\"O On error, \-1 is returned and
.\"O .I errno
.\"O is set to one of the error codes listed below.
成功すると、
.BR spu_create (2)
は新しいファイルディスクリプタを返す。
エラーの場合、\-1 を返し、
.I errno
に以下のリストに記載のエラーコードのいずれかを設定する。
.\"O .SH ERRORS
.SH エラー
.TP
.B EACCES
.\"O The current user does not have write access to the SPUFS mount point.
現在のユーザが SPUFS のマウントポイントへの書き込み許可を持っていない。
.TP
.B EEXIST
.\"O An SPU context already exists in the given path name.
指定されたパス名の SPU コンテキストがすでに生成されている。
.TP
.B EFAULT
.\"O .I pathname
.\"O is not a valid string pointer in the current address space.
.I pathname
が現在のアドレス空間で有効な文字列ポインタではない。
.TP
.B EINVAL
.\"O .I pathname
.\"O is not a directory in the SPUFS mount point.
.I pathname
が SPUFS マウントポインタ内のディレクトリではない。
.TP
.B ELOOP
.\"O Too many symlinks were found while resolving
.\"O .IR pathname .
.I pathname
を解決するまでに辿ったシンボリックリンクが多過ぎた。
.TP
.B EMFILE
.\"O The process has reached its maximum open files limit.
そのプロセスがオープンできるファイル数の上限に達していた。
.TP
.B ENAMETOOLONG
.\"O .I pathname
.\"O is too long.
.I pathname
が長過ぎる。
.TP
.B ENFILE
.\"O The system has reached the global open files limit.
システム全体でオープンできるファイル数の上限に達していた。
.TP
.B ENOENT
.\"O Part of
.\"O .I pathname
.\"O could not be resolved.
.I pathname
の一部が解決できなかった。
.TP
.B ENOMEM
.\"O The kernel could not allocate all resources required.
カーネルが必要なリソースの全てを割り当てることができなかった。
.TP
.B ENOSPC
.\"O There are not enough SPU resources available to create
.\"O a new context or the user specific limit for the number
.\"O of SPU contexts has been reached.
新しいコンテキストを生成するのに十分な SPU リソースがなかった、
または SPU コンテキスト数がそのユーザの特定の上限に達していた。
.TP
.B ENOSYS
.\"O The functionality is not provided by the current system, because
.\"O either the hardware does not provide SPUs or the spufs module is not
.\"O loaded.
機能が動作中のシステムで提供されていない。理由は、
ハードウェアで SPU が提供されていないか、
spufs モジュールがロードされていないか、のどちらかである。
.TP
.B ENOTDIR
.\"O A part of
.\"O .I pathname
.\"O is not a directory.
.I pathname
の一部がディレクトリではない。
.\"O .SH FILES
.SH ファイル
.\"O .I pathname
.\"O must point to a location beneath the mount point of the SPUFS.
.\"O By convention, it gets mounted in
.\"O .IR /spu .
.I pathname
は SPUFS のマウントポイントの配下の場所を指していなければならない。
慣例では、SPUFS は
.I /spu
にマウントされる。
.\"O .SH VERSIONS
.SH バージョン
.\"O The
.\"O .BR spu_create (2)
.\"O system call was added to Linux in kernel 2.6.16.
.BR spu_create (2)
システムコールはカーネル 2.6.16 で Linux に追加された。
.\"O .SH CONFORMING TO
.SH 準拠
.\"O This call is Linux specific and only implemented by the ppc64
.\"O architecture.
.\"O Programs using this system call are not portable.
このシステムコールは Linux 固有であり、
ppc64 アーキテクチャでのみ実装されている。
このシステムコールを使ったプログラムは移植性がない。
.\"O .SH NOTES
.SH 注意
.\"O Glibc does not provide a wrapper for this system call; call it using
.\"O .BR syscall (2).
.\"O Note however, that
.\"O .BR spu_create ()
.\"O is meant to be used from libraries that implement a more abstract
.\"O interface to SPUs, not to be used from regular applications.
.\"O See
.\"O .I http://www.bsc.es/projects/deepcomputing/linuxoncell/
.\"O for the recommended libraries.
glibc はこのシステムコールに対するラッパー関数を提供していない。
.BR syscall (2)
を使うこと。ただし、
.BR spu_create ()
は より抽象度の高い SPU へのインタフェースを実装するライブラリから
利用されることを意図したものであり、通常のアプリケーションから
使用は意図されていない。推奨のライブラリについては
.I http://www.bsc.es/projects/deepcomputing/linuxoncell/
を参照のこと。
.\"O .SH BUGS
.SH バグ
.\"O The code does not yet fully implement all features outlined here.
実際のコードではここで述べた全ての機能が完全に実装されているわけではない。
.\" .SH AUTHOR
.\" Arnd Bergmann <arndb@de.ibm.com>
.\"O .SH SEE ALSO
.SH 関連項目
.BR close (2),
.BR spu_run (2),
.BR capabilities (7),
.BR spufs (7)
